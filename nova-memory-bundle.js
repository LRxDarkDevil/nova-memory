var Qd=Object.create;var at=Object.defineProperty;var Zd=Object.getOwnPropertyDescriptor;var ef=Object.getOwnPropertyNames;var tf=Object.getPrototypeOf,sf=Object.prototype.hasOwnProperty;var u=(n,e)=>at(n,"name",{value:e,configurable:!0});var J=(n,e)=>()=>(n&&(e=n(n=0)),e);var w=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),nf=(n,e)=>{for(var t in e)at(n,t,{get:e[t],enumerable:!0})},ea=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ef(e))!sf.call(n,i)&&i!==t&&at(n,i,{get:()=>e[i],enumerable:!(s=Zd(e,i))||s.enumerable});return n};var ss=(n,e,t)=>(t=n!=null?Qd(tf(n)):{},ea(e||!n||!n.__esModule?at(t,"default",{value:n,enumerable:!0}):t,n)),rf=n=>ea(at({},"__esModule",{value:!0}),n);var z=w(_i=>{"use strict";_i.fromCallback=function(n){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")n.apply(this,e);else return new Promise((t,s)=>{e.push((i,r)=>i!=null?s(i):t(r)),n.apply(this,e)})},"name",{value:n.name})};_i.fromPromise=function(n){return Object.defineProperty(function(...e){let t=e[e.length-1];if(typeof t!="function")return n.apply(this,e);e.pop(),n.apply(this,e).then(s=>t(null,s),t)},"name",{value:n.name})}});var sa=w((Ob,ta)=>{var pe=require("constants"),of=process.cwd,is=null,af=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return is||(is=of.call(process)),is};try{process.cwd()}catch{}typeof process.chdir=="function"&&(Ti=process.chdir,process.chdir=function(n){is=null,Ti.call(process,n)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,Ti));var Ti;ta.exports=cf;function cf(n){pe.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(n),n.lutimes||t(n),n.chown=r(n.chown),n.fchown=r(n.fchown),n.lchown=r(n.lchown),n.chmod=s(n.chmod),n.fchmod=s(n.fchmod),n.lchmod=s(n.lchmod),n.chownSync=o(n.chownSync),n.fchownSync=o(n.fchownSync),n.lchownSync=o(n.lchownSync),n.chmodSync=i(n.chmodSync),n.fchmodSync=i(n.fchmodSync),n.lchmodSync=i(n.lchmodSync),n.stat=a(n.stat),n.fstat=a(n.fstat),n.lstat=a(n.lstat),n.statSync=c(n.statSync),n.fstatSync=c(n.fstatSync),n.lstatSync=c(n.lstatSync),n.chmod&&!n.lchmod&&(n.lchmod=function(h,d,f){f&&process.nextTick(f)},n.lchmodSync=function(){}),n.chown&&!n.lchown&&(n.lchown=function(h,d,f,m){m&&process.nextTick(m)},n.lchownSync=function(){}),af==="win32"&&(n.rename=typeof n.rename!="function"?n.rename:function(h){function d(f,m,y){var p=Date.now(),g=0;h(f,m,u(function b(S){if(S&&(S.code==="EACCES"||S.code==="EPERM"||S.code==="EBUSY")&&Date.now()-p<6e4){setTimeout(function(){n.stat(m,function(E,T){E&&E.code==="ENOENT"?h(f,m,b):y(S)})},g),g<100&&(g+=10);return}y&&y(S)},"CB"))}return u(d,"rename"),Object.setPrototypeOf&&Object.setPrototypeOf(d,h),d}(n.rename)),n.read=typeof n.read!="function"?n.read:function(h){function d(f,m,y,p,g,b){var S;if(b&&typeof b=="function"){var E=0;S=u(function(T,_,v){if(T&&T.code==="EAGAIN"&&E<10)return E++,h.call(n,f,m,y,p,g,S);b.apply(this,arguments)},"callback")}return h.call(n,f,m,y,p,g,S)}return u(d,"read"),Object.setPrototypeOf&&Object.setPrototypeOf(d,h),d}(n.read),n.readSync=typeof n.readSync!="function"?n.readSync:function(h){return function(d,f,m,y,p){for(var g=0;;)try{return h.call(n,d,f,m,y,p)}catch(b){if(b.code==="EAGAIN"&&g<10){g++;continue}throw b}}}(n.readSync);function e(h){h.lchmod=function(d,f,m){h.open(d,pe.O_WRONLY|pe.O_SYMLINK,f,function(y,p){if(y){m&&m(y);return}h.fchmod(p,f,function(g){h.close(p,function(b){m&&m(g||b)})})})},h.lchmodSync=function(d,f){var m=h.openSync(d,pe.O_WRONLY|pe.O_SYMLINK,f),y=!0,p;try{p=h.fchmodSync(m,f),y=!1}finally{if(y)try{h.closeSync(m)}catch{}else h.closeSync(m)}return p}}u(e,"patchLchmod");function t(h){pe.hasOwnProperty("O_SYMLINK")&&h.futimes?(h.lutimes=function(d,f,m,y){h.open(d,pe.O_SYMLINK,function(p,g){if(p){y&&y(p);return}h.futimes(g,f,m,function(b){h.close(g,function(S){y&&y(b||S)})})})},h.lutimesSync=function(d,f,m){var y=h.openSync(d,pe.O_SYMLINK),p,g=!0;try{p=h.futimesSync(y,f,m),g=!1}finally{if(g)try{h.closeSync(y)}catch{}else h.closeSync(y)}return p}):h.futimes&&(h.lutimes=function(d,f,m,y){y&&process.nextTick(y)},h.lutimesSync=function(){})}u(t,"patchLutimes");function s(h){return h&&function(d,f,m){return h.call(n,d,f,function(y){l(y)&&(y=null),m&&m.apply(this,arguments)})}}u(s,"chmodFix");function i(h){return h&&function(d,f){try{return h.call(n,d,f)}catch(m){if(!l(m))throw m}}}u(i,"chmodFixSync");function r(h){return h&&function(d,f,m,y){return h.call(n,d,f,m,function(p){l(p)&&(p=null),y&&y.apply(this,arguments)})}}u(r,"chownFix");function o(h){return h&&function(d,f,m){try{return h.call(n,d,f,m)}catch(y){if(!l(y))throw y}}}u(o,"chownFixSync");function a(h){return h&&function(d,f,m){typeof f=="function"&&(m=f,f=null);function y(p,g){g&&(g.uid<0&&(g.uid+=4294967296),g.gid<0&&(g.gid+=4294967296)),m&&m.apply(this,arguments)}return u(y,"callback"),f?h.call(n,d,f,y):h.call(n,d,y)}}u(a,"statFix");function c(h){return h&&function(d,f){var m=f?h.call(n,d,f):h.call(n,d);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}u(c,"statFixSync");function l(h){if(!h||h.code==="ENOSYS")return!0;var d=!process.getuid||process.getuid()!==0;return!!(d&&(h.code==="EINVAL"||h.code==="EPERM"))}u(l,"chownErOk")}u(cf,"patch")});var ra=w((Db,na)=>{var ia=require("stream").Stream;na.exports=lf;function lf(n){return{ReadStream:e,WriteStream:t};function e(s,i){if(!(this instanceof e))return new e(s,i);ia.call(this);var r=this;this.path=s,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var o=Object.keys(i),a=0,c=o.length;a<c;a++){var l=o[a];this[l]=i[l]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){r._read()});return}n.open(this.path,this.flags,this.mode,function(h,d){if(h){r.emit("error",h),r.readable=!1;return}r.fd=d,r.emit("open",d),r._read()})}function t(s,i){if(!(this instanceof t))return new t(s,i);ia.call(this),this.path=s,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var r=Object.keys(i),o=0,a=r.length;o<a;o++){var c=r[o];this[c]=i[c]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=n.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}u(lf,"legacy")});var aa=w((Rb,oa)=>{"use strict";oa.exports=hf;var uf=Object.getPrototypeOf||function(n){return n.__proto__};function hf(n){if(n===null||typeof n!="object")return n;if(n instanceof Object)var e={__proto__:uf(n)};else var e=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}u(hf,"clone")});var Ye=w(($b,Ni)=>{var M=require("fs"),df=sa(),ff=ra(),mf=aa(),ns=require("util"),Y,os;typeof Symbol=="function"&&typeof Symbol.for=="function"?(Y=Symbol.for("graceful-fs.queue"),os=Symbol.for("graceful-fs.previous")):(Y="___graceful-fs.queue",os="___graceful-fs.previous");function pf(){}u(pf,"noop");function ua(n,e){Object.defineProperty(n,Y,{get:u(function(){return e},"get")})}u(ua,"publishQueue");var Re=pf;ns.debuglog?Re=ns.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Re=u(function(){var n=ns.format.apply(ns,arguments);n="GFS4: "+n.split(/\n/).join(`
GFS4: `),console.error(n)},"debug"));M[Y]||(ca=global[Y]||[],ua(M,ca),M.close=function(n){function e(t,s){return n.call(M,t,function(i){i||la(),typeof s=="function"&&s.apply(this,arguments)})}return u(e,"close"),Object.defineProperty(e,os,{value:n}),e}(M.close),M.closeSync=function(n){function e(t){n.apply(M,arguments),la()}return u(e,"closeSync"),Object.defineProperty(e,os,{value:n}),e}(M.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Re(M[Y]),require("assert").equal(M[Y].length,0)}));var ca;global[Y]||ua(global,M[Y]);Ni.exports=vi(mf(M));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!M.__patched&&(Ni.exports=vi(M),M.__patched=!0);function vi(n){df(n),n.gracefulify=vi,n.createReadStream=_,n.createWriteStream=v;var e=n.readFile;n.readFile=t;function t(N,C,A){return typeof C=="function"&&(A=C,C=null),I(N,C,A);function I(F,j,$,P){return e(F,j,function(R){R&&(R.code==="EMFILE"||R.code==="ENFILE")?Ke([I,[F,j,$],R,P||Date.now(),Date.now()]):typeof $=="function"&&$.apply(this,arguments)})}u(I,"go$readFile")}u(t,"readFile");var s=n.writeFile;n.writeFile=i;function i(N,C,A,I){return typeof A=="function"&&(I=A,A=null),F(N,C,A,I);function F(j,$,P,R,K){return s(j,$,P,function(q){q&&(q.code==="EMFILE"||q.code==="ENFILE")?Ke([F,[j,$,P,R],q,K||Date.now(),Date.now()]):typeof R=="function"&&R.apply(this,arguments)})}u(F,"go$writeFile")}u(i,"writeFile");var r=n.appendFile;r&&(n.appendFile=o);function o(N,C,A,I){return typeof A=="function"&&(I=A,A=null),F(N,C,A,I);function F(j,$,P,R,K){return r(j,$,P,function(q){q&&(q.code==="EMFILE"||q.code==="ENFILE")?Ke([F,[j,$,P,R],q,K||Date.now(),Date.now()]):typeof R=="function"&&R.apply(this,arguments)})}u(F,"go$appendFile")}u(o,"appendFile");var a=n.copyFile;a&&(n.copyFile=c);function c(N,C,A,I){return typeof A=="function"&&(I=A,A=0),F(N,C,A,I);function F(j,$,P,R,K){return a(j,$,P,function(q){q&&(q.code==="EMFILE"||q.code==="ENFILE")?Ke([F,[j,$,P,R],q,K||Date.now(),Date.now()]):typeof R=="function"&&R.apply(this,arguments)})}u(F,"go$copyFile")}u(c,"copyFile");var l=n.readdir;n.readdir=d;var h=/^v[0-5]\./;function d(N,C,A){typeof C=="function"&&(A=C,C=null);var I=h.test(process.version)?u(function($,P,R,K){return l($,F($,P,R,K))},"go$readdir"):u(function($,P,R,K){return l($,P,F($,P,R,K))},"go$readdir");return I(N,C,A);function F(j,$,P,R){return function(K,q){K&&(K.code==="EMFILE"||K.code==="ENFILE")?Ke([I,[j,$,P],K,R||Date.now(),Date.now()]):(q&&q.sort&&q.sort(),typeof P=="function"&&P.call(this,K,q))}}}if(u(d,"readdir"),process.version.substr(0,4)==="v0.8"){var f=ff(n);b=f.ReadStream,E=f.WriteStream}var m=n.ReadStream;m&&(b.prototype=Object.create(m.prototype),b.prototype.open=S);var y=n.WriteStream;y&&(E.prototype=Object.create(y.prototype),E.prototype.open=T),Object.defineProperty(n,"ReadStream",{get:u(function(){return b},"get"),set:u(function(N){b=N},"set"),enumerable:!0,configurable:!0}),Object.defineProperty(n,"WriteStream",{get:u(function(){return E},"get"),set:u(function(N){E=N},"set"),enumerable:!0,configurable:!0});var p=b;Object.defineProperty(n,"FileReadStream",{get:u(function(){return p},"get"),set:u(function(N){p=N},"set"),enumerable:!0,configurable:!0});var g=E;Object.defineProperty(n,"FileWriteStream",{get:u(function(){return g},"get"),set:u(function(N){g=N},"set"),enumerable:!0,configurable:!0});function b(N,C){return this instanceof b?(m.apply(this,arguments),this):b.apply(Object.create(b.prototype),arguments)}u(b,"ReadStream");function S(){var N=this;k(N.path,N.flags,N.mode,function(C,A){C?(N.autoClose&&N.destroy(),N.emit("error",C)):(N.fd=A,N.emit("open",A),N.read())})}u(S,"ReadStream$open");function E(N,C){return this instanceof E?(y.apply(this,arguments),this):E.apply(Object.create(E.prototype),arguments)}u(E,"WriteStream");function T(){var N=this;k(N.path,N.flags,N.mode,function(C,A){C?(N.destroy(),N.emit("error",C)):(N.fd=A,N.emit("open",A))})}u(T,"WriteStream$open");function _(N,C){return new n.ReadStream(N,C)}u(_,"createReadStream");function v(N,C){return new n.WriteStream(N,C)}u(v,"createWriteStream");var O=n.open;n.open=k;function k(N,C,A,I){return typeof A=="function"&&(I=A,A=null),F(N,C,A,I);function F(j,$,P,R,K){return O(j,$,P,function(q,Nb){q&&(q.code==="EMFILE"||q.code==="ENFILE")?Ke([F,[j,$,P,R],q,K||Date.now(),Date.now()]):typeof R=="function"&&R.apply(this,arguments)})}u(F,"go$open")}return u(k,"open"),n}u(vi,"patch");function Ke(n){Re("ENQUEUE",n[0].name,n[1]),M[Y].push(n),ki()}u(Ke,"enqueue");var rs;function la(){for(var n=Date.now(),e=0;e<M[Y].length;++e)M[Y][e].length>2&&(M[Y][e][3]=n,M[Y][e][4]=n);ki()}u(la,"resetQueue");function ki(){if(clearTimeout(rs),rs=void 0,M[Y].length!==0){var n=M[Y].shift(),e=n[0],t=n[1],s=n[2],i=n[3],r=n[4];if(i===void 0)Re("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Re("TIMEOUT",e.name,t);var o=t.pop();typeof o=="function"&&o.call(null,s)}else{var a=Date.now()-r,c=Math.max(r-i,1),l=Math.min(c*1.2,100);a>=l?(Re("RETRY",e.name,t),e.apply(null,t.concat([i]))):M[Y].push(n)}rs===void 0&&(rs=setTimeout(ki,0))}}u(ki,"retry")});var H=w(he=>{"use strict";var ha=z().fromCallback,X=Ye(),yf=["access","appendFile","chmod","chown","close","copyFile","cp","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","glob","lchmod","lchown","lutimes","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","statfs","symlink","truncate","unlink","utimes","writeFile"].filter(n=>typeof X[n]=="function");Object.assign(he,X);yf.forEach(n=>{he[n]=ha(X[n])});he.exists=function(n,e){return typeof e=="function"?X.exists(n,e):new Promise(t=>X.exists(n,t))};he.read=function(n,e,t,s,i,r){return typeof r=="function"?X.read(n,e,t,s,i,r):new Promise((o,a)=>{X.read(n,e,t,s,i,(c,l,h)=>{if(c)return a(c);o({bytesRead:l,buffer:h})})})};he.write=function(n,e,...t){return typeof t[t.length-1]=="function"?X.write(n,e,...t):new Promise((s,i)=>{X.write(n,e,...t,(r,o,a)=>{if(r)return i(r);s({bytesWritten:o,buffer:a})})})};he.readv=function(n,e,...t){return typeof t[t.length-1]=="function"?X.readv(n,e,...t):new Promise((s,i)=>{X.readv(n,e,...t,(r,o,a)=>{if(r)return i(r);s({bytesRead:o,buffers:a})})})};he.writev=function(n,e,...t){return typeof t[t.length-1]=="function"?X.writev(n,e,...t):new Promise((s,i)=>{X.writev(n,e,...t,(r,o,a)=>{if(r)return i(r);s({bytesWritten:o,buffers:a})})})};typeof X.realpath.native=="function"?he.realpath.native=ha(X.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var fa=w((Fb,da)=>{"use strict";var gf=require("path");da.exports.checkPath=u(function(e){if(process.platform==="win32"&&/[<>:"|?*]/.test(e.replace(gf.parse(e).root,""))){let s=new Error(`Path contains invalid characters: ${e}`);throw s.code="EINVAL",s}},"checkPath")});var ga=w((Ub,Ci)=>{"use strict";var ma=H(),{checkPath:pa}=fa(),ya=u(n=>{let e={mode:511};return typeof n=="number"?n:{...e,...n}.mode},"getMode");Ci.exports.makeDir=async(n,e)=>(pa(n),ma.mkdir(n,{mode:ya(e),recursive:!0}));Ci.exports.makeDirSync=(n,e)=>(pa(n),ma.mkdirSync(n,{mode:ya(e),recursive:!0}))});var ie=w((zb,wa)=>{"use strict";var wf=z().fromPromise,{makeDir:bf,makeDirSync:Ai}=ga(),Oi=wf(bf);wa.exports={mkdirs:Oi,mkdirsSync:Ai,mkdirp:Oi,mkdirpSync:Ai,ensureDir:Oi,ensureDirSync:Ai}});var ye=w((Bb,Sa)=>{"use strict";var Sf=z().fromPromise,ba=H();function Ef(n){return ba.access(n).then(()=>!0).catch(()=>!1)}u(Ef,"pathExists");Sa.exports={pathExists:Sf(Ef),pathExistsSync:ba.existsSync}});var Ii=w((Yb,Ea)=>{"use strict";var We=H(),_f=z().fromPromise;async function Tf(n,e,t){let s=await We.open(n,"r+"),i=null;try{await We.futimes(s,e,t)}finally{try{await We.close(s)}catch(r){i=r}}if(i)throw i}u(Tf,"utimesMillis");function vf(n,e,t){let s=We.openSync(n,"r+");return We.futimesSync(s,e,t),We.closeSync(s)}u(vf,"utimesMillisSync");Ea.exports={utimesMillis:_f(Tf),utimesMillisSync:vf}});var qe=w((Gb,ka)=>{"use strict";var Ge=H(),B=require("path"),_a=z().fromPromise;function kf(n,e,t){let s=t.dereference?i=>Ge.stat(i,{bigint:!0}):i=>Ge.lstat(i,{bigint:!0});return Promise.all([s(n),s(e).catch(i=>{if(i.code==="ENOENT")return null;throw i})]).then(([i,r])=>({srcStat:i,destStat:r}))}u(kf,"getStats");function Nf(n,e,t){let s,i=t.dereference?o=>Ge.statSync(o,{bigint:!0}):o=>Ge.lstatSync(o,{bigint:!0}),r=i(n);try{s=i(e)}catch(o){if(o.code==="ENOENT")return{srcStat:r,destStat:null};throw o}return{srcStat:r,destStat:s}}u(Nf,"getStatsSync");async function Cf(n,e,t,s){let{srcStat:i,destStat:r}=await kf(n,e,s);if(r){if(ct(i,r)){let o=B.basename(n),a=B.basename(e);if(t==="move"&&o!==a&&o.toLowerCase()===a.toLowerCase())return{srcStat:i,destStat:r,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!r.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${n}'.`);if(!i.isDirectory()&&r.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${n}'.`)}if(i.isDirectory()&&Di(n,e))throw new Error(as(n,e,t));return{srcStat:i,destStat:r}}u(Cf,"checkPaths");function Af(n,e,t,s){let{srcStat:i,destStat:r}=Nf(n,e,s);if(r){if(ct(i,r)){let o=B.basename(n),a=B.basename(e);if(t==="move"&&o!==a&&o.toLowerCase()===a.toLowerCase())return{srcStat:i,destStat:r,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!r.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${n}'.`);if(!i.isDirectory()&&r.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${n}'.`)}if(i.isDirectory()&&Di(n,e))throw new Error(as(n,e,t));return{srcStat:i,destStat:r}}u(Af,"checkPathsSync");async function Ta(n,e,t,s){let i=B.resolve(B.dirname(n)),r=B.resolve(B.dirname(t));if(r===i||r===B.parse(r).root)return;let o;try{o=await Ge.stat(r,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(ct(e,o))throw new Error(as(n,t,s));return Ta(n,e,r,s)}u(Ta,"checkParentPaths");function va(n,e,t,s){let i=B.resolve(B.dirname(n)),r=B.resolve(B.dirname(t));if(r===i||r===B.parse(r).root)return;let o;try{o=Ge.statSync(r,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(ct(e,o))throw new Error(as(n,t,s));return va(n,e,r,s)}u(va,"checkParentPathsSync");function ct(n,e){return e.ino&&e.dev&&e.ino===n.ino&&e.dev===n.dev}u(ct,"areIdentical");function Di(n,e){let t=B.resolve(n).split(B.sep).filter(i=>i),s=B.resolve(e).split(B.sep).filter(i=>i);return t.every((i,r)=>s[r]===i)}u(Di,"isSrcSubdir");function as(n,e,t){return`Cannot ${t} '${n}' to a subdirectory of itself, '${e}'.`}u(as,"errMsg");ka.exports={checkPaths:_a(Cf),checkPathsSync:Af,checkParentPaths:_a(Ta),checkParentPathsSync:va,isSrcSubdir:Di,areIdentical:ct}});var Ia=w((Vb,Oa)=>{"use strict";var V=H(),lt=require("path"),{mkdirs:Of}=ie(),{pathExists:If}=ye(),{utimesMillis:Df}=Ii(),ut=qe();async function Lf(n,e,t={}){typeof t=="function"&&(t={filter:t}),t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001");let{srcStat:s,destStat:i}=await ut.checkPaths(n,e,"copy",t);if(await ut.checkParentPaths(n,s,e,"copy"),!await Ca(n,e,t))return;let o=lt.dirname(e);await If(o)||await Of(o),await Aa(i,n,e,t)}u(Lf,"copy");async function Ca(n,e,t){return t.filter?t.filter(n,e):!0}u(Ca,"runFilter");async function Aa(n,e,t,s){let r=await(s.dereference?V.stat:V.lstat)(e);if(r.isDirectory())return Mf(r,n,e,t,s);if(r.isFile()||r.isCharacterDevice()||r.isBlockDevice())return Rf(r,n,e,t,s);if(r.isSymbolicLink())return Pf(n,e,t,s);throw r.isSocket()?new Error(`Cannot copy a socket file: ${e}`):r.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}u(Aa,"getStatsAndPerformCopy");async function Rf(n,e,t,s,i){if(!e)return Na(n,t,s,i);if(i.overwrite)return await V.unlink(s),Na(n,t,s,i);if(i.errorOnExist)throw new Error(`'${s}' already exists`)}u(Rf,"onFile");async function Na(n,e,t,s){if(await V.copyFile(e,t),s.preserveTimestamps){qf(n.mode)&&await $f(t,n.mode);let i=await V.stat(e);await Df(t,i.atime,i.mtime)}return V.chmod(t,n.mode)}u(Na,"copyFile");function qf(n){return(n&128)===0}u(qf,"fileIsNotWritable");function $f(n,e){return V.chmod(n,e|128)}u($f,"makeFileWritable");async function Mf(n,e,t,s,i){e||await V.mkdir(s);let r=[];for await(let o of await V.opendir(t)){let a=lt.join(t,o.name),c=lt.join(s,o.name);r.push(Ca(a,c,i).then(l=>{if(l)return ut.checkPaths(a,c,"copy",i).then(({destStat:h})=>Aa(h,a,c,i))}))}await Promise.all(r),e||await V.chmod(s,n.mode)}u(Mf,"onDir");async function Pf(n,e,t,s){let i=await V.readlink(e);if(s.dereference&&(i=lt.resolve(process.cwd(),i)),!n)return V.symlink(i,t);let r=null;try{r=await V.readlink(t)}catch(o){if(o.code==="EINVAL"||o.code==="UNKNOWN")return V.symlink(i,t);throw o}if(s.dereference&&(r=lt.resolve(process.cwd(),r)),ut.isSrcSubdir(i,r))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${r}'.`);if(ut.isSrcSubdir(r,i))throw new Error(`Cannot overwrite '${r}' with '${i}'.`);return await V.unlink(t),V.symlink(i,t)}u(Pf,"onLink");Oa.exports=Lf});var $a=w((Hb,qa)=>{"use strict";var Q=Ye(),ht=require("path"),Ff=ie().mkdirsSync,xf=Ii().utimesMillisSync,dt=qe();function Uf(n,e,t){typeof t=="function"&&(t={filter:t}),t=t||{},t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");let{srcStat:s,destStat:i}=dt.checkPathsSync(n,e,"copy",t);if(dt.checkParentPathsSync(n,s,e,"copy"),t.filter&&!t.filter(n,e))return;let r=ht.dirname(e);return Q.existsSync(r)||Ff(r),Da(i,n,e,t)}u(Uf,"copySync");function Da(n,e,t,s){let r=(s.dereference?Q.statSync:Q.lstatSync)(e);if(r.isDirectory())return Gf(r,n,e,t,s);if(r.isFile()||r.isCharacterDevice()||r.isBlockDevice())return jf(r,n,e,t,s);if(r.isSymbolicLink())return Xf(n,e,t,s);throw r.isSocket()?new Error(`Cannot copy a socket file: ${e}`):r.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}u(Da,"getStats");function jf(n,e,t,s,i){return e?zf(n,t,s,i):La(n,t,s,i)}u(jf,"onFile");function zf(n,e,t,s){if(s.overwrite)return Q.unlinkSync(t),La(n,e,t,s);if(s.errorOnExist)throw new Error(`'${t}' already exists`)}u(zf,"mayCopyFile");function La(n,e,t,s){return Q.copyFileSync(e,t),s.preserveTimestamps&&Bf(n.mode,e,t),Li(t,n.mode)}u(La,"copyFile");function Bf(n,e,t){return Kf(n)&&Yf(t,n),Wf(e,t)}u(Bf,"handleTimestamps");function Kf(n){return(n&128)===0}u(Kf,"fileIsNotWritable");function Yf(n,e){return Li(n,e|128)}u(Yf,"makeFileWritable");function Li(n,e){return Q.chmodSync(n,e)}u(Li,"setDestMode");function Wf(n,e){let t=Q.statSync(n);return xf(e,t.atime,t.mtime)}u(Wf,"setDestTimestamps");function Gf(n,e,t,s,i){return e?Ra(t,s,i):Jf(n.mode,t,s,i)}u(Gf,"onDir");function Jf(n,e,t,s){return Q.mkdirSync(t),Ra(e,t,s),Li(t,n)}u(Jf,"mkDirAndCopy");function Ra(n,e,t){let s=Q.opendirSync(n);try{let i;for(;(i=s.readSync())!==null;)Vf(i.name,n,e,t)}finally{s.closeSync()}}u(Ra,"copyDir");function Vf(n,e,t,s){let i=ht.join(e,n),r=ht.join(t,n);if(s.filter&&!s.filter(i,r))return;let{destStat:o}=dt.checkPathsSync(i,r,"copy",s);return Da(o,i,r,s)}u(Vf,"copyDirItem");function Xf(n,e,t,s){let i=Q.readlinkSync(e);if(s.dereference&&(i=ht.resolve(process.cwd(),i)),n){let r;try{r=Q.readlinkSync(t)}catch(o){if(o.code==="EINVAL"||o.code==="UNKNOWN")return Q.symlinkSync(i,t);throw o}if(s.dereference&&(r=ht.resolve(process.cwd(),r)),dt.isSrcSubdir(i,r))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${r}'.`);if(dt.isSrcSubdir(r,i))throw new Error(`Cannot overwrite '${r}' with '${i}'.`);return Hf(i,t)}else return Q.symlinkSync(i,t)}u(Xf,"onLink");function Hf(n,e){return Q.unlinkSync(e),Q.symlinkSync(n,e)}u(Hf,"copyLink");qa.exports=Uf});var cs=w((Zb,Ma)=>{"use strict";var Qf=z().fromPromise;Ma.exports={copy:Qf(Ia()),copySync:$a()}});var ft=w((eS,Fa)=>{"use strict";var Pa=Ye(),Zf=z().fromCallback;function em(n,e){Pa.rm(n,{recursive:!0,force:!0},e)}u(em,"remove");function tm(n){Pa.rmSync(n,{recursive:!0,force:!0})}u(tm,"removeSync");Fa.exports={remove:Zf(em),removeSync:tm}});var Wa=w((sS,Ya)=>{"use strict";var sm=z().fromPromise,ja=H(),za=require("path"),Ba=ie(),Ka=ft(),xa=sm(u(async function(e){let t;try{t=await ja.readdir(e)}catch{return Ba.mkdirs(e)}return Promise.all(t.map(s=>Ka.remove(za.join(e,s))))},"emptyDir"));function Ua(n){let e;try{e=ja.readdirSync(n)}catch{return Ba.mkdirsSync(n)}e.forEach(t=>{t=za.join(n,t),Ka.removeSync(t)})}u(Ua,"emptyDirSync");Ya.exports={emptyDirSync:Ua,emptydirSync:Ua,emptyDir:xa,emptydir:xa}});var Xa=w((nS,Va)=>{"use strict";var im=z().fromPromise,Ga=require("path"),de=H(),Ja=ie();async function nm(n){let e;try{e=await de.stat(n)}catch{}if(e&&e.isFile())return;let t=Ga.dirname(n),s=null;try{s=await de.stat(t)}catch(i){if(i.code==="ENOENT"){await Ja.mkdirs(t),await de.writeFile(n,"");return}else throw i}s.isDirectory()?await de.writeFile(n,""):await de.readdir(t)}u(nm,"createFile");function rm(n){let e;try{e=de.statSync(n)}catch{}if(e&&e.isFile())return;let t=Ga.dirname(n);try{de.statSync(t).isDirectory()||de.readdirSync(t)}catch(s){if(s&&s.code==="ENOENT")Ja.mkdirsSync(t);else throw s}de.writeFileSync(n,"")}u(rm,"createFileSync");Va.exports={createFile:im(nm),createFileSync:rm}});var tc=w((oS,ec)=>{"use strict";var om=z().fromPromise,Ha=require("path"),ge=H(),Qa=ie(),{pathExists:am}=ye(),{areIdentical:Za}=qe();async function cm(n,e){let t;try{t=await ge.lstat(e)}catch{}let s;try{s=await ge.lstat(n)}catch(o){throw o.message=o.message.replace("lstat","ensureLink"),o}if(t&&Za(s,t))return;let i=Ha.dirname(e);await am(i)||await Qa.mkdirs(i),await ge.link(n,e)}u(cm,"createLink");function lm(n,e){let t;try{t=ge.lstatSync(e)}catch{}try{let r=ge.lstatSync(n);if(t&&Za(r,t))return}catch(r){throw r.message=r.message.replace("lstat","ensureLink"),r}let s=Ha.dirname(e);return ge.existsSync(s)||Qa.mkdirsSync(s),ge.linkSync(n,e)}u(lm,"createLinkSync");ec.exports={createLink:om(cm),createLinkSync:lm}});var ic=w((cS,sc)=>{"use strict";var we=require("path"),mt=H(),{pathExists:um}=ye(),hm=z().fromPromise;async function dm(n,e){if(we.isAbsolute(n)){try{await mt.lstat(n)}catch(r){throw r.message=r.message.replace("lstat","ensureSymlink"),r}return{toCwd:n,toDst:n}}let t=we.dirname(e),s=we.join(t,n);if(await um(s))return{toCwd:s,toDst:n};try{await mt.lstat(n)}catch(r){throw r.message=r.message.replace("lstat","ensureSymlink"),r}return{toCwd:n,toDst:we.relative(t,n)}}u(dm,"symlinkPaths");function fm(n,e){if(we.isAbsolute(n)){if(!mt.existsSync(n))throw new Error("absolute srcpath does not exist");return{toCwd:n,toDst:n}}let t=we.dirname(e),s=we.join(t,n);if(mt.existsSync(s))return{toCwd:s,toDst:n};if(!mt.existsSync(n))throw new Error("relative srcpath does not exist");return{toCwd:n,toDst:we.relative(t,n)}}u(fm,"symlinkPathsSync");sc.exports={symlinkPaths:hm(dm),symlinkPathsSync:fm}});var oc=w((uS,rc)=>{"use strict";var nc=H(),mm=z().fromPromise;async function pm(n,e){if(e)return e;let t;try{t=await nc.lstat(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}u(pm,"symlinkType");function ym(n,e){if(e)return e;let t;try{t=nc.lstatSync(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}u(ym,"symlinkTypeSync");rc.exports={symlinkType:mm(pm),symlinkTypeSync:ym}});var uc=w((dS,lc)=>{"use strict";var gm=z().fromPromise,ac=require("path"),ce=H(),{mkdirs:wm,mkdirsSync:bm}=ie(),{symlinkPaths:Sm,symlinkPathsSync:Em}=ic(),{symlinkType:_m,symlinkTypeSync:Tm}=oc(),{pathExists:vm}=ye(),{areIdentical:cc}=qe();async function km(n,e,t){let s;try{s=await ce.lstat(e)}catch{}if(s&&s.isSymbolicLink()){let[a,c]=await Promise.all([ce.stat(n),ce.stat(e)]);if(cc(a,c))return}let i=await Sm(n,e);n=i.toDst;let r=await _m(i.toCwd,t),o=ac.dirname(e);return await vm(o)||await wm(o),ce.symlink(n,e,r)}u(km,"createSymlink");function Nm(n,e,t){let s;try{s=ce.lstatSync(e)}catch{}if(s&&s.isSymbolicLink()){let a=ce.statSync(n),c=ce.statSync(e);if(cc(a,c))return}let i=Em(n,e);n=i.toDst,t=Tm(i.toCwd,t);let r=ac.dirname(e);return ce.existsSync(r)||bm(r),ce.symlinkSync(n,e,t)}u(Nm,"createSymlinkSync");lc.exports={createSymlink:gm(km),createSymlinkSync:Nm}});var wc=w((mS,gc)=>{"use strict";var{createFile:hc,createFileSync:dc}=Xa(),{createLink:fc,createLinkSync:mc}=tc(),{createSymlink:pc,createSymlinkSync:yc}=uc();gc.exports={createFile:hc,createFileSync:dc,ensureFile:hc,ensureFileSync:dc,createLink:fc,createLinkSync:mc,ensureLink:fc,ensureLinkSync:mc,createSymlink:pc,createSymlinkSync:yc,ensureSymlink:pc,ensureSymlinkSync:yc}});var ls=w((pS,bc)=>{function Cm(n,{EOL:e=`
`,finalEOL:t=!0,replacer:s=null,spaces:i}={}){let r=t?e:"";return JSON.stringify(n,s,i).replace(/\n/g,e)+r}u(Cm,"stringify");function Am(n){return Buffer.isBuffer(n)&&(n=n.toString("utf8")),n.replace(/^\uFEFF/,"")}u(Am,"stripBom");bc.exports={stringify:Cm,stripBom:Am}});var Tc=w((gS,_c)=>{var Je;try{Je=Ye()}catch{Je=require("fs")}var us=z(),{stringify:Sc,stripBom:Ec}=ls();async function Om(n,e={}){typeof e=="string"&&(e={encoding:e});let t=e.fs||Je,s="throws"in e?e.throws:!0,i=await us.fromCallback(t.readFile)(n,e);i=Ec(i);let r;try{r=JSON.parse(i,e?e.reviver:null)}catch(o){if(s)throw o.message=`${n}: ${o.message}`,o;return null}return r}u(Om,"_readFile");var Im=us.fromPromise(Om);function Dm(n,e={}){typeof e=="string"&&(e={encoding:e});let t=e.fs||Je,s="throws"in e?e.throws:!0;try{let i=t.readFileSync(n,e);return i=Ec(i),JSON.parse(i,e.reviver)}catch(i){if(s)throw i.message=`${n}: ${i.message}`,i;return null}}u(Dm,"readFileSync");async function Lm(n,e,t={}){let s=t.fs||Je,i=Sc(e,t);await us.fromCallback(s.writeFile)(n,i,t)}u(Lm,"_writeFile");var Rm=us.fromPromise(Lm);function qm(n,e,t={}){let s=t.fs||Je,i=Sc(e,t);return s.writeFileSync(n,i,t)}u(qm,"writeFileSync");var $m={readFile:Im,readFileSync:Dm,writeFile:Rm,writeFileSync:qm};_c.exports=$m});var kc=w((bS,vc)=>{"use strict";var hs=Tc();vc.exports={readJson:hs.readFile,readJsonSync:hs.readFileSync,writeJson:hs.writeFile,writeJsonSync:hs.writeFileSync}});var ds=w((SS,Ac)=>{"use strict";var Mm=z().fromPromise,Ri=H(),Nc=require("path"),Cc=ie(),Pm=ye().pathExists;async function Fm(n,e,t="utf-8"){let s=Nc.dirname(n);return await Pm(s)||await Cc.mkdirs(s),Ri.writeFile(n,e,t)}u(Fm,"outputFile");function xm(n,...e){let t=Nc.dirname(n);Ri.existsSync(t)||Cc.mkdirsSync(t),Ri.writeFileSync(n,...e)}u(xm,"outputFileSync");Ac.exports={outputFile:Mm(Fm),outputFileSync:xm}});var Ic=w((_S,Oc)=>{"use strict";var{stringify:Um}=ls(),{outputFile:jm}=ds();async function zm(n,e,t={}){let s=Um(e,t);await jm(n,s,t)}u(zm,"outputJson");Oc.exports=zm});var Lc=w((vS,Dc)=>{"use strict";var{stringify:Bm}=ls(),{outputFileSync:Km}=ds();function Ym(n,e,t){let s=Bm(e,t);Km(n,s,t)}u(Ym,"outputJsonSync");Dc.exports=Ym});var qc=w((NS,Rc)=>{"use strict";var Wm=z().fromPromise,Z=kc();Z.outputJson=Wm(Ic());Z.outputJsonSync=Lc();Z.outputJSON=Z.outputJson;Z.outputJSONSync=Z.outputJsonSync;Z.writeJSON=Z.writeJson;Z.writeJSONSync=Z.writeJsonSync;Z.readJSON=Z.readJson;Z.readJSONSync=Z.readJsonSync;Rc.exports=Z});var xc=w((CS,Fc)=>{"use strict";var Gm=H(),$c=require("path"),{copy:Jm}=cs(),{remove:Pc}=ft(),{mkdirp:Vm}=ie(),{pathExists:Xm}=ye(),Mc=qe();async function Hm(n,e,t={}){let s=t.overwrite||t.clobber||!1,{srcStat:i,isChangingCase:r=!1}=await Mc.checkPaths(n,e,"move",t);await Mc.checkParentPaths(n,i,e,"move");let o=$c.dirname(e);return $c.parse(o).root!==o&&await Vm(o),Qm(n,e,s,r)}u(Hm,"move");async function Qm(n,e,t,s){if(!s){if(t)await Pc(e);else if(await Xm(e))throw new Error("dest already exists.")}try{await Gm.rename(n,e)}catch(i){if(i.code!=="EXDEV")throw i;await Zm(n,e,t)}}u(Qm,"doRename");async function Zm(n,e,t){return await Jm(n,e,{overwrite:t,errorOnExist:!0,preserveTimestamps:!0}),Pc(n)}u(Zm,"moveAcrossDevice");Fc.exports=Hm});var Kc=w((OS,Bc)=>{"use strict";var jc=Ye(),$i=require("path"),ep=cs().copySync,zc=ft().removeSync,tp=ie().mkdirpSync,Uc=qe();function sp(n,e,t){t=t||{};let s=t.overwrite||t.clobber||!1,{srcStat:i,isChangingCase:r=!1}=Uc.checkPathsSync(n,e,"move",t);return Uc.checkParentPathsSync(n,i,e,"move"),ip(e)||tp($i.dirname(e)),np(n,e,s,r)}u(sp,"moveSync");function ip(n){let e=$i.dirname(n);return $i.parse(e).root===e}u(ip,"isParentRoot");function np(n,e,t,s){if(s)return qi(n,e,t);if(t)return zc(e),qi(n,e,t);if(jc.existsSync(e))throw new Error("dest already exists.");return qi(n,e,t)}u(np,"doRename");function qi(n,e,t){try{jc.renameSync(n,e)}catch(s){if(s.code!=="EXDEV")throw s;return rp(n,e,t)}}u(qi,"rename");function rp(n,e,t){return ep(n,e,{overwrite:t,errorOnExist:!0,preserveTimestamps:!0}),zc(n)}u(rp,"moveAcrossDevice");Bc.exports=sp});var Wc=w((DS,Yc)=>{"use strict";var op=z().fromPromise;Yc.exports={move:op(xc()),moveSync:Kc()}});var pt=w((LS,Gc)=>{"use strict";Gc.exports={...H(),...cs(),...Wa(),...wc(),...qc(),...ie(),...Wc(),...ds(),...ye(),...ft()}});var Vc=w((RS,Jc)=>{var Mi=require("sqlite3").verbose(),ap=pt(),cp=require("path"),Fi=class Fi{constructor(e){this.db=null,this.dbPath=e,this.preparedStatements={}}addMissingColumnsSync(){console.error("\u{1F527} Running auto-recovery: Checking and updating database schema..."),this.db.serialize(()=>{this.db.all("PRAGMA table_info(entities)",(e,t)=>{if(!e&&t&&t.length>0){let s=t.map(r=>r.name),i=0;s.includes("last_updated")||(i++,this.db.run("ALTER TABLE entities ADD COLUMN last_updated TEXT DEFAULT (datetime('now'))",r=>{r&&!r.message.includes("duplicate column")?console.error("Error adding last_updated column:",r):r||console.error("\u2705 Added missing column: entities.last_updated")})),s.includes("updated_at")||(i++,this.db.run("ALTER TABLE entities ADD COLUMN updated_at TEXT DEFAULT (datetime('now'))",r=>{r&&!r.message.includes("duplicate column")?console.error("Error adding updated_at column:",r):r||console.error("\u2705 Added missing column: entities.updated_at")})),s.includes("mention_count")||(i++,this.db.run("ALTER TABLE entities ADD COLUMN mention_count INTEGER DEFAULT 1",r=>{r&&!r.message.includes("duplicate column")?console.error("Error adding mention_count column:",r):r||console.error("\u2705 Added missing column: entities.mention_count")})),s.includes("metadata")||(i++,this.db.run("ALTER TABLE entities ADD COLUMN metadata TEXT DEFAULT '{}'",r=>{r&&!r.message.includes("duplicate column")?console.error("Error adding metadata column:",r):r||console.error("\u2705 Added missing column: entities.metadata")})),i===0&&console.error("\u2705 Entities table schema is up to date")}}),this.db.all("PRAGMA table_info(relationships)",(e,t)=>{if(!e&&t&&t.length>0){let s=t.map(r=>r.name),i=0;s.includes("timestamp")||(i++,this.db.run("ALTER TABLE relationships ADD COLUMN timestamp TEXT DEFAULT (datetime('now'))",r=>{r&&!r.message.includes("duplicate column")?console.error("Error adding timestamp column:",r):r||console.error("\u2705 Added missing column: relationships.timestamp")})),s.includes("metadata")||(i++,this.db.run("ALTER TABLE relationships ADD COLUMN metadata TEXT DEFAULT '{}'",r=>{r&&!r.message.includes("duplicate column")?console.error("Error adding metadata column:",r):r||console.error("\u2705 Added missing column: relationships.metadata")})),i===0&&console.error("\u2705 Relationships table schema is up to date")}}),this.db.all("PRAGMA table_info(memory_entity_links)",(e,t)=>{if(!e&&t&&t.length>0){let s=t.map(r=>r.name),i=0;s.includes("confidence")||(i++,this.db.run("ALTER TABLE memory_entity_links ADD COLUMN confidence FLOAT DEFAULT 1.0",r=>{r&&!r.message.includes("duplicate column")?console.error("Error adding confidence column to memory_entity_links:",r):r||console.error("\u2705 Added missing column: memory_entity_links.confidence")})),s.includes("timestamp")||(i++,this.db.run("ALTER TABLE memory_entity_links ADD COLUMN timestamp DATETIME DEFAULT CURRENT_TIMESTAMP",r=>{r&&!r.message.includes("duplicate column")?console.error("Error adding timestamp column to memory_entity_links:",r):r||console.error("\u2705 Added missing column: memory_entity_links.timestamp")})),i===0&&console.error("\u2705 Memory_entity_links table schema is up to date")}})})}initDatabase(){try{ap.ensureDirSync(cp.dirname(this.dbPath)),this.db=new Mi.Database(this.dbPath,Mi.OPEN_READWRITE|Mi.OPEN_CREATE),this.setupAutoRecovery(),this.db.run("PRAGMA journal_mode = WAL"),this.db.run("PRAGMA synchronous = NORMAL"),this.db.run("PRAGMA cache_size = 50000"),this.db.run("PRAGMA temp_store = MEMORY"),this.db.run("PRAGMA mmap_size = 268435456"),this.db.run("PRAGMA page_size = 4096"),this.db.run("PRAGMA locking_mode = NORMAL"),this.db.run("PRAGMA busy_timeout = 30000"),this.db.run("PRAGMA wal_autocheckpoint = 1000"),this.createSchemaBlocking(),this.prepareStatements(),console.error("\u2705 Database schema initialized with performance optimizations and auto-recovery")}catch(e){throw console.error(`\u274C Failed to initialize database: ${e.message}`),e}}dbRun(e,t=[],s=3){return new Promise((i,r)=>{let o=u(a=>{this.db.run(e,t,function(c){c?c.code==="SQLITE_BUSY"&&a>0?setTimeout(()=>o(a-1),100*(4-a)):r(c):i({lastID:this.lastID,changes:this.changes})})},"attempt");o(s)})}dbGet(e,t=[],s=3){return new Promise((i,r)=>{let o=u(a=>{this.db.get(e,t,(c,l)=>{c?c.code==="SQLITE_BUSY"&&a>0?setTimeout(()=>o(a-1),100*(4-a)):r(c):i(l)})},"attempt");o(s)})}dbAll(e,t=[],s=3){return new Promise((i,r)=>{let o=u(a=>{this.db.all(e,t,(c,l)=>{c?c.code==="SQLITE_BUSY"&&a>0?setTimeout(()=>o(a-1),100*(4-a)):r(c):i(l)})},"attempt");o(s)})}createSchemaBlocking(){this.db.serialize(()=>{this.db.run("SELECT 1",e=>{e||this.addMissingColumnsSync()}),this.db.run(`
        CREATE TABLE IF NOT EXISTS memory_entries (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          content TEXT NOT NULL,
          memory_type TEXT DEFAULT 'general',
          session_id TEXT,
          timestamp TEXT DEFAULT (datetime('now')),
          tags TEXT DEFAULT '[]',
          tool_used TEXT,
          confidence_score REAL DEFAULT 1.0,
          metadata TEXT DEFAULT '{}',
          embedding TEXT
        )
      `),this.db.run(`
        CREATE TABLE IF NOT EXISTS entities (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          name TEXT NOT NULL UNIQUE,
          type TEXT DEFAULT 'unknown',
          confidence REAL DEFAULT 1.0,
          created_at TEXT DEFAULT (datetime('now')),
          updated_at TEXT DEFAULT (datetime('now')),
          last_updated TEXT DEFAULT (datetime('now')),
          mention_count INTEGER DEFAULT 1,
          metadata TEXT DEFAULT '{}'
        )
      `),this.db.run(`
        CREATE TABLE IF NOT EXISTS relationships (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          entity1 TEXT NOT NULL,
          entity2 TEXT NOT NULL,
          relation TEXT NOT NULL,
          confidence REAL DEFAULT 1.0,
          entity1_type TEXT DEFAULT 'unknown',
          entity2_type TEXT DEFAULT 'unknown',
          relation_type TEXT DEFAULT 'general',
          created_at TEXT DEFAULT (datetime('now')),
          updated_at TEXT DEFAULT (datetime('now')),
          timestamp TEXT DEFAULT (datetime('now')),
          metadata TEXT DEFAULT '{}'
        )
      `),this.db.run(`
        CREATE TABLE IF NOT EXISTS memory_entity_links (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          memory_id INTEGER,
          entity_id INTEGER,
          confidence FLOAT DEFAULT 1.0,
          timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
          created_at TEXT DEFAULT (datetime('now')),
          FOREIGN KEY(memory_id) REFERENCES memory_entries(id),
          FOREIGN KEY(entity_id) REFERENCES entities(id),
          UNIQUE(memory_id, entity_id)
        )
      `),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_timestamp ON memory_entries(timestamp)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_type ON memory_entries(memory_type)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_session ON memory_entries(session_id)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_content ON memory_entries(content)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_entities_name ON entities(name)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_entities_type ON entities(type)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_entities_last_updated ON entities(last_updated)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_relationships_entity1 ON relationships(entity1)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_relationships_entity2 ON relationships(entity2)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_relationships_relation ON relationships(relation)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_relationships_timestamp ON relationships(timestamp)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_entity_links_memory ON memory_entity_links(memory_id)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_entity_links_entity ON memory_entity_links(entity_id)"),this.db.run(`
        CREATE VIRTUAL TABLE IF NOT EXISTS memory_fts USING fts5(
          content, 
          tags, 
          memory_type,
          content='memory_entries',
          content_rowid='id'
        )
      `),this.db.run(`
        CREATE TRIGGER IF NOT EXISTS memory_fts_insert AFTER INSERT ON memory_entries BEGIN
          INSERT INTO memory_fts(rowid, content, tags, memory_type) 
          VALUES (new.id, new.content, new.tags, new.memory_type);
        END
      `),this.db.run(`
        CREATE TRIGGER IF NOT EXISTS memory_fts_delete AFTER DELETE ON memory_entries BEGIN
          INSERT INTO memory_fts(memory_fts, rowid, content, tags, memory_type) 
          VALUES('delete', old.id, old.content, old.tags, old.memory_type);
        END
      `),this.db.run(`
        CREATE TRIGGER IF NOT EXISTS memory_fts_update AFTER UPDATE ON memory_entries BEGIN
          INSERT INTO memory_fts(memory_fts, rowid, content, tags, memory_type) 
          VALUES('delete', old.id, old.content, old.tags, old.memory_type);
          INSERT INTO memory_fts(rowid, content, tags, memory_type) 
          VALUES (new.id, new.content, new.tags, new.memory_type);
        END
      `)})}prepareStatements(){console.error("\u2705 Prepared statements initialized for performance optimization")}setupAutoRecovery(){let e=this.dbRun.bind(this);this.dbRun=async(t,s=[],i=3)=>{try{return await e(t,s,i)}catch(r){if(r.message&&r.message.includes("no such column"))return console.error(`\u{1F527} Auto-recovery triggered: ${r.message}`),await new Promise(o=>{this.addMissingColumnsSync(),setTimeout(o,100)}),console.error("\u{1F504} Retrying operation after auto-recovery..."),await e(t,s,i);if(r.message&&r.message.includes("no such table"))return console.error(`\u{1F527} Auto-recovery triggered for missing table: ${r.message}`),await new Promise(o=>{this.createSchemaBlocking(),setTimeout(o,100)}),console.error("\u{1F504} Retrying operation after table creation..."),await e(t,s,i);throw r}}}async close(){return new Promise((e,t)=>{this.db?this.db.close(s=>{s?t(s):(console.error("\u2705 Memory system database closed"),e())}):e()})}};u(Fi,"DatabaseOperations");var Pi=Fi;Jc.exports={DatabaseOperations:Pi}});var D=w(W=>{"use strict";var xi=Symbol.for("yaml.alias"),Xc=Symbol.for("yaml.document"),fs=Symbol.for("yaml.map"),Hc=Symbol.for("yaml.pair"),Ui=Symbol.for("yaml.scalar"),ms=Symbol.for("yaml.seq"),fe=Symbol.for("yaml.node.type"),lp=u(n=>!!n&&typeof n=="object"&&n[fe]===xi,"isAlias"),up=u(n=>!!n&&typeof n=="object"&&n[fe]===Xc,"isDocument"),hp=u(n=>!!n&&typeof n=="object"&&n[fe]===fs,"isMap"),dp=u(n=>!!n&&typeof n=="object"&&n[fe]===Hc,"isPair"),Qc=u(n=>!!n&&typeof n=="object"&&n[fe]===Ui,"isScalar"),fp=u(n=>!!n&&typeof n=="object"&&n[fe]===ms,"isSeq");function Zc(n){if(n&&typeof n=="object")switch(n[fe]){case fs:case ms:return!0}return!1}u(Zc,"isCollection");function mp(n){if(n&&typeof n=="object")switch(n[fe]){case xi:case fs:case Ui:case ms:return!0}return!1}u(mp,"isNode");var pp=u(n=>(Qc(n)||Zc(n))&&!!n.anchor,"hasAnchor");W.ALIAS=xi;W.DOC=Xc;W.MAP=fs;W.NODE_TYPE=fe;W.PAIR=Hc;W.SCALAR=Ui;W.SEQ=ms;W.hasAnchor=pp;W.isAlias=lp;W.isCollection=Zc;W.isDocument=up;W.isMap=hp;W.isNode=mp;W.isPair=dp;W.isScalar=Qc;W.isSeq=fp});var yt=w(ji=>{"use strict";var U=D(),ee=Symbol("break visit"),el=Symbol("skip children"),le=Symbol("remove node");function ps(n,e){let t=tl(e);U.isDocument(n)?Ve(null,n.contents,t,Object.freeze([n]))===le&&(n.contents=null):Ve(null,n,t,Object.freeze([]))}u(ps,"visit");ps.BREAK=ee;ps.SKIP=el;ps.REMOVE=le;function Ve(n,e,t,s){let i=sl(n,e,t,s);if(U.isNode(i)||U.isPair(i))return il(n,s,i),Ve(n,i,t,s);if(typeof i!="symbol"){if(U.isCollection(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){let o=Ve(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===ee)return ee;o===le&&(e.items.splice(r,1),r-=1)}}}else if(U.isPair(e)){s=Object.freeze(s.concat(e));let r=Ve("key",e.key,t,s);if(r===ee)return ee;r===le&&(e.key=null);let o=Ve("value",e.value,t,s);if(o===ee)return ee;o===le&&(e.value=null)}}return i}u(Ve,"visit_");async function ys(n,e){let t=tl(e);U.isDocument(n)?await Xe(null,n.contents,t,Object.freeze([n]))===le&&(n.contents=null):await Xe(null,n,t,Object.freeze([]))}u(ys,"visitAsync");ys.BREAK=ee;ys.SKIP=el;ys.REMOVE=le;async function Xe(n,e,t,s){let i=await sl(n,e,t,s);if(U.isNode(i)||U.isPair(i))return il(n,s,i),Xe(n,i,t,s);if(typeof i!="symbol"){if(U.isCollection(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){let o=await Xe(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===ee)return ee;o===le&&(e.items.splice(r,1),r-=1)}}}else if(U.isPair(e)){s=Object.freeze(s.concat(e));let r=await Xe("key",e.key,t,s);if(r===ee)return ee;r===le&&(e.key=null);let o=await Xe("value",e.value,t,s);if(o===ee)return ee;o===le&&(e.value=null)}}return i}u(Xe,"visitAsync_");function tl(n){return typeof n=="object"&&(n.Collection||n.Node||n.Value)?Object.assign({Alias:n.Node,Map:n.Node,Scalar:n.Node,Seq:n.Node},n.Value&&{Map:n.Value,Scalar:n.Value,Seq:n.Value},n.Collection&&{Map:n.Collection,Seq:n.Collection},n):n}u(tl,"initVisitor");function sl(n,e,t,s){var i,r,o,a,c;if(typeof t=="function")return t(n,e,s);if(U.isMap(e))return(i=t.Map)==null?void 0:i.call(t,n,e,s);if(U.isSeq(e))return(r=t.Seq)==null?void 0:r.call(t,n,e,s);if(U.isPair(e))return(o=t.Pair)==null?void 0:o.call(t,n,e,s);if(U.isScalar(e))return(a=t.Scalar)==null?void 0:a.call(t,n,e,s);if(U.isAlias(e))return(c=t.Alias)==null?void 0:c.call(t,n,e,s)}u(sl,"callVisitor");function il(n,e,t){let s=e[e.length-1];if(U.isCollection(s))s.items[n]=t;else if(U.isPair(s))n==="key"?s.key=t:s.value=t;else if(U.isDocument(s))s.contents=t;else{let i=U.isAlias(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${i} parent`)}}u(il,"replaceNode");ji.visit=ps;ji.visitAsync=ys});var zi=w(rl=>{"use strict";var nl=D(),yp=yt(),gp={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},wp=u(n=>n.replace(/[!,[\]{}]/g,e=>gp[e]),"escapeTagName"),ne=class ne{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},ne.defaultYaml,e),this.tags=Object.assign({},ne.defaultTags,t)}clone(){let e=new ne(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){let e=new ne(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:ne.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},ne.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:ne.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},ne.defaultTags),this.atNextDocument=!1);let s=e.trim().split(/[ \t]+/),i=s.shift();switch(i){case"%TAG":{if(s.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;let[r,o]=s;return this.tags[r]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,s.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;let[r]=s;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{let o=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,o),!1}}default:return t(0,`Unknown directive ${i}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){let o=e.slice(2,-1);return o==="!"||o==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),o)}let[,s,i]=e.match(/^(.*!)([^!]*)$/s);i||t(`The ${e} tag has no suffix`);let r=this.tags[s];if(r)try{return r+decodeURIComponent(i)}catch(o){return t(String(o)),null}return s==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(let[t,s]of Object.entries(this.tags))if(e.startsWith(s))return t+wp(e.substring(s.length));return e[0]==="!"?e:`!<${e}>`}toString(e){let t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags),i;if(e&&s.length>0&&nl.isNode(e.contents)){let r={};yp.visit(e.contents,(o,a)=>{nl.isNode(a)&&a.tag&&(r[a.tag]=!0)}),i=Object.keys(r)}else i=[];for(let[r,o]of s)r==="!!"&&o==="tag:yaml.org,2002:"||(!e||i.some(a=>a.startsWith(o)))&&t.push(`%TAG ${r} ${o}`);return t.join(`
`)}};u(ne,"Directives");var gt=ne;gt.defaultYaml={explicit:!1,version:"1.2"};gt.defaultTags={"!!":"tag:yaml.org,2002:"};rl.Directives=gt});var gs=w(wt=>{"use strict";var ol=D(),bp=yt();function Sp(n){if(/[\x00-\x19\s,[\]{}]/.test(n)){let t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(n)}`;throw new Error(t)}return!0}u(Sp,"anchorIsValid");function al(n){let e=new Set;return bp.visit(n,{Value(t,s){s.anchor&&e.add(s.anchor)}}),e}u(al,"anchorNames");function cl(n,e){for(let t=1;;++t){let s=`${n}${t}`;if(!e.has(s))return s}}u(cl,"findNewAnchor");function Ep(n,e){let t=[],s=new Map,i=null;return{onAnchor:u(r=>{t.push(r),i??(i=al(n));let o=cl(e,i);return i.add(o),o},"onAnchor"),setAnchors:u(()=>{for(let r of t){let o=s.get(r);if(typeof o=="object"&&o.anchor&&(ol.isScalar(o.node)||ol.isCollection(o.node)))o.node.anchor=o.anchor;else{let a=new Error("Failed to resolve repeated object (this should not happen)");throw a.source=r,a}}},"setAnchors"),sourceObjects:s}}u(Ep,"createNodeAnchors");wt.anchorIsValid=Sp;wt.anchorNames=al;wt.createNodeAnchors=Ep;wt.findNewAnchor=cl});var Bi=w(ll=>{"use strict";function bt(n,e,t,s){if(s&&typeof s=="object")if(Array.isArray(s))for(let i=0,r=s.length;i<r;++i){let o=s[i],a=bt(n,s,String(i),o);a===void 0?delete s[i]:a!==o&&(s[i]=a)}else if(s instanceof Map)for(let i of Array.from(s.keys())){let r=s.get(i),o=bt(n,s,i,r);o===void 0?s.delete(i):o!==r&&s.set(i,o)}else if(s instanceof Set)for(let i of Array.from(s)){let r=bt(n,s,i,i);r===void 0?s.delete(i):r!==i&&(s.delete(i),s.add(r))}else for(let[i,r]of Object.entries(s)){let o=bt(n,s,i,r);o===void 0?delete s[i]:o!==r&&(s[i]=o)}return n.call(e,t,s)}u(bt,"applyReviver");ll.applyReviver=bt});var be=w(hl=>{"use strict";var _p=D();function ul(n,e,t){if(Array.isArray(n))return n.map((s,i)=>ul(s,String(i),t));if(n&&typeof n.toJSON=="function"){if(!t||!_p.hasAnchor(n))return n.toJSON(e,t);let s={aliasCount:0,count:1,res:void 0};t.anchors.set(n,s),t.onCreate=r=>{s.res=r,delete t.onCreate};let i=n.toJSON(e,t);return t.onCreate&&t.onCreate(i),i}return typeof n=="bigint"&&!(t!=null&&t.keep)?Number(n):n}u(ul,"toJS");hl.toJS=ul});var ws=w(fl=>{"use strict";var Tp=Bi(),dl=D(),vp=be(),Yi=class Yi{constructor(e){Object.defineProperty(this,dl.NODE_TYPE,{value:e})}clone(){let e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:s,onAnchor:i,reviver:r}={}){if(!dl.isDocument(e))throw new TypeError("A document argument is required");let o={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},a=vp.toJS(this,"",o);if(typeof i=="function")for(let{count:c,res:l}of o.anchors.values())i(l,c);return typeof r=="function"?Tp.applyReviver(r,{"":a},"",a):a}};u(Yi,"NodeBase");var Ki=Yi;fl.NodeBase=Ki});var St=w(ml=>{"use strict";var kp=gs(),Np=yt(),He=D(),Cp=ws(),Ap=be(),Gi=class Gi extends Cp.NodeBase{constructor(e){super(He.ALIAS),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let s;t!=null&&t.aliasResolveCache?s=t.aliasResolveCache:(s=[],Np.visit(e,{Node:u((r,o)=>{(He.isAlias(o)||He.hasAnchor(o))&&s.push(o)},"Node")}),t&&(t.aliasResolveCache=s));let i;for(let r of s){if(r===this)break;r.anchor===this.source&&(i=r)}return i}toJSON(e,t){if(!t)return{source:this.source};let{anchors:s,doc:i,maxAliasCount:r}=t,o=this.resolve(i,t);if(!o){let c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let a=s.get(o);if(a||(Ap.toJS(o,null,t),a=s.get(o)),!a||a.res===void 0){let c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(r>=0&&(a.count+=1,a.aliasCount===0&&(a.aliasCount=bs(i,o,s)),a.count*a.aliasCount>r)){let c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return a.res}toString(e,t,s){let i=`*${this.source}`;if(e){if(kp.anchorIsValid(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){let r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(e.implicitKey)return`${i} `}return i}};u(Gi,"Alias");var Wi=Gi;function bs(n,e,t){if(He.isAlias(e)){let s=e.resolve(n),i=t&&s&&t.get(s);return i?i.count*i.aliasCount:0}else if(He.isCollection(e)){let s=0;for(let i of e.items){let r=bs(n,i,t);r>s&&(s=r)}return s}else if(He.isPair(e)){let s=bs(n,e.key,t),i=bs(n,e.value,t);return Math.max(s,i)}return 1}u(bs,"getAliasCount");ml.Alias=Wi});var x=w(Ji=>{"use strict";var Op=D(),Ip=ws(),Dp=be(),Lp=u(n=>!n||typeof n!="function"&&typeof n!="object","isScalarValue"),Vi=class Vi extends Ip.NodeBase{constructor(e){super(Op.SCALAR),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:Dp.toJS(this.value,e,t)}toString(){return String(this.value)}};u(Vi,"Scalar");var Se=Vi;Se.BLOCK_FOLDED="BLOCK_FOLDED";Se.BLOCK_LITERAL="BLOCK_LITERAL";Se.PLAIN="PLAIN";Se.QUOTE_DOUBLE="QUOTE_DOUBLE";Se.QUOTE_SINGLE="QUOTE_SINGLE";Ji.Scalar=Se;Ji.isScalarValue=Lp});var Et=w(yl=>{"use strict";var Rp=St(),$e=D(),pl=x(),qp="tag:yaml.org,2002:";function $p(n,e,t){if(e){let s=t.filter(r=>r.tag===e),i=s.find(r=>!r.format)??s[0];if(!i)throw new Error(`Tag ${e} not found`);return i}return t.find(s=>{var i;return((i=s.identify)==null?void 0:i.call(s,n))&&!s.format})}u($p,"findTagObject");function Mp(n,e,t){var d,f,m;if($e.isDocument(n)&&(n=n.contents),$e.isNode(n))return n;if($e.isPair(n)){let y=(f=(d=t.schema[$e.MAP]).createNode)==null?void 0:f.call(d,t.schema,null,t);return y.items.push(n),y}(n instanceof String||n instanceof Number||n instanceof Boolean||typeof BigInt<"u"&&n instanceof BigInt)&&(n=n.valueOf());let{aliasDuplicateObjects:s,onAnchor:i,onTagObj:r,schema:o,sourceObjects:a}=t,c;if(s&&n&&typeof n=="object"){if(c=a.get(n),c)return c.anchor??(c.anchor=i(n)),new Rp.Alias(c.anchor);c={anchor:null,node:null},a.set(n,c)}e!=null&&e.startsWith("!!")&&(e=qp+e.slice(2));let l=$p(n,e,o.tags);if(!l){if(n&&typeof n.toJSON=="function"&&(n=n.toJSON()),!n||typeof n!="object"){let y=new pl.Scalar(n);return c&&(c.node=y),y}l=n instanceof Map?o[$e.MAP]:Symbol.iterator in Object(n)?o[$e.SEQ]:o[$e.MAP]}r&&(r(l),delete t.onTagObj);let h=l!=null&&l.createNode?l.createNode(t.schema,n,t):typeof((m=l==null?void 0:l.nodeClass)==null?void 0:m.from)=="function"?l.nodeClass.from(t.schema,n,t):new pl.Scalar(n);return e?h.tag=e:l.default||(h.tag=l.tag),c&&(c.node=h),h}u(Mp,"createNode");yl.createNode=Mp});var Es=w(Ss=>{"use strict";var Pp=Et(),ue=D(),Fp=ws();function Xi(n,e,t){let s=t;for(let i=e.length-1;i>=0;--i){let r=e[i];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){let o=[];o[r]=s,s=o}else s=new Map([[r,s]])}return Pp.createNode(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:u(()=>{throw new Error("This should not happen, please report a bug.")},"onAnchor"),schema:n,sourceObjects:new Map})}u(Xi,"collectionFromPath");var gl=u(n=>n==null||typeof n=="object"&&!!n[Symbol.iterator]().next().done,"isEmptyPath"),Qi=class Qi extends Fp.NodeBase{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){let t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(s=>ue.isNode(s)||ue.isPair(s)?s.clone(e):s),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(gl(e))this.add(t);else{let[s,...i]=e,r=this.get(s,!0);if(ue.isCollection(r))r.addIn(i,t);else if(r===void 0&&this.schema)this.set(s,Xi(this.schema,i,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`)}}deleteIn(e){let[t,...s]=e;if(s.length===0)return this.delete(t);let i=this.get(t,!0);if(ue.isCollection(i))return i.deleteIn(s);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${s}`)}getIn(e,t){let[s,...i]=e,r=this.get(s,!0);return i.length===0?!t&&ue.isScalar(r)?r.value:r:ue.isCollection(r)?r.getIn(i,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!ue.isPair(t))return!1;let s=t.value;return s==null||e&&ue.isScalar(s)&&s.value==null&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(e){let[t,...s]=e;if(s.length===0)return this.has(t);let i=this.get(t,!0);return ue.isCollection(i)?i.hasIn(s):!1}setIn(e,t){let[s,...i]=e;if(i.length===0)this.set(s,t);else{let r=this.get(s,!0);if(ue.isCollection(r))r.setIn(i,t);else if(r===void 0&&this.schema)this.set(s,Xi(this.schema,i,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`)}}};u(Qi,"Collection");var Hi=Qi;Ss.Collection=Hi;Ss.collectionFromPath=Xi;Ss.isEmptyPath=gl});var _t=w(_s=>{"use strict";var xp=u(n=>n.replace(/^(?!$)(?: $)?/gm,"#"),"stringifyComment");function Zi(n,e){return/^\n+$/.test(n)?n.substring(1):e?n.replace(/^(?! *$)/gm,e):n}u(Zi,"indentComment");var Up=u((n,e,t)=>n.endsWith(`
`)?Zi(t,e):t.includes(`
`)?`
`+Zi(t,e):(n.endsWith(" ")?"":" ")+t,"lineComment");_s.indentComment=Zi;_s.lineComment=Up;_s.stringifyComment=xp});var bl=w(Tt=>{"use strict";var jp="flow",en="block",Ts="quoted";function zp(n,e,t="flow",{indentAtStart:s,lineWidth:i=80,minContentWidth:r=20,onFold:o,onOverflow:a}={}){if(!i||i<0)return n;i<r&&(r=0);let c=Math.max(1+r,1+i-e.length);if(n.length<=c)return n;let l=[],h={},d=i-e.length;typeof s=="number"&&(s>i-Math.max(2,r)?l.push(0):d=i-s);let f,m,y=!1,p=-1,g=-1,b=-1;t===en&&(p=wl(n,p,e.length),p!==-1&&(d=p+c));for(let E;E=n[p+=1];){if(t===Ts&&E==="\\"){switch(g=p,n[p+1]){case"x":p+=3;break;case"u":p+=5;break;case"U":p+=9;break;default:p+=1}b=p}if(E===`
`)t===en&&(p=wl(n,p,e.length)),d=p+e.length+c,f=void 0;else{if(E===" "&&m&&m!==" "&&m!==`
`&&m!=="	"){let T=n[p+1];T&&T!==" "&&T!==`
`&&T!=="	"&&(f=p)}if(p>=d)if(f)l.push(f),d=f+c,f=void 0;else if(t===Ts){for(;m===" "||m==="	";)m=E,E=n[p+=1],y=!0;let T=p>b+1?p-2:g-1;if(h[T])return n;l.push(T),h[T]=!0,d=T+c,f=void 0}else y=!0}m=E}if(y&&a&&a(),l.length===0)return n;o&&o();let S=n.slice(0,l[0]);for(let E=0;E<l.length;++E){let T=l[E],_=l[E+1]||n.length;T===0?S=`
${e}${n.slice(0,_)}`:(t===Ts&&h[T]&&(S+=`${n[T]}\\`),S+=`
${e}${n.slice(T+1,_)}`)}return S}u(zp,"foldFlowLines");function wl(n,e,t){let s=e,i=e+1,r=n[i];for(;r===" "||r==="	";)if(e<i+t)r=n[++e];else{do r=n[++e];while(r&&r!==`
`);s=e,i=e+1,r=n[i]}return s}u(wl,"consumeMoreIndentedLines");Tt.FOLD_BLOCK=en;Tt.FOLD_FLOW=jp;Tt.FOLD_QUOTED=Ts;Tt.foldFlowLines=zp});var kt=w(Sl=>{"use strict";var re=x(),Ee=bl(),ks=u((n,e)=>({indentAtStart:e?n.indent.length:n.indentAtStart,lineWidth:n.options.lineWidth,minContentWidth:n.options.minContentWidth}),"getFoldOptions"),Ns=u(n=>/^(%|---|\.\.\.)/m.test(n),"containsDocumentMarker");function Bp(n,e,t){if(!e||e<0)return!1;let s=e-t,i=n.length;if(i<=s)return!1;for(let r=0,o=0;r<i;++r)if(n[r]===`
`){if(r-o>s)return!0;if(o=r+1,i-o<=s)return!1}return!0}u(Bp,"lineLengthOverLimit");function vt(n,e){let t=JSON.stringify(n);if(e.options.doubleQuotedAsJSON)return t;let{implicitKey:s}=e,i=e.options.doubleQuotedMinMultiLineLength,r=e.indent||(Ns(n)?"  ":""),o="",a=0;for(let c=0,l=t[c];l;l=t[++c])if(l===" "&&t[c+1]==="\\"&&t[c+2]==="n"&&(o+=t.slice(a,c)+"\\ ",c+=1,a=c,l="\\"),l==="\\")switch(t[c+1]){case"u":{o+=t.slice(a,c);let h=t.substr(c+2,4);switch(h){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:h.substr(0,2)==="00"?o+="\\x"+h.substr(2):o+=t.substr(c,6)}c+=5,a=c+1}break;case"n":if(s||t[c+2]==='"'||t.length<i)c+=1;else{for(o+=t.slice(a,c)+`

`;t[c+2]==="\\"&&t[c+3]==="n"&&t[c+4]!=='"';)o+=`
`,c+=2;o+=r,t[c+2]===" "&&(o+="\\"),c+=1,a=c+1}break;default:c+=1}return o=a?o+t.slice(a):t,s?o:Ee.foldFlowLines(o,r,Ee.FOLD_QUOTED,ks(e,!1))}u(vt,"doubleQuotedString");function tn(n,e){if(e.options.singleQuote===!1||e.implicitKey&&n.includes(`
`)||/[ \t]\n|\n[ \t]/.test(n))return vt(n,e);let t=e.indent||(Ns(n)?"  ":""),s="'"+n.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?s:Ee.foldFlowLines(s,t,Ee.FOLD_FLOW,ks(e,!1))}u(tn,"singleQuotedString");function Qe(n,e){let{singleQuote:t}=e.options,s;if(t===!1)s=vt;else{let i=n.includes('"'),r=n.includes("'");i&&!r?s=tn:r&&!i?s=vt:s=t?tn:vt}return s(n,e)}u(Qe,"quotedString");var sn;try{sn=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{sn=/\n+(?!\n|$)/g}function vs({comment:n,type:e,value:t},s,i,r){let{blockQuote:o,commentString:a,lineWidth:c}=s.options;if(!o||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return Qe(t,s);let l=s.indent||(s.forceBlockIndent||Ns(t)?"  ":""),h=o==="literal"?!0:o==="folded"||e===re.Scalar.BLOCK_FOLDED?!1:e===re.Scalar.BLOCK_LITERAL?!0:!Bp(t,c,l.length);if(!t)return h?`|
`:`>
`;let d,f;for(f=t.length;f>0;--f){let _=t[f-1];if(_!==`
`&&_!=="	"&&_!==" ")break}let m=t.substring(f),y=m.indexOf(`
`);y===-1?d="-":t===m||y!==m.length-1?(d="+",r&&r()):d="",m&&(t=t.slice(0,-m.length),m[m.length-1]===`
`&&(m=m.slice(0,-1)),m=m.replace(sn,`$&${l}`));let p=!1,g,b=-1;for(g=0;g<t.length;++g){let _=t[g];if(_===" ")p=!0;else if(_===`
`)b=g;else break}let S=t.substring(0,b<g?b+1:g);S&&(t=t.substring(S.length),S=S.replace(/\n+/g,`$&${l}`));let T=(p?l?"2":"1":"")+d;if(n&&(T+=" "+a(n.replace(/ ?[\r\n]+/g," ")),i&&i()),!h){let _=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${l}`),v=!1,O=ks(s,!0);o!=="folded"&&e!==re.Scalar.BLOCK_FOLDED&&(O.onOverflow=()=>{v=!0});let k=Ee.foldFlowLines(`${S}${_}${m}`,l,Ee.FOLD_BLOCK,O);if(!v)return`>${T}
${l}${k}`}return t=t.replace(/\n+/g,`$&${l}`),`|${T}
${l}${S}${t}${m}`}u(vs,"blockString");function Kp(n,e,t,s){let{type:i,value:r}=n,{actualString:o,implicitKey:a,indent:c,indentStep:l,inFlow:h}=e;if(a&&r.includes(`
`)||h&&/[[\]{},]/.test(r))return Qe(r,e);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return a||h||!r.includes(`
`)?Qe(r,e):vs(n,e,t,s);if(!a&&!h&&i!==re.Scalar.PLAIN&&r.includes(`
`))return vs(n,e,t,s);if(Ns(r)){if(c==="")return e.forceBlockIndent=!0,vs(n,e,t,s);if(a&&c===l)return Qe(r,e)}let d=r.replace(/\n+/g,`$&
${c}`);if(o){let f=u(p=>{var g;return p.default&&p.tag!=="tag:yaml.org,2002:str"&&((g=p.test)==null?void 0:g.test(d))},"test"),{compat:m,tags:y}=e.doc.schema;if(y.some(f)||m!=null&&m.some(f))return Qe(r,e)}return a?d:Ee.foldFlowLines(d,c,Ee.FOLD_FLOW,ks(e,!1))}u(Kp,"plainString");function Yp(n,e,t,s){let{implicitKey:i,inFlow:r}=e,o=typeof n.value=="string"?n:Object.assign({},n,{value:String(n.value)}),{type:a}=n;a!==re.Scalar.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(a=re.Scalar.QUOTE_DOUBLE);let c=u(h=>{switch(h){case re.Scalar.BLOCK_FOLDED:case re.Scalar.BLOCK_LITERAL:return i||r?Qe(o.value,e):vs(o,e,t,s);case re.Scalar.QUOTE_DOUBLE:return vt(o.value,e);case re.Scalar.QUOTE_SINGLE:return tn(o.value,e);case re.Scalar.PLAIN:return Kp(o,e,t,s);default:return null}},"_stringify"),l=c(a);if(l===null){let{defaultKeyType:h,defaultStringType:d}=e.options,f=i&&h||d;if(l=c(f),l===null)throw new Error(`Unsupported default string type ${f}`)}return l}u(Yp,"stringifyString");Sl.stringifyString=Yp});var Nt=w(nn=>{"use strict";var Wp=gs(),_e=D(),Gp=_t(),Jp=kt();function Vp(n,e){let t=Object.assign({blockQuote:!0,commentString:Gp.stringifyComment,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},n.schema.toStringOptions,e),s;switch(t.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:n,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:s,options:t}}u(Vp,"createStringifyContext");function Xp(n,e){var i;if(e.tag){let r=n.filter(o=>o.tag===e.tag);if(r.length>0)return r.find(o=>o.format===e.format)??r[0]}let t,s;if(_e.isScalar(e)){s=e.value;let r=n.filter(o=>{var a;return(a=o.identify)==null?void 0:a.call(o,s)});if(r.length>1){let o=r.filter(a=>a.test);o.length>0&&(r=o)}t=r.find(o=>o.format===e.format)??r.find(o=>!o.format)}else s=e,t=n.find(r=>r.nodeClass&&s instanceof r.nodeClass);if(!t){let r=((i=s==null?void 0:s.constructor)==null?void 0:i.name)??(s===null?"null":typeof s);throw new Error(`Tag not resolved for ${r} value`)}return t}u(Xp,"getTagObject");function Hp(n,e,{anchors:t,doc:s}){if(!s.directives)return"";let i=[],r=(_e.isScalar(n)||_e.isCollection(n))&&n.anchor;r&&Wp.anchorIsValid(r)&&(t.add(r),i.push(`&${r}`));let o=n.tag??(e.default?null:e.tag);return o&&i.push(s.directives.tagString(o)),i.join(" ")}u(Hp,"stringifyProps");function Qp(n,e,t,s){var c;if(_e.isPair(n))return n.toString(e,t,s);if(_e.isAlias(n)){if(e.doc.directives)return n.toString(e);if((c=e.resolvedAliases)!=null&&c.has(n))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(n):e.resolvedAliases=new Set([n]),n=n.resolve(e.doc)}let i,r=_e.isNode(n)?n:e.doc.createNode(n,{onTagObj:u(l=>i=l,"onTagObj")});i??(i=Xp(e.doc.schema.tags,r));let o=Hp(r,i,e);o.length>0&&(e.indentAtStart=(e.indentAtStart??0)+o.length+1);let a=typeof i.stringify=="function"?i.stringify(r,e,t,s):_e.isScalar(r)?Jp.stringifyString(r,e,t,s):r.toString(e,t,s);return o?_e.isScalar(r)||a[0]==="{"||a[0]==="["?`${o} ${a}`:`${o}
${e.indent}${a}`:a}u(Qp,"stringify");nn.createStringifyContext=Vp;nn.stringify=Qp});var vl=w(Tl=>{"use strict";var me=D(),El=x(),_l=Nt(),Ct=_t();function Zp({key:n,value:e},t,s,i){let{allNullValues:r,doc:o,indent:a,indentStep:c,options:{commentString:l,indentSeq:h,simpleKeys:d}}=t,f=me.isNode(n)&&n.comment||null;if(d){if(f)throw new Error("With simple keys, key nodes cannot have comments");if(me.isCollection(n)||!me.isNode(n)&&typeof n=="object"){let O="With simple keys, collection cannot be used as a key value";throw new Error(O)}}let m=!d&&(!n||f&&e==null&&!t.inFlow||me.isCollection(n)||(me.isScalar(n)?n.type===El.Scalar.BLOCK_FOLDED||n.type===El.Scalar.BLOCK_LITERAL:typeof n=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!m&&(d||!r),indent:a+c});let y=!1,p=!1,g=_l.stringify(n,t,()=>y=!0,()=>p=!0);if(!m&&!t.inFlow&&g.length>1024){if(d)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");m=!0}if(t.inFlow){if(r||e==null)return y&&s&&s(),g===""?"?":m?`? ${g}`:g}else if(r&&!d||e==null&&m)return g=`? ${g}`,f&&!y?g+=Ct.lineComment(g,t.indent,l(f)):p&&i&&i(),g;y&&(f=null),m?(f&&(g+=Ct.lineComment(g,t.indent,l(f))),g=`? ${g}
${a}:`):(g=`${g}:`,f&&(g+=Ct.lineComment(g,t.indent,l(f))));let b,S,E;me.isNode(e)?(b=!!e.spaceBefore,S=e.commentBefore,E=e.comment):(b=!1,S=null,E=null,e&&typeof e=="object"&&(e=o.createNode(e))),t.implicitKey=!1,!m&&!f&&me.isScalar(e)&&(t.indentAtStart=g.length+1),p=!1,!h&&c.length>=2&&!t.inFlow&&!m&&me.isSeq(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let T=!1,_=_l.stringify(e,t,()=>T=!0,()=>p=!0),v=" ";if(f||b||S){if(v=b?`
`:"",S){let O=l(S);v+=`
${Ct.indentComment(O,t.indent)}`}_===""&&!t.inFlow?v===`
`&&(v=`

`):v+=`
${t.indent}`}else if(!m&&me.isCollection(e)){let O=_[0],k=_.indexOf(`
`),N=k!==-1,C=t.inFlow??e.flow??e.items.length===0;if(N||!C){let A=!1;if(N&&(O==="&"||O==="!")){let I=_.indexOf(" ");O==="&"&&I!==-1&&I<k&&_[I+1]==="!"&&(I=_.indexOf(" ",I+1)),(I===-1||k<I)&&(A=!0)}A||(v=`
${t.indent}`)}}else(_===""||_[0]===`
`)&&(v="");return g+=v+_,t.inFlow?T&&s&&s():E&&!T?g+=Ct.lineComment(g,t.indent,l(E)):p&&i&&i(),g}u(Zp,"stringifyPair");Tl.stringifyPair=Zp});var on=w(rn=>{"use strict";var kl=require("process");function ey(n,...e){n==="debug"&&console.log(...e)}u(ey,"debug");function ty(n,e){(n==="debug"||n==="warn")&&(typeof kl.emitWarning=="function"?kl.emitWarning(e):console.warn(e))}u(ty,"warn");rn.debug=ey;rn.warn=ty});var Is=w(Os=>{"use strict";var At=D(),Nl=x(),Cs="<<",As={identify:u(n=>n===Cs||typeof n=="symbol"&&n.description===Cs,"identify"),default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:u(()=>Object.assign(new Nl.Scalar(Symbol(Cs)),{addToJSMap:Cl}),"resolve"),stringify:u(()=>Cs,"stringify")},sy=u((n,e)=>(As.identify(e)||At.isScalar(e)&&(!e.type||e.type===Nl.Scalar.PLAIN)&&As.identify(e.value))&&(n==null?void 0:n.doc.schema.tags.some(t=>t.tag===As.tag&&t.default)),"isMergeKey");function Cl(n,e,t){if(t=n&&At.isAlias(t)?t.resolve(n.doc):t,At.isSeq(t))for(let s of t.items)an(n,e,s);else if(Array.isArray(t))for(let s of t)an(n,e,s);else an(n,e,t)}u(Cl,"addMergeToJSMap");function an(n,e,t){let s=n&&At.isAlias(t)?t.resolve(n.doc):t;if(!At.isMap(s))throw new Error("Merge sources must be maps or map aliases");let i=s.toJSON(null,n,Map);for(let[r,o]of i)e instanceof Map?e.has(r)||e.set(r,o):e instanceof Set?e.add(r):Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0});return e}u(an,"mergeValue");Os.addMergeToJSMap=Cl;Os.isMergeKey=sy;Os.merge=As});var ln=w(Il=>{"use strict";var iy=on(),Al=Is(),ny=Nt(),Ol=D(),cn=be();function ry(n,e,{key:t,value:s}){if(Ol.isNode(t)&&t.addToJSMap)t.addToJSMap(n,e,s);else if(Al.isMergeKey(n,t))Al.addMergeToJSMap(n,e,s);else{let i=cn.toJS(t,"",n);if(e instanceof Map)e.set(i,cn.toJS(s,i,n));else if(e instanceof Set)e.add(i);else{let r=oy(t,i,n),o=cn.toJS(s,r,n);r in e?Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0}):e[r]=o}}return e}u(ry,"addPairToJSMap");function oy(n,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(Ol.isNode(n)&&(t!=null&&t.doc)){let s=ny.createStringifyContext(t.doc,{});s.anchors=new Set;for(let r of t.anchors.keys())s.anchors.add(r.anchor);s.inFlow=!0,s.inStringifyKey=!0;let i=n.toString(s);if(!t.mapKeyWarned){let r=JSON.stringify(i);r.length>40&&(r=r.substring(0,36)+'..."'),iy.warn(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return i}return JSON.stringify(e)}u(oy,"stringifyKey");Il.addPairToJSMap=ry});var Te=w(un=>{"use strict";var Dl=Et(),ay=vl(),cy=ln(),Ds=D();function ly(n,e,t){let s=Dl.createNode(n,void 0,t),i=Dl.createNode(e,void 0,t);return new Ls(s,i)}u(ly,"createPair");var Rs=class Rs{constructor(e,t=null){Object.defineProperty(this,Ds.NODE_TYPE,{value:Ds.PAIR}),this.key=e,this.value=t}clone(e){let{key:t,value:s}=this;return Ds.isNode(t)&&(t=t.clone(e)),Ds.isNode(s)&&(s=s.clone(e)),new Rs(t,s)}toJSON(e,t){let s=t!=null&&t.mapAsMap?new Map:{};return cy.addPairToJSMap(t,s,this)}toString(e,t,s){return e!=null&&e.doc?ay.stringifyPair(this,e,t,s):JSON.stringify(this)}};u(Rs,"Pair");var Ls=Rs;un.Pair=Ls;un.createPair=ly});var hn=w(Rl=>{"use strict";var Me=D(),Ll=Nt(),qs=_t();function uy(n,e,t){return(e.inFlow??n.flow?dy:hy)(n,e,t)}u(uy,"stringifyCollection");function hy({comment:n,items:e},t,{blockItemPrefix:s,flowChars:i,itemIndent:r,onChompKeep:o,onComment:a}){let{indent:c,options:{commentString:l}}=t,h=Object.assign({},t,{indent:r,type:null}),d=!1,f=[];for(let y=0;y<e.length;++y){let p=e[y],g=null;if(Me.isNode(p))!d&&p.spaceBefore&&f.push(""),$s(t,f,p.commentBefore,d),p.comment&&(g=p.comment);else if(Me.isPair(p)){let S=Me.isNode(p.key)?p.key:null;S&&(!d&&S.spaceBefore&&f.push(""),$s(t,f,S.commentBefore,d))}d=!1;let b=Ll.stringify(p,h,()=>g=null,()=>d=!0);g&&(b+=qs.lineComment(b,r,l(g))),d&&g&&(d=!1),f.push(s+b)}let m;if(f.length===0)m=i.start+i.end;else{m=f[0];for(let y=1;y<f.length;++y){let p=f[y];m+=p?`
${c}${p}`:`
`}}return n?(m+=`
`+qs.indentComment(l(n),c),a&&a()):d&&o&&o(),m}u(hy,"stringifyBlockCollection");function dy({items:n},e,{flowChars:t,itemIndent:s}){let{indent:i,indentStep:r,flowCollectionPadding:o,options:{commentString:a}}=e;s+=r;let c=Object.assign({},e,{indent:s,inFlow:!0,type:null}),l=!1,h=0,d=[];for(let y=0;y<n.length;++y){let p=n[y],g=null;if(Me.isNode(p))p.spaceBefore&&d.push(""),$s(e,d,p.commentBefore,!1),p.comment&&(g=p.comment);else if(Me.isPair(p)){let S=Me.isNode(p.key)?p.key:null;S&&(S.spaceBefore&&d.push(""),$s(e,d,S.commentBefore,!1),S.comment&&(l=!0));let E=Me.isNode(p.value)?p.value:null;E?(E.comment&&(g=E.comment),E.commentBefore&&(l=!0)):p.value==null&&(S!=null&&S.comment)&&(g=S.comment)}g&&(l=!0);let b=Ll.stringify(p,c,()=>g=null);y<n.length-1&&(b+=","),g&&(b+=qs.lineComment(b,s,a(g))),!l&&(d.length>h||b.includes(`
`))&&(l=!0),d.push(b),h=d.length}let{start:f,end:m}=t;if(d.length===0)return f+m;if(!l){let y=d.reduce((p,g)=>p+g.length+2,2);l=e.options.lineWidth>0&&y>e.options.lineWidth}if(l){let y=f;for(let p of d)y+=p?`
${r}${i}${p}`:`
`;return`${y}
${i}${m}`}else return`${f}${o}${d.join(" ")}${o}${m}`}u(dy,"stringifyFlowCollection");function $s({indent:n,options:{commentString:e}},t,s,i){if(s&&i&&(s=s.replace(/^\n+/,"")),s){let r=qs.indentComment(e(s),n);t.push(r.trimStart())}}u($s,"addCommentBefore");Rl.stringifyCollection=uy});var ke=w(fn=>{"use strict";var fy=hn(),my=ln(),py=Es(),ve=D(),Ms=Te(),yy=x();function Ot(n,e){let t=ve.isScalar(e)?e.value:e;for(let s of n)if(ve.isPair(s)&&(s.key===e||s.key===t||ve.isScalar(s.key)&&s.key.value===t))return s}u(Ot,"findPair");var mn=class mn extends py.Collection{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(ve.MAP,e),this.items=[]}static from(e,t,s){let{keepUndefined:i,replacer:r}=s,o=new this(e),a=u((c,l)=>{if(typeof r=="function")l=r.call(t,c,l);else if(Array.isArray(r)&&!r.includes(c))return;(l!==void 0||i)&&o.items.push(Ms.createPair(c,l,s))},"add");if(t instanceof Map)for(let[c,l]of t)a(c,l);else if(t&&typeof t=="object")for(let c of Object.keys(t))a(c,t[c]);return typeof e.sortMapEntries=="function"&&o.items.sort(e.sortMapEntries),o}add(e,t){var o;let s;ve.isPair(e)?s=e:!e||typeof e!="object"||!("key"in e)?s=new Ms.Pair(e,e==null?void 0:e.value):s=new Ms.Pair(e.key,e.value);let i=Ot(this.items,s.key),r=(o=this.schema)==null?void 0:o.sortMapEntries;if(i){if(!t)throw new Error(`Key ${s.key} already set`);ve.isScalar(i.value)&&yy.isScalarValue(s.value)?i.value.value=s.value:i.value=s.value}else if(r){let a=this.items.findIndex(c=>r(s,c)<0);a===-1?this.items.push(s):this.items.splice(a,0,s)}else this.items.push(s)}delete(e){let t=Ot(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){let s=Ot(this.items,e),i=s==null?void 0:s.value;return(!t&&ve.isScalar(i)?i.value:i)??void 0}has(e){return!!Ot(this.items,e)}set(e,t){this.add(new Ms.Pair(e,t),!0)}toJSON(e,t,s){let i=s?new s:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(i);for(let r of this.items)my.addPairToJSMap(t,i,r);return i}toString(e,t,s){if(!e)return JSON.stringify(this);for(let i of this.items)if(!ve.isPair(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),fy.stringifyCollection(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:s,onComment:t})}};u(mn,"YAMLMap");var dn=mn;fn.YAMLMap=dn;fn.findPair=Ot});var Ze=w($l=>{"use strict";var gy=D(),ql=ke(),wy={collection:"map",default:!0,nodeClass:ql.YAMLMap,tag:"tag:yaml.org,2002:map",resolve(n,e){return gy.isMap(n)||e("Expected a mapping for this tag"),n},createNode:u((n,e,t)=>ql.YAMLMap.from(n,e,t),"createNode")};$l.map=wy});var Ne=w(Ml=>{"use strict";var by=Et(),Sy=hn(),Ey=Es(),Fs=D(),_y=x(),Ty=be(),yn=class yn extends Ey.Collection{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Fs.SEQ,e),this.items=[]}add(e){this.items.push(e)}delete(e){let t=Ps(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){let s=Ps(e);if(typeof s!="number")return;let i=this.items[s];return!t&&Fs.isScalar(i)?i.value:i}has(e){let t=Ps(e);return typeof t=="number"&&t<this.items.length}set(e,t){let s=Ps(e);if(typeof s!="number")throw new Error(`Expected a valid index, not ${e}.`);let i=this.items[s];Fs.isScalar(i)&&_y.isScalarValue(t)?i.value=t:this.items[s]=t}toJSON(e,t){let s=[];t!=null&&t.onCreate&&t.onCreate(s);let i=0;for(let r of this.items)s.push(Ty.toJS(r,String(i++),t));return s}toString(e,t,s){return e?Sy.stringifyCollection(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:s,onComment:t}):JSON.stringify(this)}static from(e,t,s){let{replacer:i}=s,r=new this(e);if(t&&Symbol.iterator in Object(t)){let o=0;for(let a of t){if(typeof i=="function"){let c=t instanceof Set?a:String(o++);a=i.call(t,c,a)}r.items.push(by.createNode(a,void 0,s))}}return r}};u(yn,"YAMLSeq");var pn=yn;function Ps(n){let e=Fs.isScalar(n)?n.value:n;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}u(Ps,"asItemIndex");Ml.YAMLSeq=pn});var et=w(Fl=>{"use strict";var vy=D(),Pl=Ne(),ky={collection:"seq",default:!0,nodeClass:Pl.YAMLSeq,tag:"tag:yaml.org,2002:seq",resolve(n,e){return vy.isSeq(n)||e("Expected a sequence for this tag"),n},createNode:u((n,e,t)=>Pl.YAMLSeq.from(n,e,t),"createNode")};Fl.seq=ky});var It=w(xl=>{"use strict";var Ny=kt(),Cy={identify:u(n=>typeof n=="string","identify"),default:!0,tag:"tag:yaml.org,2002:str",resolve:u(n=>n,"resolve"),stringify(n,e,t,s){return e=Object.assign({actualString:!0},e),Ny.stringifyString(n,e,t,s)}};xl.string=Cy});var xs=w(zl=>{"use strict";var Ul=x(),jl={identify:u(n=>n==null,"identify"),createNode:u(()=>new Ul.Scalar(null),"createNode"),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:u(()=>new Ul.Scalar(null),"resolve"),stringify:u(({source:n},e)=>typeof n=="string"&&jl.test.test(n)?n:e.options.nullStr,"stringify")};zl.nullTag=jl});var gn=w(Kl=>{"use strict";var Ay=x(),Bl={identify:u(n=>typeof n=="boolean","identify"),default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:u(n=>new Ay.Scalar(n[0]==="t"||n[0]==="T"),"resolve"),stringify({source:n,value:e},t){if(n&&Bl.test.test(n)){let s=n[0]==="t"||n[0]==="T";if(e===s)return n}return e?t.options.trueStr:t.options.falseStr}};Kl.boolTag=Bl});var tt=w(Yl=>{"use strict";function Oy({format:n,minFractionDigits:e,tag:t,value:s}){if(typeof s=="bigint")return String(s);let i=typeof s=="number"?s:Number(s);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let r=JSON.stringify(s);if(!n&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let o=r.indexOf(".");o<0&&(o=r.length,r+=".");let a=e-(r.length-o-1);for(;a-- >0;)r+="0"}return r}u(Oy,"stringifyNumber");Yl.stringifyNumber=Oy});var bn=w(Us=>{"use strict";var Iy=x(),wn=tt(),Dy={identify:u(n=>typeof n=="number","identify"),default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:u(n=>n.slice(-3).toLowerCase()==="nan"?NaN:n[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,"resolve"),stringify:wn.stringifyNumber},Ly={identify:u(n=>typeof n=="number","identify"),default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:u(n=>parseFloat(n),"resolve"),stringify(n){let e=Number(n.value);return isFinite(e)?e.toExponential():wn.stringifyNumber(n)}},Ry={identify:u(n=>typeof n=="number","identify"),default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(n){let e=new Iy.Scalar(parseFloat(n)),t=n.indexOf(".");return t!==-1&&n[n.length-1]==="0"&&(e.minFractionDigits=n.length-t-1),e},stringify:wn.stringifyNumber};Us.float=Ry;Us.floatExp=Ly;Us.floatNaN=Dy});var En=w(zs=>{"use strict";var Wl=tt(),js=u(n=>typeof n=="bigint"||Number.isInteger(n),"intIdentify"),Sn=u((n,e,t,{intAsBigInt:s})=>s?BigInt(n):parseInt(n.substring(e),t),"intResolve");function Gl(n,e,t){let{value:s}=n;return js(s)&&s>=0?t+s.toString(e):Wl.stringifyNumber(n)}u(Gl,"intStringify");var qy={identify:u(n=>js(n)&&n>=0,"identify"),default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:u((n,e,t)=>Sn(n,2,8,t),"resolve"),stringify:u(n=>Gl(n,8,"0o"),"stringify")},$y={identify:js,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:u((n,e,t)=>Sn(n,0,10,t),"resolve"),stringify:Wl.stringifyNumber},My={identify:u(n=>js(n)&&n>=0,"identify"),default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:u((n,e,t)=>Sn(n,2,16,t),"resolve"),stringify:u(n=>Gl(n,16,"0x"),"stringify")};zs.int=$y;zs.intHex=My;zs.intOct=qy});var Vl=w(Jl=>{"use strict";var Py=Ze(),Fy=xs(),xy=et(),Uy=It(),jy=gn(),_n=bn(),Tn=En(),zy=[Py.map,xy.seq,Uy.string,Fy.nullTag,jy.boolTag,Tn.intOct,Tn.int,Tn.intHex,_n.floatNaN,_n.floatExp,_n.float];Jl.schema=zy});var Ql=w(Hl=>{"use strict";var By=x(),Ky=Ze(),Yy=et();function Xl(n){return typeof n=="bigint"||Number.isInteger(n)}u(Xl,"intIdentify");var Bs=u(({value:n})=>JSON.stringify(n),"stringifyJSON"),Wy=[{identify:u(n=>typeof n=="string","identify"),default:!0,tag:"tag:yaml.org,2002:str",resolve:u(n=>n,"resolve"),stringify:Bs},{identify:u(n=>n==null,"identify"),createNode:u(()=>new By.Scalar(null),"createNode"),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:u(()=>null,"resolve"),stringify:Bs},{identify:u(n=>typeof n=="boolean","identify"),default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:u(n=>n==="true","resolve"),stringify:Bs},{identify:Xl,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:u((n,e,{intAsBigInt:t})=>t?BigInt(n):parseInt(n,10),"resolve"),stringify:u(({value:n})=>Xl(n)?n.toString():JSON.stringify(n),"stringify")},{identify:u(n=>typeof n=="number","identify"),default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:u(n=>parseFloat(n),"resolve"),stringify:Bs}],Gy={default:!0,tag:"",test:/^/,resolve(n,e){return e(`Unresolved plain scalar ${JSON.stringify(n)}`),n}},Jy=[Ky.map,Yy.seq].concat(Wy,Gy);Hl.schema=Jy});var kn=w(Zl=>{"use strict";var Dt=require("buffer"),vn=x(),Vy=kt(),Xy={identify:u(n=>n instanceof Uint8Array,"identify"),default:!1,tag:"tag:yaml.org,2002:binary",resolve(n,e){if(typeof Dt.Buffer=="function")return Dt.Buffer.from(n,"base64");if(typeof atob=="function"){let t=atob(n.replace(/[\n\r]/g,"")),s=new Uint8Array(t.length);for(let i=0;i<t.length;++i)s[i]=t.charCodeAt(i);return s}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),n},stringify({comment:n,type:e,value:t},s,i,r){if(!t)return"";let o=t,a;if(typeof Dt.Buffer=="function")a=o instanceof Dt.Buffer?o.toString("base64"):Dt.Buffer.from(o.buffer).toString("base64");else if(typeof btoa=="function"){let c="";for(let l=0;l<o.length;++l)c+=String.fromCharCode(o[l]);a=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e??(e=vn.Scalar.BLOCK_LITERAL),e!==vn.Scalar.QUOTE_DOUBLE){let c=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),l=Math.ceil(a.length/c),h=new Array(l);for(let d=0,f=0;d<l;++d,f+=c)h[d]=a.substr(f,c);a=h.join(e===vn.Scalar.BLOCK_LITERAL?`
`:" ")}return Vy.stringifyString({comment:n,type:e,value:a},s,i,r)}};Zl.binary=Xy});var Ws=w(Ys=>{"use strict";var Ks=D(),Nn=Te(),Hy=x(),Qy=Ne();function eu(n,e){if(Ks.isSeq(n))for(let t=0;t<n.items.length;++t){let s=n.items[t];if(!Ks.isPair(s)){if(Ks.isMap(s)){s.items.length>1&&e("Each pair must have its own sequence indicator");let i=s.items[0]||new Nn.Pair(new Hy.Scalar(null));if(s.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${s.commentBefore}
${i.key.commentBefore}`:s.commentBefore),s.comment){let r=i.value??i.key;r.comment=r.comment?`${s.comment}
${r.comment}`:s.comment}s=i}n.items[t]=Ks.isPair(s)?s:new Nn.Pair(s)}}else e("Expected a sequence for this tag");return n}u(eu,"resolvePairs");function tu(n,e,t){let{replacer:s}=t,i=new Qy.YAMLSeq(n);i.tag="tag:yaml.org,2002:pairs";let r=0;if(e&&Symbol.iterator in Object(e))for(let o of e){typeof s=="function"&&(o=s.call(e,String(r++),o));let a,c;if(Array.isArray(o))if(o.length===2)a=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){let l=Object.keys(o);if(l.length===1)a=l[0],c=o[a];else throw new TypeError(`Expected tuple with one key, not ${l.length} keys`)}else a=o;i.items.push(Nn.createPair(a,c,t))}return i}u(tu,"createPairs");var Zy={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:eu,createNode:tu};Ys.createPairs=tu;Ys.pairs=Zy;Ys.resolvePairs=eu});var On=w(An=>{"use strict";var su=D(),Cn=be(),Lt=ke(),eg=Ne(),iu=Ws(),Gs=class Gs extends eg.YAMLSeq{constructor(){super(),this.add=Lt.YAMLMap.prototype.add.bind(this),this.delete=Lt.YAMLMap.prototype.delete.bind(this),this.get=Lt.YAMLMap.prototype.get.bind(this),this.has=Lt.YAMLMap.prototype.has.bind(this),this.set=Lt.YAMLMap.prototype.set.bind(this),this.tag=Gs.tag}toJSON(e,t){if(!t)return super.toJSON(e);let s=new Map;t!=null&&t.onCreate&&t.onCreate(s);for(let i of this.items){let r,o;if(su.isPair(i)?(r=Cn.toJS(i.key,"",t),o=Cn.toJS(i.value,r,t)):r=Cn.toJS(i,"",t),s.has(r))throw new Error("Ordered maps must not include duplicate keys");s.set(r,o)}return s}static from(e,t,s){let i=iu.createPairs(e,t,s),r=new this;return r.items=i.items,r}};u(Gs,"YAMLOMap");var Pe=Gs;Pe.tag="tag:yaml.org,2002:omap";var tg={collection:"seq",identify:u(n=>n instanceof Map,"identify"),nodeClass:Pe,default:!1,tag:"tag:yaml.org,2002:omap",resolve(n,e){let t=iu.resolvePairs(n,e),s=[];for(let{key:i}of t.items)su.isScalar(i)&&(s.includes(i.value)?e(`Ordered maps must not include duplicate keys: ${i.value}`):s.push(i.value));return Object.assign(new Pe,t)},createNode:u((n,e,t)=>Pe.from(n,e,t),"createNode")};An.YAMLOMap=Pe;An.omap=tg});var cu=w(In=>{"use strict";var nu=x();function ru({value:n,source:e},t){return e&&(n?ou:au).test.test(e)?e:n?t.options.trueStr:t.options.falseStr}u(ru,"boolStringify");var ou={identify:u(n=>n===!0,"identify"),default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:u(()=>new nu.Scalar(!0),"resolve"),stringify:ru},au={identify:u(n=>n===!1,"identify"),default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:u(()=>new nu.Scalar(!1),"resolve"),stringify:ru};In.falseTag=au;In.trueTag=ou});var lu=w(Js=>{"use strict";var sg=x(),Dn=tt(),ig={identify:u(n=>typeof n=="number","identify"),default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:u(n=>n.slice(-3).toLowerCase()==="nan"?NaN:n[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,"resolve"),stringify:Dn.stringifyNumber},ng={identify:u(n=>typeof n=="number","identify"),default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:u(n=>parseFloat(n.replace(/_/g,"")),"resolve"),stringify(n){let e=Number(n.value);return isFinite(e)?e.toExponential():Dn.stringifyNumber(n)}},rg={identify:u(n=>typeof n=="number","identify"),default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(n){let e=new sg.Scalar(parseFloat(n.replace(/_/g,""))),t=n.indexOf(".");if(t!==-1){let s=n.substring(t+1).replace(/_/g,"");s[s.length-1]==="0"&&(e.minFractionDigits=s.length)}return e},stringify:Dn.stringifyNumber};Js.float=rg;Js.floatExp=ng;Js.floatNaN=ig});var hu=w(qt=>{"use strict";var uu=tt(),Rt=u(n=>typeof n=="bigint"||Number.isInteger(n),"intIdentify");function Vs(n,e,t,{intAsBigInt:s}){let i=n[0];if((i==="-"||i==="+")&&(e+=1),n=n.substring(e).replace(/_/g,""),s){switch(t){case 2:n=`0b${n}`;break;case 8:n=`0o${n}`;break;case 16:n=`0x${n}`;break}let o=BigInt(n);return i==="-"?BigInt(-1)*o:o}let r=parseInt(n,t);return i==="-"?-1*r:r}u(Vs,"intResolve");function Ln(n,e,t){let{value:s}=n;if(Rt(s)){let i=s.toString(e);return s<0?"-"+t+i.substr(1):t+i}return uu.stringifyNumber(n)}u(Ln,"intStringify");var og={identify:Rt,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:u((n,e,t)=>Vs(n,2,2,t),"resolve"),stringify:u(n=>Ln(n,2,"0b"),"stringify")},ag={identify:Rt,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:u((n,e,t)=>Vs(n,1,8,t),"resolve"),stringify:u(n=>Ln(n,8,"0"),"stringify")},cg={identify:Rt,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:u((n,e,t)=>Vs(n,0,10,t),"resolve"),stringify:uu.stringifyNumber},lg={identify:Rt,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:u((n,e,t)=>Vs(n,2,16,t),"resolve"),stringify:u(n=>Ln(n,16,"0x"),"stringify")};qt.int=cg;qt.intBin=og;qt.intHex=lg;qt.intOct=ag});var qn=w(Rn=>{"use strict";var Qs=D(),Xs=Te(),Hs=ke(),Zs=class Zs extends Hs.YAMLMap{constructor(e){super(e),this.tag=Zs.tag}add(e){let t;Qs.isPair(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new Xs.Pair(e.key,null):t=new Xs.Pair(e,null),Hs.findPair(this.items,t.key)||this.items.push(t)}get(e,t){let s=Hs.findPair(this.items,e);return!t&&Qs.isPair(s)?Qs.isScalar(s.key)?s.key.value:s.key:s}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);let s=Hs.findPair(this.items,e);s&&!t?this.items.splice(this.items.indexOf(s),1):!s&&t&&this.items.push(new Xs.Pair(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,s){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,s);throw new Error("Set items must all have null values")}static from(e,t,s){let{replacer:i}=s,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let o of t)typeof i=="function"&&(o=i.call(t,o,o)),r.items.push(Xs.createPair(o,null,s));return r}};u(Zs,"YAMLSet");var Fe=Zs;Fe.tag="tag:yaml.org,2002:set";var ug={collection:"map",identify:u(n=>n instanceof Set,"identify"),nodeClass:Fe,default:!1,tag:"tag:yaml.org,2002:set",createNode:u((n,e,t)=>Fe.from(n,e,t),"createNode"),resolve(n,e){if(Qs.isMap(n)){if(n.hasAllNullValues(!0))return Object.assign(new Fe,n);e("Set items must all have null values")}else e("Expected a mapping for this tag");return n}};Rn.YAMLSet=Fe;Rn.set=ug});var Mn=w(ei=>{"use strict";var hg=tt();function $n(n,e){let t=n[0],s=t==="-"||t==="+"?n.substring(1):n,i=u(o=>e?BigInt(o):Number(o),"num"),r=s.replace(/_/g,"").split(":").reduce((o,a)=>o*i(60)+i(a),i(0));return t==="-"?i(-1)*r:r}u($n,"parseSexagesimal");function du(n){let{value:e}=n,t=u(o=>o,"num");if(typeof e=="bigint")t=u(o=>BigInt(o),"num");else if(isNaN(e)||!isFinite(e))return hg.stringifyNumber(n);let s="";e<0&&(s="-",e*=t(-1));let i=t(60),r=[e%i];return e<60?r.unshift(0):(e=(e-r[0])/i,r.unshift(e%i),e>=60&&(e=(e-r[0])/i,r.unshift(e))),s+r.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}u(du,"stringifySexagesimal");var dg={identify:u(n=>typeof n=="bigint"||Number.isInteger(n),"identify"),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:u((n,e,{intAsBigInt:t})=>$n(n,t),"resolve"),stringify:du},fg={identify:u(n=>typeof n=="number","identify"),default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:u(n=>$n(n,!1),"resolve"),stringify:du},fu={identify:u(n=>n instanceof Date,"identify"),default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(n){let e=n.match(fu.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");let[,t,s,i,r,o,a]=e.map(Number),c=e[7]?Number((e[7]+"00").substr(1,3)):0,l=Date.UTC(t,s-1,i,r||0,o||0,a||0,c),h=e[8];if(h&&h!=="Z"){let d=$n(h,!1);Math.abs(d)<30&&(d*=60),l-=6e4*d}return new Date(l)},stringify:u(({value:n})=>(n==null?void 0:n.toISOString().replace(/(T00:00:00)?\.000Z$/,""))??"","stringify")};ei.floatTime=fg;ei.intTime=dg;ei.timestamp=fu});var yu=w(pu=>{"use strict";var mg=Ze(),pg=xs(),yg=et(),gg=It(),wg=kn(),mu=cu(),Pn=lu(),ti=hu(),bg=Is(),Sg=On(),Eg=Ws(),_g=qn(),Fn=Mn(),Tg=[mg.map,yg.seq,gg.string,pg.nullTag,mu.trueTag,mu.falseTag,ti.intBin,ti.intOct,ti.int,ti.intHex,Pn.floatNaN,Pn.floatExp,Pn.float,wg.binary,bg.merge,Sg.omap,Eg.pairs,_g.set,Fn.intTime,Fn.floatTime,Fn.timestamp];pu.schema=Tg});var Nu=w(jn=>{"use strict";var Su=Ze(),vg=xs(),Eu=et(),kg=It(),Ng=gn(),xn=bn(),Un=En(),Cg=Vl(),Ag=Ql(),_u=kn(),$t=Is(),Tu=On(),vu=Ws(),gu=yu(),ku=qn(),si=Mn(),wu=new Map([["core",Cg.schema],["failsafe",[Su.map,Eu.seq,kg.string]],["json",Ag.schema],["yaml11",gu.schema],["yaml-1.1",gu.schema]]),bu={binary:_u.binary,bool:Ng.boolTag,float:xn.float,floatExp:xn.floatExp,floatNaN:xn.floatNaN,floatTime:si.floatTime,int:Un.int,intHex:Un.intHex,intOct:Un.intOct,intTime:si.intTime,map:Su.map,merge:$t.merge,null:vg.nullTag,omap:Tu.omap,pairs:vu.pairs,seq:Eu.seq,set:ku.set,timestamp:si.timestamp},Og={"tag:yaml.org,2002:binary":_u.binary,"tag:yaml.org,2002:merge":$t.merge,"tag:yaml.org,2002:omap":Tu.omap,"tag:yaml.org,2002:pairs":vu.pairs,"tag:yaml.org,2002:set":ku.set,"tag:yaml.org,2002:timestamp":si.timestamp};function Ig(n,e,t){let s=wu.get(e);if(s&&!n)return t&&!s.includes($t.merge)?s.concat($t.merge):s.slice();let i=s;if(!i)if(Array.isArray(n))i=[];else{let r=Array.from(wu.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${r} or define customTags array`)}if(Array.isArray(n))for(let r of n)i=i.concat(r);else typeof n=="function"&&(i=n(i.slice()));return t&&(i=i.concat($t.merge)),i.reduce((r,o)=>{let a=typeof o=="string"?bu[o]:o;if(!a){let c=JSON.stringify(o),l=Object.keys(bu).map(h=>JSON.stringify(h)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${l}`)}return r.includes(a)||r.push(a),r},[])}u(Ig,"getTags");jn.coreKnownTags=Og;jn.getTags=Ig});var Kn=w(Cu=>{"use strict";var zn=D(),Dg=Ze(),Lg=et(),Rg=It(),ii=Nu(),qg=u((n,e)=>n.key<e.key?-1:n.key>e.key?1:0,"sortMapEntriesByKey"),ni=class ni{constructor({compat:e,customTags:t,merge:s,resolveKnownTags:i,schema:r,sortMapEntries:o,toStringDefaults:a}){this.compat=Array.isArray(e)?ii.getTags(e,"compat"):e?ii.getTags(null,e):null,this.name=typeof r=="string"&&r||"core",this.knownTags=i?ii.coreKnownTags:{},this.tags=ii.getTags(t,this.name,s),this.toStringOptions=a??null,Object.defineProperty(this,zn.MAP,{value:Dg.map}),Object.defineProperty(this,zn.SCALAR,{value:Rg.string}),Object.defineProperty(this,zn.SEQ,{value:Lg.seq}),this.sortMapEntries=typeof o=="function"?o:o===!0?qg:null}clone(){let e=Object.create(ni.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}};u(ni,"Schema");var Bn=ni;Cu.Schema=Bn});var Ou=w(Au=>{"use strict";var $g=D(),Yn=Nt(),Mt=_t();function Mg(n,e){var c;let t=[],s=e.directives===!0;if(e.directives!==!1&&n.directives){let l=n.directives.toString(n);l?(t.push(l),s=!0):n.directives.docStart&&(s=!0)}s&&t.push("---");let i=Yn.createStringifyContext(n,e),{commentString:r}=i.options;if(n.commentBefore){t.length!==1&&t.unshift("");let l=r(n.commentBefore);t.unshift(Mt.indentComment(l,""))}let o=!1,a=null;if(n.contents){if($g.isNode(n.contents)){if(n.contents.spaceBefore&&s&&t.push(""),n.contents.commentBefore){let d=r(n.contents.commentBefore);t.push(Mt.indentComment(d,""))}i.forceBlockIndent=!!n.comment,a=n.contents.comment}let l=a?void 0:()=>o=!0,h=Yn.stringify(n.contents,i,()=>a=null,l);a&&(h+=Mt.lineComment(h,"",r(a))),(h[0]==="|"||h[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${h}`:t.push(h)}else t.push(Yn.stringify(n.contents,i));if((c=n.directives)!=null&&c.docEnd)if(n.comment){let l=r(n.comment);l.includes(`
`)?(t.push("..."),t.push(Mt.indentComment(l,""))):t.push(`... ${l}`)}else t.push("...");else{let l=n.comment;l&&o&&(l=l.replace(/^\n+/,"")),l&&((!o||a)&&t[t.length-1]!==""&&t.push(""),t.push(Mt.indentComment(r(l),"")))}return t.join(`
`)+`
`}u(Mg,"stringifyDocument");Au.stringifyDocument=Mg});var Pt=w(Iu=>{"use strict";var Pg=St(),st=Es(),se=D(),Fg=Te(),xg=be(),Ug=Kn(),jg=Ou(),Wn=gs(),zg=Bi(),Bg=Et(),Gn=zi(),ri=class ri{constructor(e,t,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,se.NODE_TYPE,{value:se.DOC});let i=null;typeof t=="function"||Array.isArray(t)?i=t:s===void 0&&t&&(s=t,t=void 0);let r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},s);this.options=r;let{version:o}=r;s!=null&&s._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new Gn.Directives({version:o}),this.setSchema(o,s),this.contents=e===void 0?null:this.createNode(e,i,s)}clone(){let e=Object.create(ri.prototype,{[se.NODE_TYPE]:{value:se.DOC}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=se.isNode(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){it(this.contents)&&this.contents.add(e)}addIn(e,t){it(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){let s=Wn.anchorNames(this);e.anchor=!t||s.has(t)?Wn.findNewAnchor(t||"a",s):t}return new Pg.Alias(e.anchor)}createNode(e,t,s){let i;if(typeof t=="function")e=t.call({"":e},"",e),i=t;else if(Array.isArray(t)){let g=u(S=>typeof S=="number"||S instanceof String||S instanceof Number,"keyToStr"),b=t.filter(g).map(String);b.length>0&&(t=t.concat(b)),i=t}else s===void 0&&t&&(s=t,t=void 0);let{aliasDuplicateObjects:r,anchorPrefix:o,flow:a,keepUndefined:c,onTagObj:l,tag:h}=s??{},{onAnchor:d,setAnchors:f,sourceObjects:m}=Wn.createNodeAnchors(this,o||"a"),y={aliasDuplicateObjects:r??!0,keepUndefined:c??!1,onAnchor:d,onTagObj:l,replacer:i,schema:this.schema,sourceObjects:m},p=Bg.createNode(e,h,y);return a&&se.isCollection(p)&&(p.flow=!0),f(),p}createPair(e,t,s={}){let i=this.createNode(e,null,s),r=this.createNode(t,null,s);return new Fg.Pair(i,r)}delete(e){return it(this.contents)?this.contents.delete(e):!1}deleteIn(e){return st.isEmptyPath(e)?this.contents==null?!1:(this.contents=null,!0):it(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return se.isCollection(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return st.isEmptyPath(e)?!t&&se.isScalar(this.contents)?this.contents.value:this.contents:se.isCollection(this.contents)?this.contents.getIn(e,t):void 0}has(e){return se.isCollection(this.contents)?this.contents.has(e):!1}hasIn(e){return st.isEmptyPath(e)?this.contents!==void 0:se.isCollection(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=st.collectionFromPath(this.schema,[e],t):it(this.contents)&&this.contents.set(e,t)}setIn(e,t){st.isEmptyPath(e)?this.contents=t:this.contents==null?this.contents=st.collectionFromPath(this.schema,Array.from(e),t):it(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let s;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new Gn.Directives({version:"1.1"}),s={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new Gn.Directives({version:e}),s={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{let i=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${i}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(s)this.schema=new Ug.Schema(Object.assign(s,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:s,maxAliasCount:i,onAnchor:r,reviver:o}={}){let a={anchors:new Map,doc:this,keep:!e,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},c=xg.toJS(this.contents,t??"",a);if(typeof r=="function")for(let{count:l,res:h}of a.anchors.values())r(h,l);return typeof o=="function"?zg.applyReviver(o,{"":c},"",c):c}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){let t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return jg.stringifyDocument(this,e)}};u(ri,"Document");var Jn=ri;function it(n){if(se.isCollection(n))return!0;throw new Error("Expected a YAML collection as document contents")}u(it,"assertCollection");Iu.Document=Jn});var Ut=w(xt=>{"use strict";var Hn=class Hn extends Error{constructor(e,t,s,i){super(),this.name=e,this.code=s,this.message=i,this.pos=t}};u(Hn,"YAMLError");var Ft=Hn,Qn=class Qn extends Ft{constructor(e,t,s){super("YAMLParseError",e,t,s)}};u(Qn,"YAMLParseError");var Vn=Qn,Zn=class Zn extends Ft{constructor(e,t,s){super("YAMLWarning",e,t,s)}};u(Zn,"YAMLWarning");var Xn=Zn,Kg=u((n,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(a=>e.linePos(a));let{line:s,col:i}=t.linePos[0];t.message+=` at line ${s}, column ${i}`;let r=i-1,o=n.substring(e.lineStarts[s-1],e.lineStarts[s]).replace(/[\n\r]+$/,"");if(r>=60&&o.length>80){let a=Math.min(r-39,o.length-79);o="\u2026"+o.substring(a),r-=a-1}if(o.length>80&&(o=o.substring(0,79)+"\u2026"),s>1&&/^ *$/.test(o.substring(0,r))){let a=n.substring(e.lineStarts[s-2],e.lineStarts[s-1]);a.length>80&&(a=a.substring(0,79)+`\u2026
`),o=a+o}if(/[^ ]/.test(o)){let a=1,c=t.linePos[1];c&&c.line===s&&c.col>i&&(a=Math.max(1,Math.min(c.col-i,80-r)));let l=" ".repeat(r)+"^".repeat(a);t.message+=`:

${o}
${l}
`}},"prettifyError");xt.YAMLError=Ft;xt.YAMLParseError=Vn;xt.YAMLWarning=Xn;xt.prettifyError=Kg});var jt=w(Du=>{"use strict";function Yg(n,{flow:e,indicator:t,next:s,offset:i,onError:r,parentIndent:o,startOnNewline:a}){let c=!1,l=a,h=a,d="",f="",m=!1,y=!1,p=null,g=null,b=null,S=null,E=null,T=null,_=null;for(let k of n)switch(y&&(k.type!=="space"&&k.type!=="newline"&&k.type!=="comma"&&r(k.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),y=!1),p&&(l&&k.type!=="comment"&&k.type!=="newline"&&r(p,"TAB_AS_INDENT","Tabs are not allowed as indentation"),p=null),k.type){case"space":!e&&(t!=="doc-start"||(s==null?void 0:s.type)!=="flow-collection")&&k.source.includes("	")&&(p=k),h=!0;break;case"comment":{h||r(k,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let N=k.source.substring(1)||" ";d?d+=f+N:d=N,f="",l=!1;break}case"newline":l?d?d+=k.source:(!T||t!=="seq-item-ind")&&(c=!0):f+=k.source,l=!0,m=!0,(g||b)&&(S=k),h=!0;break;case"anchor":g&&r(k,"MULTIPLE_ANCHORS","A node can have at most one anchor"),k.source.endsWith(":")&&r(k.offset+k.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),g=k,_??(_=k.offset),l=!1,h=!1,y=!0;break;case"tag":{b&&r(k,"MULTIPLE_TAGS","A node can have at most one tag"),b=k,_??(_=k.offset),l=!1,h=!1,y=!0;break}case t:(g||b)&&r(k,"BAD_PROP_ORDER",`Anchors and tags must be after the ${k.source} indicator`),T&&r(k,"UNEXPECTED_TOKEN",`Unexpected ${k.source} in ${e??"collection"}`),T=k,l=t==="seq-item-ind"||t==="explicit-key-ind",h=!1;break;case"comma":if(e){E&&r(k,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),E=k,l=!1,h=!1;break}default:r(k,"UNEXPECTED_TOKEN",`Unexpected ${k.type} token`),l=!1,h=!1}let v=n[n.length-1],O=v?v.offset+v.source.length:i;return y&&s&&s.type!=="space"&&s.type!=="newline"&&s.type!=="comma"&&(s.type!=="scalar"||s.source!=="")&&r(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),p&&(l&&p.indent<=o||(s==null?void 0:s.type)==="block-map"||(s==null?void 0:s.type)==="block-seq")&&r(p,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:E,found:T,spaceBefore:c,comment:d,hasNewline:m,anchor:g,tag:b,newlineAfterProp:S,end:O,start:_??O}}u(Yg,"resolveProps");Du.resolveProps=Yg});var oi=w(Lu=>{"use strict";function er(n){if(!n)return null;switch(n.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(n.source.includes(`
`))return!0;if(n.end){for(let e of n.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(let e of n.items){for(let t of e.start)if(t.type==="newline")return!0;if(e.sep){for(let t of e.sep)if(t.type==="newline")return!0}if(er(e.key)||er(e.value))return!0}return!1;default:return!0}}u(er,"containsNewline");Lu.containsNewline=er});var tr=w(Ru=>{"use strict";var Wg=oi();function Gg(n,e,t){if((e==null?void 0:e.type)==="flow-collection"){let s=e.end[0];s.indent===n&&(s.source==="]"||s.source==="}")&&Wg.containsNewline(e)&&t(s,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}u(Gg,"flowIndentCheck");Ru.flowIndentCheck=Gg});var sr=w($u=>{"use strict";var qu=D();function Jg(n,e,t){let{uniqueKeys:s}=n.options;if(s===!1)return!1;let i=typeof s=="function"?s:(r,o)=>r===o||qu.isScalar(r)&&qu.isScalar(o)&&r.value===o.value;return e.some(r=>i(r.key,t))}u(Jg,"mapIncludes");$u.mapIncludes=Jg});var ju=w(Uu=>{"use strict";var Mu=Te(),Vg=ke(),Pu=jt(),Xg=oi(),Fu=tr(),Hg=sr(),xu="All mapping items must start at the same column";function Qg({composeNode:n,composeEmptyNode:e},t,s,i,r){var h;let o=(r==null?void 0:r.nodeClass)??Vg.YAMLMap,a=new o(t.schema);t.atRoot&&(t.atRoot=!1);let c=s.offset,l=null;for(let d of s.items){let{start:f,key:m,sep:y,value:p}=d,g=Pu.resolveProps(f,{indicator:"explicit-key-ind",next:m??(y==null?void 0:y[0]),offset:c,onError:i,parentIndent:s.indent,startOnNewline:!0}),b=!g.found;if(b){if(m&&(m.type==="block-seq"?i(c,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in m&&m.indent!==s.indent&&i(c,"BAD_INDENT",xu)),!g.anchor&&!g.tag&&!y){l=g.end,g.comment&&(a.comment?a.comment+=`
`+g.comment:a.comment=g.comment);continue}(g.newlineAfterProp||Xg.containsNewline(m))&&i(m??f[f.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((h=g.found)==null?void 0:h.indent)!==s.indent&&i(c,"BAD_INDENT",xu);t.atKey=!0;let S=g.end,E=m?n(t,m,g,i):e(t,S,f,null,g,i);t.schema.compat&&Fu.flowIndentCheck(s.indent,m,i),t.atKey=!1,Hg.mapIncludes(t,a.items,E)&&i(S,"DUPLICATE_KEY","Map keys must be unique");let T=Pu.resolveProps(y??[],{indicator:"map-value-ind",next:p,offset:E.range[2],onError:i,parentIndent:s.indent,startOnNewline:!m||m.type==="block-scalar"});if(c=T.end,T.found){b&&((p==null?void 0:p.type)==="block-map"&&!T.hasNewline&&i(c,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&g.start<T.found.offset-1024&&i(E.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));let _=p?n(t,p,T,i):e(t,c,y,null,T,i);t.schema.compat&&Fu.flowIndentCheck(s.indent,p,i),c=_.range[2];let v=new Mu.Pair(E,_);t.options.keepSourceTokens&&(v.srcToken=d),a.items.push(v)}else{b&&i(E.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),T.comment&&(E.comment?E.comment+=`
`+T.comment:E.comment=T.comment);let _=new Mu.Pair(E);t.options.keepSourceTokens&&(_.srcToken=d),a.items.push(_)}}return l&&l<c&&i(l,"IMPOSSIBLE","Map comment with trailing content"),a.range=[s.offset,c,l??c],a}u(Qg,"resolveBlockMap");Uu.resolveBlockMap=Qg});var Bu=w(zu=>{"use strict";var Zg=Ne(),e0=jt(),t0=tr();function s0({composeNode:n,composeEmptyNode:e},t,s,i,r){let o=(r==null?void 0:r.nodeClass)??Zg.YAMLSeq,a=new o(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let c=s.offset,l=null;for(let{start:h,value:d}of s.items){let f=e0.resolveProps(h,{indicator:"seq-item-ind",next:d,offset:c,onError:i,parentIndent:s.indent,startOnNewline:!0});if(!f.found)if(f.anchor||f.tag||d)d&&d.type==="block-seq"?i(f.end,"BAD_INDENT","All sequence items must start at the same column"):i(c,"MISSING_CHAR","Sequence item without - indicator");else{l=f.end,f.comment&&(a.comment=f.comment);continue}let m=d?n(t,d,f,i):e(t,f.end,h,null,f,i);t.schema.compat&&t0.flowIndentCheck(s.indent,d,i),c=m.range[2],a.items.push(m)}return a.range=[s.offset,c,l??c],a}u(s0,"resolveBlockSeq");zu.resolveBlockSeq=s0});var nt=w(Ku=>{"use strict";function i0(n,e,t,s){let i="";if(n){let r=!1,o="";for(let a of n){let{source:c,type:l}=a;switch(l){case"space":r=!0;break;case"comment":{t&&!r&&s(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let h=c.substring(1)||" ";i?i+=o+h:i=h,o="";break}case"newline":i&&(o+=c),r=!0;break;default:s(a,"UNEXPECTED_TOKEN",`Unexpected ${l} at node end`)}e+=c.length}}return{comment:i,offset:e}}u(i0,"resolveEnd");Ku.resolveEnd=i0});var Ju=w(Gu=>{"use strict";var n0=D(),r0=Te(),Yu=ke(),o0=Ne(),a0=nt(),Wu=jt(),c0=oi(),l0=sr(),ir="Block collections are not allowed within flow collections",nr=u(n=>n&&(n.type==="block-map"||n.type==="block-seq"),"isBlock");function u0({composeNode:n,composeEmptyNode:e},t,s,i,r){let o=s.start.source==="{",a=o?"flow map":"flow sequence",c=(r==null?void 0:r.nodeClass)??(o?Yu.YAMLMap:o0.YAMLSeq),l=new c(t.schema);l.flow=!0;let h=t.atRoot;h&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let d=s.offset+s.start.source.length;for(let g=0;g<s.items.length;++g){let b=s.items[g],{start:S,key:E,sep:T,value:_}=b,v=Wu.resolveProps(S,{flow:a,indicator:"explicit-key-ind",next:E??(T==null?void 0:T[0]),offset:d,onError:i,parentIndent:s.indent,startOnNewline:!1});if(!v.found){if(!v.anchor&&!v.tag&&!T&&!_){g===0&&v.comma?i(v.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):g<s.items.length-1&&i(v.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),v.comment&&(l.comment?l.comment+=`
`+v.comment:l.comment=v.comment),d=v.end;continue}!o&&t.options.strict&&c0.containsNewline(E)&&i(E,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(g===0)v.comma&&i(v.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(v.comma||i(v.start,"MISSING_CHAR",`Missing , between ${a} items`),v.comment){let O="";e:for(let k of S)switch(k.type){case"comma":case"space":break;case"comment":O=k.source.substring(1);break e;default:break e}if(O){let k=l.items[l.items.length-1];n0.isPair(k)&&(k=k.value??k.key),k.comment?k.comment+=`
`+O:k.comment=O,v.comment=v.comment.substring(O.length+1)}}if(!o&&!T&&!v.found){let O=_?n(t,_,v,i):e(t,v.end,T,null,v,i);l.items.push(O),d=O.range[2],nr(_)&&i(O.range,"BLOCK_IN_FLOW",ir)}else{t.atKey=!0;let O=v.end,k=E?n(t,E,v,i):e(t,O,S,null,v,i);nr(E)&&i(k.range,"BLOCK_IN_FLOW",ir),t.atKey=!1;let N=Wu.resolveProps(T??[],{flow:a,indicator:"map-value-ind",next:_,offset:k.range[2],onError:i,parentIndent:s.indent,startOnNewline:!1});if(N.found){if(!o&&!v.found&&t.options.strict){if(T)for(let I of T){if(I===N.found)break;if(I.type==="newline"){i(I,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}v.start<N.found.offset-1024&&i(N.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else _&&("source"in _&&_.source&&_.source[0]===":"?i(_,"MISSING_CHAR",`Missing space after : in ${a}`):i(N.start,"MISSING_CHAR",`Missing , or : between ${a} items`));let C=_?n(t,_,N,i):N.found?e(t,N.end,T,null,N,i):null;C?nr(_)&&i(C.range,"BLOCK_IN_FLOW",ir):N.comment&&(k.comment?k.comment+=`
`+N.comment:k.comment=N.comment);let A=new r0.Pair(k,C);if(t.options.keepSourceTokens&&(A.srcToken=b),o){let I=l;l0.mapIncludes(t,I.items,k)&&i(O,"DUPLICATE_KEY","Map keys must be unique"),I.items.push(A)}else{let I=new Yu.YAMLMap(t.schema);I.flow=!0,I.items.push(A);let F=(C??k).range;I.range=[k.range[0],F[1],F[2]],l.items.push(I)}d=C?C.range[2]:N.end}}let f=o?"}":"]",[m,...y]=s.end,p=d;if(m&&m.source===f)p=m.offset+m.source.length;else{let g=a[0].toUpperCase()+a.substring(1),b=h?`${g} must end with a ${f}`:`${g} in block collection must be sufficiently indented and end with a ${f}`;i(d,h?"MISSING_CHAR":"BAD_INDENT",b),m&&m.source.length!==1&&y.unshift(m)}if(y.length>0){let g=a0.resolveEnd(y,p,t.options.strict,i);g.comment&&(l.comment?l.comment+=`
`+g.comment:l.comment=g.comment),l.range=[s.offset,p,g.offset]}else l.range=[s.offset,p,p];return l}u(u0,"resolveFlowCollection");Gu.resolveFlowCollection=u0});var Xu=w(Vu=>{"use strict";var h0=D(),d0=x(),f0=ke(),m0=Ne(),p0=ju(),y0=Bu(),g0=Ju();function rr(n,e,t,s,i,r){let o=t.type==="block-map"?p0.resolveBlockMap(n,e,t,s,r):t.type==="block-seq"?y0.resolveBlockSeq(n,e,t,s,r):g0.resolveFlowCollection(n,e,t,s,r),a=o.constructor;return i==="!"||i===a.tagName?(o.tag=a.tagName,o):(i&&(o.tag=i),o)}u(rr,"resolveCollection");function w0(n,e,t,s,i){var f;let r=s.tag,o=r?e.directives.tagName(r.source,m=>i(r,"TAG_RESOLVE_FAILED",m)):null;if(t.type==="block-seq"){let{anchor:m,newlineAfterProp:y}=s,p=m&&r?m.offset>r.offset?m:r:m??r;p&&(!y||y.offset<p.offset)&&i(p,"MISSING_CHAR","Missing newline after block sequence props")}let a=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!r||!o||o==="!"||o===f0.YAMLMap.tagName&&a==="map"||o===m0.YAMLSeq.tagName&&a==="seq")return rr(n,e,t,i,o);let c=e.schema.tags.find(m=>m.tag===o&&m.collection===a);if(!c){let m=e.schema.knownTags[o];if(m&&m.collection===a)e.schema.tags.push(Object.assign({},m,{default:!1})),c=m;else return m?i(r,"BAD_COLLECTION_TYPE",`${m.tag} used for ${a} collection, but expects ${m.collection??"scalar"}`,!0):i(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),rr(n,e,t,i,o)}let l=rr(n,e,t,i,o,c),h=((f=c.resolve)==null?void 0:f.call(c,l,m=>i(r,"TAG_RESOLVE_FAILED",m),e.options))??l,d=h0.isNode(h)?h:new d0.Scalar(h);return d.range=l.range,d.tag=o,c!=null&&c.format&&(d.format=c.format),d}u(w0,"composeCollection");Vu.composeCollection=w0});var ar=w(Hu=>{"use strict";var or=x();function b0(n,e,t){let s=e.offset,i=S0(e,n.options.strict,t);if(!i)return{value:"",type:null,comment:"",range:[s,s,s]};let r=i.mode===">"?or.Scalar.BLOCK_FOLDED:or.Scalar.BLOCK_LITERAL,o=e.source?E0(e.source):[],a=o.length;for(let p=o.length-1;p>=0;--p){let g=o[p][1];if(g===""||g==="\r")a=p;else break}if(a===0){let p=i.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"",g=s+i.length;return e.source&&(g+=e.source.length),{value:p,type:r,comment:i.comment,range:[s,g,g]}}let c=e.indent+i.indent,l=e.offset+i.length,h=0;for(let p=0;p<a;++p){let[g,b]=o[p];if(b===""||b==="\r")i.indent===0&&g.length>c&&(c=g.length);else{g.length<c&&t(l+g.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),i.indent===0&&(c=g.length),h=p,c===0&&!n.atRoot&&t(l,"BAD_INDENT","Block scalar values in collections must be indented");break}l+=g.length+b.length+1}for(let p=o.length-1;p>=a;--p)o[p][0].length>c&&(a=p+1);let d="",f="",m=!1;for(let p=0;p<h;++p)d+=o[p][0].slice(c)+`
`;for(let p=h;p<a;++p){let[g,b]=o[p];l+=g.length+b.length+1;let S=b[b.length-1]==="\r";if(S&&(b=b.slice(0,-1)),b&&g.length<c){let T=`Block scalar lines must not be less indented than their ${i.indent?"explicit indentation indicator":"first line"}`;t(l-b.length-(S?2:1),"BAD_INDENT",T),g=""}r===or.Scalar.BLOCK_LITERAL?(d+=f+g.slice(c)+b,f=`
`):g.length>c||b[0]==="	"?(f===" "?f=`
`:!m&&f===`
`&&(f=`

`),d+=f+g.slice(c)+b,f=`
`,m=!0):b===""?f===`
`?d+=`
`:f=`
`:(d+=f+b,f=" ",m=!1)}switch(i.chomp){case"-":break;case"+":for(let p=a;p<o.length;++p)d+=`
`+o[p][0].slice(c);d[d.length-1]!==`
`&&(d+=`
`);break;default:d+=`
`}let y=s+i.length+e.source.length;return{value:d,type:r,comment:i.comment,range:[s,y,y]}}u(b0,"resolveBlockScalar");function S0({offset:n,props:e},t,s){if(e[0].type!=="block-scalar-header")return s(e[0],"IMPOSSIBLE","Block scalar header not found"),null;let{source:i}=e[0],r=i[0],o=0,a="",c=-1;for(let f=1;f<i.length;++f){let m=i[f];if(!a&&(m==="-"||m==="+"))a=m;else{let y=Number(m);!o&&y?o=y:c===-1&&(c=n+f)}}c!==-1&&s(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${i}`);let l=!1,h="",d=i.length;for(let f=1;f<e.length;++f){let m=e[f];switch(m.type){case"space":l=!0;case"newline":d+=m.source.length;break;case"comment":t&&!l&&s(m,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),d+=m.source.length,h=m.source.substring(1);break;case"error":s(m,"UNEXPECTED_TOKEN",m.message),d+=m.source.length;break;default:{let y=`Unexpected token in block scalar header: ${m.type}`;s(m,"UNEXPECTED_TOKEN",y);let p=m.source;p&&typeof p=="string"&&(d+=p.length)}}}return{mode:r,indent:o,chomp:a,comment:h,length:d}}u(S0,"parseBlockScalarHeader");function E0(n){let e=n.split(/\n( *)/),t=e[0],s=t.match(/^( *)/),r=[s!=null&&s[1]?[s[1],t.slice(s[1].length)]:["",t]];for(let o=1;o<e.length;o+=2)r.push([e[o],e[o+1]]);return r}u(E0,"splitLines");Hu.resolveBlockScalar=b0});var lr=w(Zu=>{"use strict";var cr=x(),_0=nt();function T0(n,e,t){let{offset:s,type:i,source:r,end:o}=n,a,c,l=u((f,m,y)=>t(s+f,m,y),"_onError");switch(i){case"scalar":a=cr.Scalar.PLAIN,c=v0(r,l);break;case"single-quoted-scalar":a=cr.Scalar.QUOTE_SINGLE,c=k0(r,l);break;case"double-quoted-scalar":a=cr.Scalar.QUOTE_DOUBLE,c=N0(r,l);break;default:return t(n,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${i}`),{value:"",type:null,comment:"",range:[s,s+r.length,s+r.length]}}let h=s+r.length,d=_0.resolveEnd(o,h,e,t);return{value:c,type:a,comment:d.comment,range:[s,h,d.offset]}}u(T0,"resolveFlowScalar");function v0(n,e){let t="";switch(n[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${n[0]}`;break}case"@":case"`":{t=`reserved character ${n[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),Qu(n)}u(v0,"plainValue");function k0(n,e){return(n[n.length-1]!=="'"||n.length===1)&&e(n.length,"MISSING_CHAR","Missing closing 'quote"),Qu(n.slice(1,-1)).replace(/''/g,"'")}u(k0,"singleQuotedValue");function Qu(n){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=e.exec(n);if(!s)return n;let i=s[1],r=" ",o=e.lastIndex;for(t.lastIndex=o;s=t.exec(n);)s[1]===""?r===`
`?i+=r:r=`
`:(i+=r+s[1],r=" "),o=t.lastIndex;let a=/[ \t]*(.*)/sy;return a.lastIndex=o,s=a.exec(n),i+r+((s==null?void 0:s[1])??"")}u(Qu,"foldLines");function N0(n,e){let t="";for(let s=1;s<n.length-1;++s){let i=n[s];if(!(i==="\r"&&n[s+1]===`
`))if(i===`
`){let{fold:r,offset:o}=C0(n,s);t+=r,s=o}else if(i==="\\"){let r=n[++s],o=A0[r];if(o)t+=o;else if(r===`
`)for(r=n[s+1];r===" "||r==="	";)r=n[++s+1];else if(r==="\r"&&n[s+1]===`
`)for(r=n[++s+1];r===" "||r==="	";)r=n[++s+1];else if(r==="x"||r==="u"||r==="U"){let a={x:2,u:4,U:8}[r];t+=O0(n,s+1,a,e),s+=a}else{let a=n.substr(s-1,2);e(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),t+=a}}else if(i===" "||i==="	"){let r=s,o=n[s+1];for(;o===" "||o==="	";)o=n[++s+1];o!==`
`&&!(o==="\r"&&n[s+2]===`
`)&&(t+=s>r?n.slice(r,s+1):i)}else t+=i}return(n[n.length-1]!=='"'||n.length===1)&&e(n.length,"MISSING_CHAR",'Missing closing "quote'),t}u(N0,"doubleQuotedValue");function C0(n,e){let t="",s=n[e+1];for(;(s===" "||s==="	"||s===`
`||s==="\r")&&!(s==="\r"&&n[e+2]!==`
`);)s===`
`&&(t+=`
`),e+=1,s=n[e+1];return t||(t=" "),{fold:t,offset:e}}u(C0,"foldNewline");var A0={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"\x85",_:"\xA0",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function O0(n,e,t,s){let i=n.substr(e,t),o=i.length===t&&/^[0-9a-fA-F]+$/.test(i)?parseInt(i,16):NaN;if(isNaN(o)){let a=n.substr(e-2,t+2);return s(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),a}return String.fromCodePoint(o)}u(O0,"parseCharCode");Zu.resolveFlowScalar=T0});var sh=w(th=>{"use strict";var xe=D(),eh=x(),I0=ar(),D0=lr();function L0(n,e,t,s){let{value:i,type:r,comment:o,range:a}=e.type==="block-scalar"?I0.resolveBlockScalar(n,e,s):D0.resolveFlowScalar(e,n.options.strict,s),c=t?n.directives.tagName(t.source,d=>s(t,"TAG_RESOLVE_FAILED",d)):null,l;n.options.stringKeys&&n.atKey?l=n.schema[xe.SCALAR]:c?l=R0(n.schema,i,c,t,s):e.type==="scalar"?l=q0(n,i,e,s):l=n.schema[xe.SCALAR];let h;try{let d=l.resolve(i,f=>s(t??e,"TAG_RESOLVE_FAILED",f),n.options);h=xe.isScalar(d)?d:new eh.Scalar(d)}catch(d){let f=d instanceof Error?d.message:String(d);s(t??e,"TAG_RESOLVE_FAILED",f),h=new eh.Scalar(i)}return h.range=a,h.source=i,r&&(h.type=r),c&&(h.tag=c),l.format&&(h.format=l.format),o&&(h.comment=o),h}u(L0,"composeScalar");function R0(n,e,t,s,i){var a;if(t==="!")return n[xe.SCALAR];let r=[];for(let c of n.tags)if(!c.collection&&c.tag===t)if(c.default&&c.test)r.push(c);else return c;for(let c of r)if((a=c.test)!=null&&a.test(e))return c;let o=n.knownTags[t];return o&&!o.collection?(n.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(i(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),n[xe.SCALAR])}u(R0,"findScalarTagByName");function q0({atKey:n,directives:e,schema:t},s,i,r){let o=t.tags.find(a=>{var c;return(a.default===!0||n&&a.default==="key")&&((c=a.test)==null?void 0:c.test(s))})||t[xe.SCALAR];if(t.compat){let a=t.compat.find(c=>{var l;return c.default&&((l=c.test)==null?void 0:l.test(s))})??t[xe.SCALAR];if(o.tag!==a.tag){let c=e.tagString(o.tag),l=e.tagString(a.tag),h=`Value may be parsed as either ${c} or ${l}`;r(i,"TAG_RESOLVE_FAILED",h,!0)}}return o}u(q0,"findScalarTagByTest");th.composeScalar=L0});var nh=w(ih=>{"use strict";function $0(n,e,t){if(e){t??(t=e.length);for(let s=t-1;s>=0;--s){let i=e[s];switch(i.type){case"space":case"comment":case"newline":n-=i.source.length;continue}for(i=e[++s];(i==null?void 0:i.type)==="space";)n+=i.source.length,i=e[++s];break}}return n}u($0,"emptyScalarPosition");ih.emptyScalarPosition=$0});var ah=w(hr=>{"use strict";var M0=St(),P0=D(),F0=Xu(),rh=sh(),x0=nt(),U0=nh(),j0={composeNode:oh,composeEmptyNode:ur};function oh(n,e,t,s){let i=n.atKey,{spaceBefore:r,comment:o,anchor:a,tag:c}=t,l,h=!0;switch(e.type){case"alias":l=z0(n,e,s),(a||c)&&s(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":l=rh.composeScalar(n,e,c,s),a&&(l.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":l=F0.composeCollection(j0,n,e,t,s),a&&(l.anchor=a.source.substring(1));break;default:{let d=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;s(e,"UNEXPECTED_TOKEN",d),l=ur(n,e.offset,void 0,null,t,s),h=!1}}return a&&l.anchor===""&&s(a,"BAD_ALIAS","Anchor cannot be an empty string"),i&&n.options.stringKeys&&(!P0.isScalar(l)||typeof l.value!="string"||l.tag&&l.tag!=="tag:yaml.org,2002:str")&&s(c??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),r&&(l.spaceBefore=!0),o&&(e.type==="scalar"&&e.source===""?l.comment=o:l.commentBefore=o),n.options.keepSourceTokens&&h&&(l.srcToken=e),l}u(oh,"composeNode");function ur(n,e,t,s,{spaceBefore:i,comment:r,anchor:o,tag:a,end:c},l){let h={type:"scalar",offset:U0.emptyScalarPosition(e,t,s),indent:-1,source:""},d=rh.composeScalar(n,h,a,l);return o&&(d.anchor=o.source.substring(1),d.anchor===""&&l(o,"BAD_ALIAS","Anchor cannot be an empty string")),i&&(d.spaceBefore=!0),r&&(d.comment=r,d.range[2]=c),d}u(ur,"composeEmptyNode");function z0({options:n},{offset:e,source:t,end:s},i){let r=new M0.Alias(t.substring(1));r.source===""&&i(e,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&i(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);let o=e+t.length,a=x0.resolveEnd(s,o,n.strict,i);return r.range=[e,o,a.offset],a.comment&&(r.comment=a.comment),r}u(z0,"composeAlias");hr.composeEmptyNode=ur;hr.composeNode=oh});var uh=w(lh=>{"use strict";var B0=Pt(),ch=ah(),K0=nt(),Y0=jt();function W0(n,e,{offset:t,start:s,value:i,end:r},o){let a=Object.assign({_directives:e},n),c=new B0.Document(void 0,a),l={atKey:!1,atRoot:!0,directives:c.directives,options:c.options,schema:c.schema},h=Y0.resolveProps(s,{indicator:"doc-start",next:i??(r==null?void 0:r[0]),offset:t,onError:o,parentIndent:0,startOnNewline:!0});h.found&&(c.directives.docStart=!0,i&&(i.type==="block-map"||i.type==="block-seq")&&!h.hasNewline&&o(h.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),c.contents=i?ch.composeNode(l,i,h,o):ch.composeEmptyNode(l,h.end,s,null,h,o);let d=c.contents.range[2],f=K0.resolveEnd(r,d,!1,o);return f.comment&&(c.comment=f.comment),c.range=[t,d,f.offset],c}u(W0,"composeDoc");lh.composeDoc=W0});var mr=w(fh=>{"use strict";var G0=require("process"),J0=zi(),V0=Pt(),zt=Ut(),hh=D(),X0=uh(),H0=nt();function Bt(n){if(typeof n=="number")return[n,n+1];if(Array.isArray(n))return n.length===2?n:[n[0],n[1]];let{offset:e,source:t}=n;return[e,e+(typeof t=="string"?t.length:1)]}u(Bt,"getErrorPos");function dh(n){var i;let e="",t=!1,s=!1;for(let r=0;r<n.length;++r){let o=n[r];switch(o[0]){case"#":e+=(e===""?"":s?`

`:`
`)+(o.substring(1)||" "),t=!0,s=!1;break;case"%":((i=n[r+1])==null?void 0:i[0])!=="#"&&(r+=1),t=!1;break;default:t||(s=!0),t=!1}}return{comment:e,afterEmptyLine:s}}u(dh,"parsePrelude");var fr=class fr{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,s,i,r)=>{let o=Bt(t);r?this.warnings.push(new zt.YAMLWarning(o,s,i)):this.errors.push(new zt.YAMLParseError(o,s,i))},this.directives=new J0.Directives({version:e.version||"1.2"}),this.options=e}decorate(e,t){let{comment:s,afterEmptyLine:i}=dh(this.prelude);if(s){let r=e.contents;if(t)e.comment=e.comment?`${e.comment}
${s}`:s;else if(i||e.directives.docStart||!r)e.commentBefore=s;else if(hh.isCollection(r)&&!r.flow&&r.items.length>0){let o=r.items[0];hh.isPair(o)&&(o=o.key);let a=o.commentBefore;o.commentBefore=a?`${s}
${a}`:s}else{let o=r.commentBefore;r.commentBefore=o?`${s}
${o}`:s}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:dh(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,s=-1){for(let i of e)yield*this.next(i);yield*this.end(t,s)}*next(e){switch(G0.env.LOG_STREAM&&console.dir(e,{depth:null}),e.type){case"directive":this.directives.add(e.source,(t,s,i)=>{let r=Bt(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",s,i)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{let t=X0.composeDoc(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{let t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,s=new zt.YAMLParseError(Bt(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(s):this.doc.errors.push(s);break}case"doc-end":{if(!this.doc){let s="Unexpected doc-end without preceding document";this.errors.push(new zt.YAMLParseError(Bt(e),"UNEXPECTED_TOKEN",s));break}this.doc.directives.docEnd=!0;let t=H0.resolveEnd(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){let s=this.doc.comment;this.doc.comment=s?`${s}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new zt.YAMLParseError(Bt(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){let s=Object.assign({_directives:this.directives},this.options),i=new V0.Document(void 0,s);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,t,t],this.decorate(i,!1),yield i}}};u(fr,"Composer");var dr=fr;fh.Composer=dr});var yh=w(ai=>{"use strict";var Q0=ar(),Z0=lr(),ew=Ut(),mh=kt();function tw(n,e=!0,t){if(n){let s=u((i,r,o)=>{let a=typeof i=="number"?i:Array.isArray(i)?i[0]:i.offset;if(t)t(a,r,o);else throw new ew.YAMLParseError([a,a+1],r,o)},"_onError");switch(n.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return Z0.resolveFlowScalar(n,e,s);case"block-scalar":return Q0.resolveBlockScalar({options:{strict:e}},n,s)}}return null}u(tw,"resolveAsScalar");function sw(n,e){let{implicitKey:t=!1,indent:s,inFlow:i=!1,offset:r=-1,type:o="PLAIN"}=e,a=mh.stringifyString({type:o,value:n},{implicitKey:t,indent:s>0?" ".repeat(s):"",inFlow:i,options:{blockQuote:!0,lineWidth:-1}}),c=e.end??[{type:"newline",offset:-1,indent:s,source:`
`}];switch(a[0]){case"|":case">":{let l=a.indexOf(`
`),h=a.substring(0,l),d=a.substring(l+1)+`
`,f=[{type:"block-scalar-header",offset:r,indent:s,source:h}];return ph(f,c)||f.push({type:"newline",offset:-1,indent:s,source:`
`}),{type:"block-scalar",offset:r,indent:s,props:f,source:d}}case'"':return{type:"double-quoted-scalar",offset:r,indent:s,source:a,end:c};case"'":return{type:"single-quoted-scalar",offset:r,indent:s,source:a,end:c};default:return{type:"scalar",offset:r,indent:s,source:a,end:c}}}u(sw,"createScalarToken");function iw(n,e,t={}){let{afterKey:s=!1,implicitKey:i=!1,inFlow:r=!1,type:o}=t,a="indent"in n?n.indent:null;if(s&&typeof a=="number"&&(a+=2),!o)switch(n.type){case"single-quoted-scalar":o="QUOTE_SINGLE";break;case"double-quoted-scalar":o="QUOTE_DOUBLE";break;case"block-scalar":{let l=n.props[0];if(l.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o=l.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:o="PLAIN"}let c=mh.stringifyString({type:o,value:e},{implicitKey:i||a===null,indent:a!==null&&a>0?" ".repeat(a):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(c[0]){case"|":case">":nw(n,c);break;case'"':pr(n,c,"double-quoted-scalar");break;case"'":pr(n,c,"single-quoted-scalar");break;default:pr(n,c,"scalar")}}u(iw,"setScalarValue");function nw(n,e){let t=e.indexOf(`
`),s=e.substring(0,t),i=e.substring(t+1)+`
`;if(n.type==="block-scalar"){let r=n.props[0];if(r.type!=="block-scalar-header")throw new Error("Invalid block scalar header");r.source=s,n.source=i}else{let{offset:r}=n,o="indent"in n?n.indent:-1,a=[{type:"block-scalar-header",offset:r,indent:o,source:s}];ph(a,"end"in n?n.end:void 0)||a.push({type:"newline",offset:-1,indent:o,source:`
`});for(let c of Object.keys(n))c!=="type"&&c!=="offset"&&delete n[c];Object.assign(n,{type:"block-scalar",indent:o,props:a,source:i})}}u(nw,"setBlockScalarValue");function ph(n,e){if(e)for(let t of e)switch(t.type){case"space":case"comment":n.push(t);break;case"newline":return n.push(t),!0}return!1}u(ph,"addEndtoBlockProps");function pr(n,e,t){switch(n.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":n.type=t,n.source=e;break;case"block-scalar":{let s=n.props.slice(1),i=e.length;n.props[0].type==="block-scalar-header"&&(i-=n.props[0].source.length);for(let r of s)r.offset+=i;delete n.props,Object.assign(n,{type:t,source:e,end:s});break}case"block-map":case"block-seq":{let i={type:"newline",offset:n.offset+e.length,indent:n.indent,source:`
`};delete n.items,Object.assign(n,{type:t,source:e,end:[i]});break}default:{let s="indent"in n?n.indent:-1,i="end"in n&&Array.isArray(n.end)?n.end.filter(r=>r.type==="space"||r.type==="comment"||r.type==="newline"):[];for(let r of Object.keys(n))r!=="type"&&r!=="offset"&&delete n[r];Object.assign(n,{type:t,indent:s,source:e,end:i})}}}u(pr,"setFlowScalarValue");ai.createScalarToken=sw;ai.resolveAsScalar=tw;ai.setScalarValue=iw});var wh=w(gh=>{"use strict";var rw=u(n=>"type"in n?li(n):ci(n),"stringify");function li(n){switch(n.type){case"block-scalar":{let e="";for(let t of n.props)e+=li(t);return e+n.source}case"block-map":case"block-seq":{let e="";for(let t of n.items)e+=ci(t);return e}case"flow-collection":{let e=n.start.source;for(let t of n.items)e+=ci(t);for(let t of n.end)e+=t.source;return e}case"document":{let e=ci(n);if(n.end)for(let t of n.end)e+=t.source;return e}default:{let e=n.source;if("end"in n&&n.end)for(let t of n.end)e+=t.source;return e}}}u(li,"stringifyToken");function ci({start:n,key:e,sep:t,value:s}){let i="";for(let r of n)i+=r.source;if(e&&(i+=li(e)),t)for(let r of t)i+=r.source;return s&&(i+=li(s)),i}u(ci,"stringifyItem");gh.stringify=rw});var _h=w(Eh=>{"use strict";var yr=Symbol("break visit"),ow=Symbol("skip children"),bh=Symbol("remove item");function Ue(n,e){"type"in n&&n.type==="document"&&(n={start:n.start,value:n.value}),Sh(Object.freeze([]),n,e)}u(Ue,"visit");Ue.BREAK=yr;Ue.SKIP=ow;Ue.REMOVE=bh;Ue.itemAtPath=(n,e)=>{let t=n;for(let[s,i]of e){let r=t==null?void 0:t[s];if(r&&"items"in r)t=r.items[i];else return}return t};Ue.parentCollection=(n,e)=>{let t=Ue.itemAtPath(n,e.slice(0,-1)),s=e[e.length-1][0],i=t==null?void 0:t[s];if(i&&"items"in i)return i;throw new Error("Parent collection not found")};function Sh(n,e,t){let s=t(e,n);if(typeof s=="symbol")return s;for(let i of["key","value"]){let r=e[i];if(r&&"items"in r){for(let o=0;o<r.items.length;++o){let a=Sh(Object.freeze(n.concat([[i,o]])),r.items[o],t);if(typeof a=="number")o=a-1;else{if(a===yr)return yr;a===bh&&(r.items.splice(o,1),o-=1)}}typeof s=="function"&&i==="key"&&(s=s(e,n))}}return typeof s=="function"?s(e,n):s}u(Sh,"_visit");Eh.visit=Ue});var ui=w(te=>{"use strict";var gr=yh(),aw=wh(),cw=_h(),wr="\uFEFF",br="",Sr="",Er="",lw=u(n=>!!n&&"items"in n,"isCollection"),uw=u(n=>!!n&&(n.type==="scalar"||n.type==="single-quoted-scalar"||n.type==="double-quoted-scalar"||n.type==="block-scalar"),"isScalar");function hw(n){switch(n){case wr:return"<BOM>";case br:return"<DOC>";case Sr:return"<FLOW_END>";case Er:return"<SCALAR>";default:return JSON.stringify(n)}}u(hw,"prettyToken");function dw(n){switch(n){case wr:return"byte-order-mark";case br:return"doc-mode";case Sr:return"flow-error-end";case Er:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(n[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}u(dw,"tokenType");te.createScalarToken=gr.createScalarToken;te.resolveAsScalar=gr.resolveAsScalar;te.setScalarValue=gr.setScalarValue;te.stringify=aw.stringify;te.visit=cw.visit;te.BOM=wr;te.DOCUMENT=br;te.FLOW_END=Sr;te.SCALAR=Er;te.isCollection=lw;te.isScalar=uw;te.prettyToken=hw;te.tokenType=dw});var kr=w(vh=>{"use strict";var Kt=ui();function oe(n){switch(n){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}u(oe,"isEmpty");var Th=new Set("0123456789ABCDEFabcdef"),fw=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),hi=new Set(",[]{}"),mw=new Set(` ,[]{}
\r	`),_r=u(n=>!n||mw.has(n),"isNotAnchorChar"),vr=class vr{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let s=this.next??"stream";for(;s&&(t||this.hasChars(1));)s=yield*this.parseNext(s)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let s=0;for(;t===" ";)t=this.buffer[++s+e];if(t==="\r"){let i=this.buffer[s+e+1];if(i===`
`||!i&&!this.atEnd)return e+s+1}return t===`
`||s>=this.indentNext||!t&&!this.atEnd?e+s:-1}if(t==="-"||t==="."){let s=this.buffer.substr(e,3);if((s==="---"||s==="...")&&oe(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===Kt.BOM&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,s=e.indexOf("#");for(;s!==-1;){let r=e[s-1];if(r===" "||r==="	"){t=s-1;break}else s=e.indexOf("#",s+1)}for(;;){let r=e[t-1];if(r===" "||r==="	")t-=1;else break}let i=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-i),this.pushNewline(),"stream"}if(this.atLineEnd()){let t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield Kt.DOCUMENT,yield*this.parseLineStart()}*parseLineStart(){let e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");let t=this.peek(3);if((t==="---"||t==="...")&&oe(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!oe(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){let[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&oe(t)){let s=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=s,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);let e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(_r),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,s=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=s=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);let i=this.getLine();if(i===null)return this.setNext("flow");if((s!==-1&&s<this.indentNext&&i[0]!=="#"||s===0&&(i.startsWith("---")||i.startsWith("..."))&&oe(i[3]))&&!(s===this.indentNext-1&&this.flowLevel===1&&(i[0]==="]"||i[0]==="}")))return this.flowLevel=0,yield Kt.FLOW_END,yield*this.parseLineStart();let r=0;for(;i[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),i[r]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(_r),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{let o=this.charAt(1);if(this.flowKey||oe(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){let e=this.charAt(0),t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}let s=this.buffer.substring(0,t),i=s.indexOf(`
`,this.pos);if(i!==-1){for(;i!==-1;){let r=this.continueScalar(i+1);if(r===-1)break;i=s.indexOf(`
`,r)}i!==-1&&(t=i-(s[i-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){let t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>oe(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,s;e:for(let r=this.pos;s=this.buffer[r];++r)switch(s){case" ":t+=1;break;case`
`:e=r,t=0;break;case"\r":{let o=this.buffer[r+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!s&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{let r=this.continueScalar(e+1);if(r===-1)break;e=this.buffer.indexOf(`
`,r)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let i=e+1;for(s=this.buffer[i];s===" ";)s=this.buffer[++i];if(s==="	"){for(;s==="	"||s===" "||s==="\r"||s===`
`;)s=this.buffer[++i];e=i-1}else if(!this.blockScalarKeep)do{let r=e-1,o=this.buffer[r];o==="\r"&&(o=this.buffer[--r]);let a=r;for(;o===" ";)o=this.buffer[--r];if(o===`
`&&r>=this.pos&&r+1+t>a)e=r;else break}while(!0);return yield Kt.SCALAR,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){let e=this.flowLevel>0,t=this.pos-1,s=this.pos-1,i;for(;i=this.buffer[++s];)if(i===":"){let r=this.buffer[s+1];if(oe(r)||e&&hi.has(r))break;t=s}else if(oe(i)){let r=this.buffer[s+1];if(i==="\r"&&(r===`
`?(s+=1,i=`
`,r=this.buffer[s+1]):t=s),r==="#"||e&&hi.has(r))break;if(i===`
`){let o=this.continueScalar(s+1);if(o===-1)break;s=Math.max(s,o-2)}}else{if(e&&hi.has(i))break;t=s}return!i&&!this.atEnd?this.setNext("plain-scalar"):(yield Kt.SCALAR,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){let s=this.buffer.slice(this.pos,e);return s?(yield s,this.pos+=s.length,s.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(_r))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{let e=this.flowLevel>0,t=this.charAt(1);if(oe(t)||e&&hi.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!oe(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(fw.has(t))t=this.buffer[++e];else if(t==="%"&&Th.has(this.buffer[e+1])&&Th.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){let e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,s;do s=this.buffer[++t];while(s===" "||e&&s==="	");let i=t-this.pos;return i>0&&(yield this.buffer.substr(this.pos,i),this.pos=t),i}*pushUntil(e){let t=this.pos,s=this.buffer[t];for(;!e(s);)s=this.buffer[++t];return yield*this.pushToIndex(t,!1)}};u(vr,"Lexer");var Tr=vr;vh.Lexer=Tr});var Ar=w(kh=>{"use strict";var Cr=class Cr{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,s=this.lineStarts.length;for(;t<s;){let r=t+s>>1;this.lineStarts[r]<e?t=r+1:s=r}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};let i=this.lineStarts[t-1];return{line:t,col:e-i+1}}}};u(Cr,"LineCounter");var Nr=Cr;kh.LineCounter=Nr});var Dr=w(Ih=>{"use strict";var pw=require("process"),Nh=ui(),yw=kr();function Ce(n,e){for(let t=0;t<n.length;++t)if(n[t].type===e)return!0;return!1}u(Ce,"includesToken");function Ch(n){for(let e=0;e<n.length;++e)switch(n[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}u(Ch,"findNonEmptyIndex");function Oh(n){switch(n==null?void 0:n.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}u(Oh,"isFlowToken");function di(n){switch(n.type){case"document":return n.start;case"block-map":{let e=n.items[n.items.length-1];return e.sep??e.start}case"block-seq":return n.items[n.items.length-1].start;default:return[]}}u(di,"getPrevProps");function rt(n){var t;if(n.length===0)return[];let e=n.length;e:for(;--e>=0;)switch(n[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=n[++e])==null?void 0:t.type)==="space";);return n.splice(e,n.length)}u(rt,"getFirstKeyStartProps");function Ah(n){if(n.start.type==="flow-seq-start")for(let e of n.items)e.sep&&!e.value&&!Ce(e.start,"explicit-key-ind")&&!Ce(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,Oh(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}u(Ah,"fixFlowSeqItems");var Ir=class Ir{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new yw.Lexer,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(let s of this.lexer.lex(e,t))yield*this.next(s);t||(yield*this.end())}*next(e){if(this.source=e,pw.env.LOG_TOKENS&&console.log("|",Nh.prettyToken(e)),this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}let t=Nh.tokenType(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{let s=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:s,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){let e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){let t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{let s=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in s?s.indent:0:t.type==="flow-collection"&&s.type==="document"&&(t.indent=0),t.type==="flow-collection"&&Ah(t),s.type){case"document":s.value=t;break;case"block-scalar":s.props.push(t);break;case"block-map":{let i=s.items[s.items.length-1];if(i.value){s.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(i.sep)i.value=t;else{Object.assign(i,{key:t,sep:[]}),this.onKeyLine=!i.explicitKey;return}break}case"block-seq":{let i=s.items[s.items.length-1];i.value?s.items.push({start:[],value:t}):i.value=t;break}case"flow-collection":{let i=s.items[s.items.length-1];!i||i.value?s.items.push({start:[],key:t,sep:[]}):i.sep?i.value=t:Object.assign(i,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((s.type==="document"||s.type==="block-map"||s.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){let i=t.items[t.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&Ch(i.start)===-1&&(t.indent===0||i.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(s.type==="document"?s.end=i.start:s.items.push({start:i.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{let e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{Ch(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}let t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){let t=di(this.peek(2)),s=rt(t),i;e.end?(i=e.end,i.push(this.sourceToken),delete e.end):i=[this.sourceToken];let r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:s,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var s;let t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){let i="end"in t.value?t.value.end:void 0,r=Array.isArray(i)?i[i.length-1]:void 0;(r==null?void 0:r.type)==="comment"?i==null||i.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){let i=e.items[e.items.length-2],r=(s=i==null?void 0:i.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){let i=!this.onKeyLine&&this.indent===e.indent,r=i&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind",o=[];if(r&&t.sep&&!t.value){let a=[];for(let c=0;c<t.sep.length;++c){let l=t.sep[c];switch(l.type){case"newline":a.push(c);break;case"space":break;case"comment":l.indent>e.indent&&(a.length=0);break;default:a.length=0}}a.length>=2&&(o=t.sep.splice(a[1]))}switch(this.type){case"anchor":case"tag":r||t.value?(o.push(this.sourceToken),e.items.push({start:o}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):r||t.value?(o.push(this.sourceToken),e.items.push({start:o,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Ce(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]});else if(Oh(t.key)&&!Ce(t.sep,"newline")){let a=rt(t.start),c=t.key,l=t.sep;l.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:c,sep:l}]})}else o.length>0?t.sep=t.sep.concat(o,this.sourceToken):t.sep.push(this.sourceToken);else if(Ce(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{let a=rt(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||r?e.items.push({start:o,key:null,sep:[this.sourceToken]}):Ce(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let a=this.flowScalar(this.type);r||t.value?(e.items.push({start:o,key:a,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(a):(Object.assign(t,{key:a,sep:[]}),this.onKeyLine=!0);return}default:{let a=this.startBlockValue(e);if(a){if(a.type==="block-seq"){if(!t.explicitKey&&t.sep&&!Ce(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else i&&e.items.push({start:o});this.stack.push(a);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var s;let t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){let i="end"in t.value?t.value.end:void 0,r=Array.isArray(i)?i[i.length-1]:void 0;(r==null?void 0:r.type)==="comment"?i==null||i.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){let i=e.items[e.items.length-2],r=(s=i==null?void 0:i.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||Ce(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){let i=this.startBlockValue(e);if(i){this.stack.push(i);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){let t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let s;do yield*this.pop(),s=this.peek(1);while(s&&s.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let i=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:i,sep:[]}):t.sep?this.stack.push(i):Object.assign(t,{key:i,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}let s=this.startBlockValue(e);s?this.stack.push(s):(yield*this.pop(),yield*this.step())}else{let s=this.peek(2);if(s.type==="block-map"&&(this.type==="map-value-ind"&&s.indent===e.indent||this.type==="newline"&&!s.items[s.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&s.type!=="flow-collection"){let i=di(s),r=rt(i);Ah(e);let o=e.end.splice(1,e.end.length);o.push(this.sourceToken);let a={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let t=di(e),s=rt(t);return s.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;let t=di(e),s=rt(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(s=>s.type==="newline"||s.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}};u(Ir,"Parser");var Or=Ir;Ih.Parser=Or});var $h=w(Wt=>{"use strict";var Dh=mr(),gw=Pt(),Yt=Ut(),ww=on(),bw=D(),Sw=Ar(),Lh=Dr();function Rh(n){let e=n.prettyErrors!==!1;return{lineCounter:n.lineCounter||e&&new Sw.LineCounter||null,prettyErrors:e}}u(Rh,"parseOptions");function Ew(n,e={}){let{lineCounter:t,prettyErrors:s}=Rh(e),i=new Lh.Parser(t==null?void 0:t.addNewLine),r=new Dh.Composer(e),o=Array.from(r.compose(i.parse(n)));if(s&&t)for(let a of o)a.errors.forEach(Yt.prettifyError(n,t)),a.warnings.forEach(Yt.prettifyError(n,t));return o.length>0?o:Object.assign([],{empty:!0},r.streamInfo())}u(Ew,"parseAllDocuments");function qh(n,e={}){let{lineCounter:t,prettyErrors:s}=Rh(e),i=new Lh.Parser(t==null?void 0:t.addNewLine),r=new Dh.Composer(e),o=null;for(let a of r.compose(i.parse(n),!0,n.length))if(!o)o=a;else if(o.options.logLevel!=="silent"){o.errors.push(new Yt.YAMLParseError(a.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return s&&t&&(o.errors.forEach(Yt.prettifyError(n,t)),o.warnings.forEach(Yt.prettifyError(n,t))),o}u(qh,"parseDocument");function _w(n,e,t){let s;typeof e=="function"?s=e:t===void 0&&e&&typeof e=="object"&&(t=e);let i=qh(n,t);if(!i)return null;if(i.warnings.forEach(r=>ww.warn(i.options.logLevel,r)),i.errors.length>0){if(i.options.logLevel!=="silent")throw i.errors[0];i.errors=[]}return i.toJS(Object.assign({reviver:s},t))}u(_w,"parse");function Tw(n,e,t){let s=null;if(typeof e=="function"||Array.isArray(e)?s=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){let i=Math.round(t);t=i<1?void 0:i>8?{indent:8}:{indent:i}}if(n===void 0){let{keepUndefined:i}=t??e??{};if(!i)return}return bw.isDocument(n)&&!s?n.toString(t):new gw.Document(n,s,t).toString(t)}u(Tw,"stringify");Wt.parse=_w;Wt.parseAllDocuments=Ew;Wt.parseDocument=qh;Wt.stringify=Tw});var Ph=w(L=>{"use strict";var vw=mr(),kw=Pt(),Nw=Kn(),Lr=Ut(),Cw=St(),Ae=D(),Aw=Te(),Ow=x(),Iw=ke(),Dw=Ne(),Lw=ui(),Rw=kr(),qw=Ar(),$w=Dr(),fi=$h(),Mh=yt();L.Composer=vw.Composer;L.Document=kw.Document;L.Schema=Nw.Schema;L.YAMLError=Lr.YAMLError;L.YAMLParseError=Lr.YAMLParseError;L.YAMLWarning=Lr.YAMLWarning;L.Alias=Cw.Alias;L.isAlias=Ae.isAlias;L.isCollection=Ae.isCollection;L.isDocument=Ae.isDocument;L.isMap=Ae.isMap;L.isNode=Ae.isNode;L.isPair=Ae.isPair;L.isScalar=Ae.isScalar;L.isSeq=Ae.isSeq;L.Pair=Aw.Pair;L.Scalar=Ow.Scalar;L.YAMLMap=Iw.YAMLMap;L.YAMLSeq=Dw.YAMLSeq;L.CST=Lw;L.Lexer=Rw.Lexer;L.LineCounter=qw.LineCounter;L.Parser=$w.Parser;L.parse=fi.parse;L.parseAllDocuments=fi.parseAllDocuments;L.parseDocument=fi.parseDocument;L.stringify=fi.stringify;L.visit=Mh.visit;L.visitAsync=Mh.visitAsync});var Uh=w((mT,xh)=>{var Gt=pt(),Jt=require("path"),Fh=Ph(),qr=class qr{constructor(){this.defaultConfig=this._getDefaultConfig()}loadConfig(e=null){if(!e)return this.defaultConfig;if(typeof e=="string")return this._loadConfigFile(e);if(typeof e=="object")return this._mergeConfigs(this.defaultConfig,e);throw new Error("Invalid config type. Expected object, string, or null")}expandPath(e){if(!e)throw new Error("File path is required");if(e.startsWith("~")&&(e=Jt.join(require("os").homedir(),e.slice(2))),process.env.NODE_ENV==="test"||process.env.NOVA_UNIQUE_DB){let t=Jt.parse(e),s=Date.now(),i=process.pid,r=Math.random().toString(36).substring(2,8);e=Jt.join(t.dir,`${t.name}-${i}-${s}-${r}${t.ext}`)}return e}validateConfig(e){if(!e||typeof e!="object")throw new Error("Configuration must be an object");if(!e.storage||!e.storage.path)throw new Error("Configuration must include storage.path");if(e.search){let t=["tfidf","bm25","hybrid"];if(e.search.algorithm&&!t.includes(e.search.algorithm))throw new Error(`Invalid search algorithm. Must be one of: ${t.join(", ")}`)}if(e.performance){let t=e.performance;if(t.batch_size&&(typeof t.batch_size!="number"||t.batch_size<1))throw new Error("performance.batch_size must be a positive number");if(t.cache_timeout&&(typeof t.cache_timeout!="number"||t.cache_timeout<0))throw new Error("performance.cache_timeout must be a non-negative number")}return!0}getSystemInfo(){return{nodeVersion:process.version,platform:process.platform,arch:process.arch,pid:process.pid,env:process.env.NODE_ENV||"development",memory:process.memoryUsage(),uptime:process.uptime()}}_getDefaultConfig(){return{storage:{type:"sqlite",path:"~/data/nova-memory/memory.db",backup_enabled:!0,backup_interval:86400,max_backups:7},search:{algorithm:"hybrid",max_results:100,similarity_threshold:.1,optimizations:{enable_caching:!0,enable_indexing:!0,enable_parallel_search:!1,enable_result_reranking:!0}},performance:{batch_size:50,cache_timeout:3e5,max_cache_size:100,connection_timeout:3e4,retry_attempts:3,enable_wal_mode:!0,enable_memory_mapping:!0},entity_extraction:{enabled:!0,confidence_threshold:.8,max_entities_per_memory:20,entity_types:["PERSON","ORG","GPE","TECHNOLOGY","CONCEPT"]},clustering:{algorithm:"dbscan",min_samples:3,eps:.3,max_clusters:50,enable_quality_metrics:!0},query:{default_limit:20,max_limit:1e3,timeout:5e3},retention:{archive_old:!0,days:30,max_entries:1e4,cleanup_enabled:!0},logging:{level:"info",file_enabled:!1,file_path:"~/data/nova-memory/logs/memory.log",console_enabled:!0}}}_loadConfigFile(e){try{let t=this.expandPath(e);if(!Gt.existsSync(t))return console.warn(`Configuration file not found: ${t}, using defaults`),this.defaultConfig;let s=Gt.readFileSync(t,"utf8"),i=Jt.extname(t).toLowerCase(),r;if(i===".yaml"||i===".yml")r=Fh.parse(s);else if(i===".json")r=JSON.parse(s);else throw new Error(`Unsupported configuration file format: ${i}`);return this._mergeConfigs(this.defaultConfig,r)}catch(t){return console.error(`Failed to load configuration from ${e}: ${t.message}`),console.warn("Using default configuration"),this.defaultConfig}}_mergeConfigs(e,t){let s={...e};for(let[i,r]of Object.entries(t))r!=null&&(typeof r=="object"&&!Array.isArray(r)&&typeof s[i]=="object"&&!Array.isArray(s[i])?s[i]=this._mergeConfigs(s[i],r):s[i]=r);return s}saveConfig(e,t,s="yaml"){try{this.validateConfig(e);let i=this.expandPath(t);Gt.ensureDirSync(Jt.dirname(i));let r;if(s==="yaml"||s==="yml")r=Fh.stringify(e,{indent:2});else if(s==="json")r=JSON.stringify(e,null,2);else throw new Error(`Unsupported format: ${s}`);Gt.writeFileSync(i,r,"utf8"),console.log(`Configuration saved to: ${i}`)}catch(i){throw console.error(`Failed to save configuration: ${i.message}`),i}}createTemplate(e,t="yaml"){try{let s=this.expandPath(e);if(Gt.existsSync(s))throw new Error(`Template file already exists: ${s}`);this.saveConfig(this.defaultConfig,s,t),console.log(`Configuration template created: ${s}`)}catch(s){throw console.error(`Failed to create configuration template: ${s.message}`),s}}};u(qr,"ConfigurationManager");var Rr=qr;xh.exports={ConfigurationManager:Rr}});function Vt(){return mi>pi.length-16&&(jh.default.randomFillSync(pi),mi=0),pi.slice(mi,mi+=16)}var jh,pi,mi,$r=J(()=>{jh=ss(require("crypto")),pi=new Uint8Array(256),mi=pi.length;u(Vt,"rng")});var zh,Bh=J(()=>{zh=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i});function Mw(n){return typeof n=="string"&&zh.test(n)}var Oe,Xt=J(()=>{Bh();u(Mw,"validate");Oe=Mw});function je(n,e=0){return G[n[e+0]]+G[n[e+1]]+G[n[e+2]]+G[n[e+3]]+"-"+G[n[e+4]]+G[n[e+5]]+"-"+G[n[e+6]]+G[n[e+7]]+"-"+G[n[e+8]]+G[n[e+9]]+"-"+G[n[e+10]]+G[n[e+11]]+G[n[e+12]]+G[n[e+13]]+G[n[e+14]]+G[n[e+15]]}function Pw(n,e=0){let t=je(n,e);if(!Oe(t))throw TypeError("Stringified UUID is invalid");return t}var G,Kh,Ht=J(()=>{Xt();G=[];for(let n=0;n<256;++n)G.push((n+256).toString(16).slice(1));u(je,"unsafeStringify");u(Pw,"stringify");Kh=Pw});function Fw(n,e,t){let s=e&&t||0,i=e||new Array(16);n=n||{};let r=n.node||Yh,o=n.clockseq!==void 0?n.clockseq:Mr;if(r==null||o==null){let f=n.random||(n.rng||Vt)();r==null&&(r=Yh=[f[0]|1,f[1],f[2],f[3],f[4],f[5]]),o==null&&(o=Mr=(f[6]<<8|f[7])&16383)}let a=n.msecs!==void 0?n.msecs:Date.now(),c=n.nsecs!==void 0?n.nsecs:Fr+1,l=a-Pr+(c-Fr)/1e4;if(l<0&&n.clockseq===void 0&&(o=o+1&16383),(l<0||a>Pr)&&n.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Pr=a,Fr=c,Mr=o,a+=122192928e5;let h=((a&268435455)*1e4+c)%4294967296;i[s++]=h>>>24&255,i[s++]=h>>>16&255,i[s++]=h>>>8&255,i[s++]=h&255;let d=a/4294967296*1e4&268435455;i[s++]=d>>>8&255,i[s++]=d&255,i[s++]=d>>>24&15|16,i[s++]=d>>>16&255,i[s++]=o>>>8|128,i[s++]=o&255;for(let f=0;f<6;++f)i[s+f]=r[f];return e||je(i)}var Yh,Mr,Pr,Fr,Wh,Gh=J(()=>{$r();Ht();Pr=0,Fr=0;u(Fw,"v1");Wh=Fw});function xw(n){if(!Oe(n))throw TypeError("Invalid UUID");let e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var yi,xr=J(()=>{Xt();u(xw,"parse");yi=xw});function Uw(n){n=unescape(encodeURIComponent(n));let e=[];for(let t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}function Qt(n,e,t){function s(i,r,o,a){var c;if(typeof i=="string"&&(i=Uw(i)),typeof r=="string"&&(r=yi(r)),((c=r)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+i.length);if(l.set(r),l.set(i,r.length),l=t(l),l[6]=l[6]&15|e,l[8]=l[8]&63|128,o){a=a||0;for(let h=0;h<16;++h)o[a+h]=l[h];return o}return je(l)}u(s,"generateUUID");try{s.name=n}catch{}return s.DNS=jw,s.URL=zw,s}var jw,zw,Ur=J(()=>{Ht();xr();u(Uw,"stringToBytes");jw="6ba7b810-9dad-11d1-80b4-00c04fd430c8",zw="6ba7b811-9dad-11d1-80b4-00c04fd430c8";u(Qt,"v35")});function Bw(n){return Array.isArray(n)?n=Buffer.from(n):typeof n=="string"&&(n=Buffer.from(n,"utf8")),Jh.default.createHash("md5").update(n).digest()}var Jh,Vh,Xh=J(()=>{Jh=ss(require("crypto"));u(Bw,"md5");Vh=Bw});var Kw,Hh,Qh=J(()=>{Ur();Xh();Kw=Qt("v3",48,Vh),Hh=Kw});var Zh,jr,ed=J(()=>{Zh=ss(require("crypto")),jr={randomUUID:Zh.default.randomUUID}});function Yw(n,e,t){if(jr.randomUUID&&!e&&!n)return jr.randomUUID();n=n||{};let s=n.random||(n.rng||Vt)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=s[i];return e}return je(s)}var td,sd=J(()=>{ed();$r();Ht();u(Yw,"v4");td=Yw});function Ww(n){return Array.isArray(n)?n=Buffer.from(n):typeof n=="string"&&(n=Buffer.from(n,"utf8")),id.default.createHash("sha1").update(n).digest()}var id,nd,rd=J(()=>{id=ss(require("crypto"));u(Ww,"sha1");nd=Ww});var Gw,od,ad=J(()=>{Ur();rd();Gw=Qt("v5",80,nd),od=Gw});var cd,ld=J(()=>{cd="00000000-0000-0000-0000-000000000000"});function Jw(n){if(!Oe(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}var ud,hd=J(()=>{Xt();u(Jw,"version");ud=Jw});var dd={};nf(dd,{NIL:()=>cd,parse:()=>yi,stringify:()=>Kh,v1:()=>Wh,v3:()=>Hh,v4:()=>td,v5:()=>od,validate:()=>Oe,version:()=>ud});var fd=J(()=>{Gh();Qh();sd();ad();ld();hd();Xt();Ht();xr()});var pd=w((hv,md)=>{var{v4:Vw}=(fd(),rf(dd)),Br=class Br{constructor({id:e=null,content:t="",memory_type:s="general",session_id:i=null,timestamp:r=null,tags:o=[],tool_used:a=null,confidence_score:c=1,metadata:l={},embedding:h=null}={}){this.id=e,this.content=t,this.memory_type=s,this.session_id=i,this.timestamp=r||new Date,this.tags=Array.isArray(o)?o:[],this.tool_used=a,this.confidence_score=c,this.metadata=l||{},this.embedding=h}toJSON(){return{id:this.id,content:this.content,memory_type:this.memory_type,session_id:this.session_id,timestamp:this.timestamp.toISOString(),tags:this.tags,tool_used:this.tool_used,confidence_score:this.confidence_score,metadata:this.metadata,embedding:this.embedding}}};u(Br,"MemoryEntry");var Zt=Br,Kr=class Kr{constructor(e,t){var s,i,r;this.db=e,this.config=t,this.stats={total_entries:0,last_cleanup:null,cleanup_count:0,cache_hits:0,cache_misses:0},this.queryCache=new Map,this.maxCacheSize=((s=t.performance)==null?void 0:s.max_cache_size)||100,this.cacheTimeout=((i=t.performance)==null?void 0:i.cache_timeout)||3e5,this.batchQueue=[],this.batchSize=((r=t.performance)==null?void 0:r.batch_size)||50,this.batchTimeout=null}async store(e){try{let t=process.hrtime.bigint();e instanceof Zt||(e=new Zt(e)),e.id||(e.id=Vw()),this._validateEntry(e);let i=(await this.db.dbRun(`
        INSERT INTO memory_entries (
          content, memory_type, session_id, timestamp, tags,
          tool_used, confidence_score, metadata, embedding
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
      `,[e.content,e.memory_type,e.session_id,e.timestamp.toISOString(),JSON.stringify(e.tags),e.tool_used,e.confidence_score,JSON.stringify(e.metadata),e.embedding?JSON.stringify(e.embedding):null])).lastID;this.stats.total_entries++,this._clearCache();let r=process.hrtime.bigint(),o=Number(r-t)/1e6;return console.log(`\u2705 Memory entry stored with ID: ${i} (${o.toFixed(2)}ms)`),i}catch(t){throw console.error(`\u274C Failed to store memory entry: ${t.message}`),t}}async query(e={},t=null){var s;try{let i=process.hrtime.bigint();t=t||((s=this.config.search)==null?void 0:s.max_results)||100;let r=`query_${JSON.stringify(e)}_${t}`,o=this._getFromCache(r);if(o){this.stats.cache_hits++;let m=process.hrtime.bigint(),y=Number(m-i)/1e6;return console.log(`\u{1F680} Query served from cache (${y.toFixed(2)}ms)`),o}this.stats.cache_misses++;let a="SELECT * FROM memory_entries WHERE 1=1",c=[];e.memory_type&&(a+=" AND memory_type = ?",c.push(e.memory_type)),e.session_id&&(a+=" AND session_id = ?",c.push(e.session_id)),e.tool_used&&(a+=" AND tool_used = ?",c.push(e.tool_used)),e.min_confidence&&(a+=" AND confidence_score >= ?",c.push(e.min_confidence)),e.tags&&e.tags.length>0&&(a+=" AND tags LIKE ?",c.push(`%${e.tags[0]}%`)),e.content_search&&(a+=" AND content LIKE ?",c.push(`%${e.content_search}%`)),e.start_date&&(a+=" AND timestamp >= ?",c.push(e.start_date)),e.end_date&&(a+=" AND timestamp <= ?",c.push(e.end_date)),a+=" ORDER BY timestamp DESC",t&&(a+=" LIMIT ?",c.push(t));let h=(await this.db.dbAll(a,c)).map(m=>({...m,timestamp:new Date(m.timestamp),tags:JSON.parse(m.tags||"[]"),metadata:JSON.parse(m.metadata||"{}"),embedding:m.embedding?JSON.parse(m.embedding):null}));this._setCache(r,h);let d=process.hrtime.bigint(),f=Number(d-i)/1e6;return f>10&&console.warn(`\u26A0\uFE0F Slow query operation: ${f.toFixed(2)}ms (target: <10ms)`),console.log(`\u2705 Query executed (${f.toFixed(2)}ms) - ${h.length} results`),h}catch(i){throw console.error(`\u274C Failed to query memories: ${i.message}`),i}}async update(e,t){try{let s=process.hrtime.bigint(),i=[],r=[];for(let[h,d]of Object.entries(t))h==="tags"||h==="metadata"?(i.push(`${h} = ?`),r.push(JSON.stringify(d))):h==="embedding"?(i.push(`${h} = ?`),r.push(d?JSON.stringify(d):null)):h==="timestamp"?(i.push(`${h} = ?`),r.push(d instanceof Date?d.toISOString():d)):(i.push(`${h} = ?`),r.push(d));if(i.length===0)throw new Error("No valid fields to update");r.push(e);let o=`UPDATE memory_entries SET ${i.join(", ")} WHERE id = ?`;if((await this.db.dbRun(o,r)).changes===0)throw new Error(`Memory entry not found: ${e}`);this._clearCache();let c=process.hrtime.bigint(),l=Number(c-s)/1e6;return console.log(`\u2705 Memory entry updated: ${e} (${l.toFixed(2)}ms)`),!0}catch(s){throw console.error(`\u274C Failed to update memory entry: ${s.message}`),s}}async delete(e){try{let t=process.hrtime.bigint();if((await this.db.dbRun("DELETE FROM memory_entries WHERE id = ?",[e])).changes===0)throw new Error(`Memory entry not found: ${e}`);await this.db.dbRun("DELETE FROM memory_entity_links WHERE memory_id = ?",[e]),this.stats.total_entries--,this._clearCache();let i=process.hrtime.bigint(),r=Number(i-t)/1e6;return console.log(`\u2705 Memory entry deleted: ${e} (${r.toFixed(2)}ms)`),!0}catch(t){throw console.error(`\u274C Failed to delete memory entry: ${t.message}`),t}}async getStats(){try{let e=await this.db.dbGet("SELECT COUNT(*) as count FROM memory_entries");this.stats.total_entries=e.count;let t=await this.db.dbAll(`
        SELECT memory_type, COUNT(*) as count 
        FROM memory_entries 
        GROUP BY memory_type
      `),s=await this.db.dbAll(`
        SELECT session_id, COUNT(*) as count 
        FROM memory_entries 
        WHERE session_id IS NOT NULL
        GROUP BY session_id
        ORDER BY count DESC
        LIMIT 10
      `);return{...this.stats,type_distribution:t,top_sessions:s,cache_hit_rate:this.stats.cache_hits/(this.stats.cache_hits+this.stats.cache_misses)||0}}catch(e){throw console.error(`\u274C Failed to get memory statistics: ${e.message}`),e}}_validateEntry(e){if(!e.content||typeof e.content!="string")throw new Error("Memory entry must have non-empty content");if(e.content.length>1e4)throw new Error("Memory content too long (max 10000 characters)");if(e.confidence_score<0||e.confidence_score>1)throw new Error("Confidence score must be between 0 and 1");if(!Array.isArray(e.tags))throw new Error("Tags must be an array");if(typeof e.metadata!="object")throw new Error("Metadata must be an object")}_getFromCache(e){let t=this.queryCache.get(e);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.data:(t&&this.queryCache.delete(e),null)}_setCache(e,t){if(this.queryCache.size>=this.maxCacheSize){let s=this.queryCache.keys().next().value;this.queryCache.delete(s)}this.queryCache.set(e,{data:t,timestamp:Date.now()})}_clearCache(){this.queryCache.clear()}};u(Kr,"MemoryStorage");var zr=Kr;md.exports={MemoryEntry:Zt,MemoryStorage:zr}});var ze=w((fv,yd)=>{var Wr=class Wr{constructor(){this.stopWords=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","up","about","into","through","during","before","after","above","below","is","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","may","might","must","can","shall","this","that","these","those","i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves"])}tokenize(e){return!e||typeof e!="string"?[]:e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(t=>t.length>2&&!this.stopWords.has(t)).filter(Boolean)}calculateTermFrequency(e){let t={},s=e.length;for(let i of e)t[i]=(t[i]||0)+1;for(let i in t)t[i]=t[i]/s;return t}getAllTerms(e){let t=new Set;for(let s of e){let i=this.tokenize(s.content);for(let r of i)t.add(r)}return Array.from(t)}};u(Wr,"TextProcessor");var Ie=Wr,Gr=class Gr{constructor(){this.textProcessor=new Ie,this.idfCache=new Map}calculateIDF(e,t){let s=`${e}_${t.length}`;if(this.idfCache.has(s))return this.idfCache.get(s);let i=t.filter(o=>this.textProcessor.tokenize(o.content).includes(e)).length;if(i===0)return this.idfCache.set(s,0),0;let r=Math.log((t.length+1)/(i+1));return this.idfCache.set(s,r),r}calculateTFIDF(e,t,s){let i=this.textProcessor.tokenize(e),r=this.textProcessor.tokenize(t.content),o=this.textProcessor.calculateTermFrequency(r),a=0,c=0;for(let l of i){let h=o[l]||0;if(h>0){c++;let d=this.calculateIDF(l,s),f=d>0?h*d:h*.1;a+=f}}return c>0?a/Math.sqrt(i.length):0}rank(e,t){let s=process.hrtime.bigint();if(!e||e.trim()==="")return{results:[],algorithm:"precise",duration:0,totalDocuments:t.length,rankedDocuments:0};let i=t,r=!1;if(t.length>1e3){let d=Math.min(500,Math.floor(t.length*.1)),f=[],m=Math.floor(t.length/d);for(let p=0;p<t.length;p+=m)f.push(t[p]);let y=this.textProcessor.tokenize(e);for(let p of y)this.calculateIDF(p,f);r=!0,console.log(`\u26A1 TF-IDF: Using sampling strategy (${d} samples from ${t.length} docs)`)}let o=[],a=this.textProcessor.tokenize(e);for(let d=0;d<t.length;d++){let f=t[d],m=f.content.toLowerCase();if(!a.some(g=>m.includes(g)))continue;let p=this.calculateTFIDF(e,f,r?[]:t);if(p>0&&o.push({...f,tfidf_score:p}),o.length>100&&d>t.length*.3){console.log(`\u26A1 TF-IDF: Early termination at ${d}/${t.length} docs`);break}}let c=o.sort((d,f)=>f.tfidf_score-d.tfidf_score),l=process.hrtime.bigint(),h=Number(l-s)/1e6;return{results:c,algorithm:"precise",duration:h,totalDocuments:t.length,rankedDocuments:c.length,sampled:r}}};u(Gr,"TFIDFRanker");var es=Gr,Jr=class Jr{constructor(e=1.2,t=.75){this.k1=e,this.b=t,this.textProcessor=new Ie,this.avgDocLength=0,this.documentLengths=new Map,this.termDocumentFrequency=new Map}preprocessDocuments(e,t=null){let s=t&&e.length>1e3?e.filter(r=>{let o=r.content.toLowerCase();return t.some(a=>o.includes(a))}):e;s.length<e.length&&console.log(`\u26A1 BM25: Processing ${s.length}/${e.length} relevant docs`),this.documentLengths.clear(),this.termDocumentFrequency.clear();let i=0;for(let r of s){let o=this.textProcessor.tokenize(r.content),a=o.length;this.documentLengths.set(r.id,a),i+=a;let c=t&&e.length>1e3?o.filter(h=>t.includes(h)):o,l=new Set(c);for(let h of l)this.termDocumentFrequency.set(h,(this.termDocumentFrequency.get(h)||0)+1)}this.avgDocLength=i/Math.max(s.length,1),this.totalDocCount=e.length}calculateBM25(e,t,s){let i=this.textProcessor.tokenize(e),r=this.textProcessor.tokenize(t.content),o=this.documentLengths.get(t.id)||r.length,a={};for(let l of r)a[l]=(a[l]||0)+1;let c=0;for(let l of i){let h=a[l]||0;if(h===0)continue;let d=this.termDocumentFrequency.get(l)||0;if(d===0)continue;let f=Math.max(.1,Math.log((s.length-d+.5)/(d+.5))),m=h*(this.k1+1),y=h+this.k1*(1-this.b+this.b*(o/this.avgDocLength));c+=f*(m/y)}return Math.max(0,c)}rank(e,t){let s=process.hrtime.bigint();if(!e||e.trim()==="")return{results:[],algorithm:"fast",duration:0,totalDocuments:t.length,rankedDocuments:0};let i=this.textProcessor.tokenize(e);this.preprocessDocuments(t,i);let r=t.length>1e3?t.filter(h=>{let d=h.content.toLowerCase();return i.some(f=>d.includes(f))}):t;r.length<t.length&&console.log(`\u26A1 BM25: Scoring ${r.length}/${t.length} relevant docs`);let o=[];for(let h of r){let d=this.calculateBM25(e,h,t);if(d>0&&o.push({...h,bm25_score:d}),o.length>200&&r.length>500){console.log(`\u26A1 BM25: Early termination with ${o.length} results`);break}}let a=o.sort((h,d)=>d.bm25_score-h.bm25_score),c=process.hrtime.bigint(),l=Number(c-s)/1e6;return{results:a,algorithm:"fast",duration:l,totalDocuments:t.length,rankedDocuments:a.length}}};u(Jr,"BM25Ranker");var ts=Jr,Vr=class Vr{constructor(){this.tfidfRanker=new es,this.bm25Ranker=new ts}rank(e,t,s={}){let{tfidfWeight:i=.3,bm25Weight:r=.7,confidenceWeight:o=.2,recencyWeight:a=.1}=s,c=process.hrtime.bigint();if(!e||e.trim()==="")return{results:[],algorithm:"smart",duration:0,totalDocuments:t.length,rankedDocuments:0,performance:{tfidf_duration:0,bm25_duration:0,total_duration:0}};let l=t;if(t.length>1e3){let _=this.tfidfRanker.textProcessor.tokenize(e);l=t.filter(v=>{let O=v.content.toLowerCase();return _.some(k=>O.includes(k))}),console.log(`\u26A1 Hybrid: Pre-filtered to ${l.length}/${t.length} relevant docs`),l.length>2e3&&(l=l.slice(0,2e3),console.log("\u26A1 Hybrid: Limited to 2000 most recent relevant docs"))}let h=this.tfidfRanker.rank(e,l),d=this.bm25Ranker.rank(e,l),f=new Map,m=new Map;for(let _ of h.results)f.set(_.id,_.tfidf_score);for(let _ of d.results)m.set(_.id,_.bm25_score);let y=Math.max(...h.results.map(_=>_.tfidf_score),0),p=Math.max(...d.results.map(_=>_.bm25_score),0),g=new Set([...f.keys(),...m.keys()]),S=t.filter(_=>g.has(_.id)).map(_=>{let v=(f.get(_.id)||0)/(y||1),O=(m.get(_.id)||0)/(p||1),k=_.confidence_score||1,N=(Date.now()-new Date(_.timestamp).getTime())/(1e3*60*60*24),C=Math.exp(-N/30),A=v*i+O*r+k*o+C*a;return{..._,hybrid_score:A,component_scores:{tfidf:v,bm25:O,confidence:k,recency:C}}}).filter(_=>{if(f.has(_.id)||m.has(_.id))return!0;let v=new Ie().tokenize(e),O=new Ie().tokenize(_.content);return v.some(N=>O.includes(N))}).sort((_,v)=>v.hybrid_score-_.hybrid_score),E=process.hrtime.bigint(),T=Number(E-c)/1e6;return{results:S,algorithm:"Hybrid (TF-IDF + BM25 + Confidence + Recency)",duration:T,totalDocuments:t.length,rankedDocuments:S.length,performance:{tfidf_duration:h.duration,bm25_duration:d.duration,total_duration:T}}}};u(Vr,"HybridRanker");var gi=Vr,Xr=class Xr{constructor(e="hybrid"){this.algorithm=e,this.rankers={tfidf:new es,bm25:new ts,hybrid:new gi}}search(e,t,s={}){let i=this.rankers[this.algorithm];if(!i)throw new Error(`Unknown algorithm: ${this.algorithm}`);if(!e||e.trim()==="")return{results:[],algorithm:this.algorithm,duration:0,totalDocuments:t.length,rankedDocuments:0,performance_metrics:{algorithm:this.algorithm,query_terms:0,documents_processed:t.length,results_returned:0,processing_time_ms:0}};let r=i.rank(e,t,s);return r.performance_metrics={algorithm:this.algorithm,query_terms:new Ie().tokenize(e).length,documents_processed:t.length,results_returned:r.rankedDocuments,processing_time_ms:r.duration},r}setAlgorithm(e){if(!this.rankers[e])throw new Error(`Unknown algorithm: ${e}. Available: ${Object.keys(this.rankers).join(", ")}`);this.algorithm=e}getAvailableAlgorithms(){return Object.keys(this.rankers)}};u(Xr,"AdvancedSearchEngine");var Yr=Xr;yd.exports={TextProcessor:Ie,TFIDFRanker:es,BM25Ranker:ts,HybridRanker:gi,AdvancedSearchEngine:Yr}});var wd=w((pv,gd)=>{var{TextProcessor:Xw}=ze(),io=class io{constructor(e=[]){this.termToDocuments=new Map,this.documentCount=0,this.lastUpdate=0,e.length>0&&this.buildIndex(e)}buildIndex(e){let t=process.hrtime.bigint();this.termToDocuments.clear(),this.documentCount=e.length;let s=new Xw;for(let o of e){let a=s.tokenize(o.content);for(let c of a)this.termToDocuments.has(c)||this.termToDocuments.set(c,new Set),this.termToDocuments.get(c).add(o.id)}let i=process.hrtime.bigint(),r=Number(i-t)/1e6;console.log(`\u{1F4CA} Inverted index built: ${this.termToDocuments.size} terms, ${this.documentCount} docs (${r.toFixed(2)}ms)`),Array.from(this.termToDocuments.keys()).some(o=>o.includes("oauth"))&&console.error("DEBUG InvertedIndex build found OAuth terms:",Array.from(this.termToDocuments.entries()).filter(([o])=>o.includes("oauth")).map(([o,a])=>({term:o,docIds:Array.from(a)}))),this.lastUpdate=Date.now()}getDocumentsWithTerm(e){let t=this.termToDocuments.get(e);return e.includes("oauth")&&console.error(`DEBUG getDocumentsWithTerm('${e}'):`,{found:!!t,docIds:t?Array.from(t):[],availableTerms:Array.from(this.termToDocuments.keys()).filter(s=>s.includes("oauth"))}),t?Array.from(t):[]}getDocumentsWithAllTerms(e){if(e.length===0)return[];let t=new Set(this.getDocumentsWithTerm(e[0]));for(let s=1;s<e.length;s++){let i=new Set(this.getDocumentsWithTerm(e[s]));if(t=new Set([...t].filter(r=>i.has(r))),t.size===0)break}return Array.from(t)}getDocumentsWithAnyTerms(e){let t=new Set;for(let s of e){let i=this.getDocumentsWithTerm(s);for(let r of i)t.add(r)}return Array.from(t)}getStats(){return{termCount:this.termToDocuments.size,documentCount:this.documentCount,lastUpdate:this.lastUpdate,averageTermsPerDoc:this.termToDocuments.size/this.documentCount}}};u(io,"InvertedIndex");var Hr=io,no=class no{constructor(e=1e3,t=3e5){this.cache=new Map,this.maxSize=e,this.ttl=t,this.stats={hits:0,misses:0,evictions:0}}generateKey(e,t,s={}){let i=JSON.stringify(s);return`${t}:${e}:${i}`}get(e,t,s={}){let i=this.generateKey(e,t,s),r=this.cache.get(i);return r?Date.now()-r.timestamp>this.ttl?(this.cache.delete(i),this.stats.misses++,null):(this.stats.hits++,r.result):(this.stats.misses++,null)}set(e,t,s,i={}){let r=this.generateKey(e,t,i);if(this.cache.size>=this.maxSize){let o=this.cache.keys().next().value;this.cache.delete(o),this.stats.evictions++}this.cache.set(r,{result:s,timestamp:Date.now()})}clear(){this.cache.clear(),this.stats.hits=0,this.stats.misses=0,this.stats.evictions=0}getStats(){return{...this.stats,size:this.cache.size,hitRate:this.stats.hits/(this.stats.hits+this.stats.misses),maxSize:this.maxSize,ttl:this.ttl}}};u(no,"QueryCache");var Qr=no,ro=class ro{constructor(e,t,s=100){this.tfidfRanker=e,this.bm25Ranker=t,this.initialCandidates=s}async search(e,t,s={}){let i=process.hrtime.bigint(),r=process.hrtime.bigint(),o=this.tfidfRanker.rank(e,t),a=process.hrtime.bigint(),c=o.results.slice(0,this.initialCandidates),l=process.hrtime.bigint(),h=this.bm25Ranker.rank(e,c),d=process.hrtime.bigint(),f=process.hrtime.bigint();return{results:h.results,algorithm:"Fast-First (TF-IDF \u2192 BM25)",duration:Number(f-i)/1e6,totalDocuments:t.length,rankedDocuments:h.results.length,performance:{tfidf_duration:Number(a-r)/1e6,bm25_duration:Number(d-l)/1e6,total_duration:Number(f-i)/1e6,candidates_filtered:this.initialCandidates}}}};u(ro,"FastFirstStrategy");var Zr=ro,oo=class oo{constructor(e=.8,t=10){this.confidenceThreshold=e,this.minResults=t}optimize(e,t,s,i={}){let r=process.hrtime.bigint(),o=50,a=[],c=0;for(let h=0;h<s.length;h+=o){let d=s.slice(h,h+o),f=e.rank(t,d);if(a=a.concat(f.results),c+=d.length,a.sort((m,y)=>(y.hybrid_score||y.bm25_score||y.tfidf_score)-(m.hybrid_score||m.bm25_score||m.tfidf_score)),a.length>=this.minResults&&(a[0].hybrid_score||a[0].bm25_score||a[0].tfidf_score)>=this.confidenceThreshold){console.log(`\u{1F680} Early termination: ${c}/${s.length} docs processed`);break}}let l=process.hrtime.bigint();return{results:a,algorithm:`${e.constructor.name} (Early Termination)`,duration:Number(l-r)/1e6,totalDocuments:s.length,processedDocuments:c,rankedDocuments:a.length,earlyTermination:c<s.length}}};u(oo,"EarlyTerminationOptimizer");var eo=oo,ao=class ao{constructor(e={}){this.phases={invertedIndex:e.invertedIndex??!0,queryCache:e.queryCache??!0,fastFirst:e.fastFirst??!1,earlyTermination:e.earlyTermination??!1},this.invertedIndexConfig={enabled:this.phases.invertedIndex,rebuildThreshold:e.rebuildThreshold??100},this.queryCacheConfig={enabled:this.phases.queryCache,maxSize:e.cacheMaxSize??1e3,ttl:e.cacheTTL??3e5},this.fastFirstConfig={enabled:this.phases.fastFirst,initialCandidates:e.initialCandidates??100},this.earlyTerminationConfig={enabled:this.phases.earlyTermination,confidenceThreshold:e.confidenceThreshold??.8,minResults:e.minResults??10}}hasOptimizations(){return Object.values(this.phases).some(e=>e)}getEnabledPhases(){return Object.keys(this.phases).filter(e=>this.phases[e])}};u(ao,"OptimizationConfig");var to=ao,co=class co{static normalizeQuery(e){return!e||typeof e!="string"?"":e.trim().toLowerCase()}static removeStopWords(e){if(!e||typeof e!="string")return[];let t=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","is","are","was","were","be","been","have","has","had","do","does","did","will","would","could","should"]);return e.split(" ").filter(s=>!t.has(s.toLowerCase()))}static stemWords(e){return!e||!Array.isArray(e)?[]:e.map(t=>{if(!t||typeof t!="string")return"";let s=["ing","ed","er","est","s","es","ies","ly"],i=t.toLowerCase();for(let r of s)if(i.endsWith(r)&&i.length>r.length+2){i=i.slice(0,-r.length);break}return i})}static expandAbbreviations(e){let t={ML:"machine learning",AI:"artificial intelligence",DL:"deep learning",NLP:"natural language processing",API:"application programming interface",UI:"user interface",UX:"user experience"},s=e;for(let[i,r]of Object.entries(t)){let o=new RegExp(`\\b${i}\\b`,"gi");s=s.replace(o,r)}return s}static calculateBoostFactor(e){var s,i;let t=1;return e.type==="important"&&(t*=1.5),e.type==="critical"&&(t*=2),((s=e.metadata)==null?void 0:s.priority)==="high"&&(t*=1.3),((i=e.metadata)==null?void 0:i.priority)==="critical"&&(t*=1.8),t}static applyTemporalRanking(e){let t=new Date,s=new Date(e.timestamp),i=(t-s)/(1e3*60*60*24);return Math.exp(-i/30)}static calculateSimilarity(e,t){let s=e.toLowerCase().split(" "),i=t.toLowerCase().split(" "),r=s.filter(a=>i.includes(a)),o=[...new Set([...s,...i])];return r.length/o.length}static optimizeQuery(e,t={}){let s=this.normalizeQuery(e);if(t.expandAbbreviations&&(s=this.expandAbbreviations(s)),t.removeStopWords&&(s=this.removeStopWords(s).join(" ")),t.stemWords){let i=s.split(" ");s=this.stemWords(i).join(" ")}return s}static createSearchIndex(e){let t=new Map;return e.forEach(s=>{s.content.toLowerCase().split(/\s+/).forEach(r=>{t.has(r)||t.set(r,[]),t.get(r).push(s.id)})}),Object.fromEntries(t)}static optimizeIndex(e){let t={};for(let[s,i]of Object.entries(e))t[s]=[...new Set(i)].sort((r,o)=>r-o);return t}static compressIndexData(e){return{compressed:!0,originalSize:JSON.stringify(e).length,compressedData:Object.keys(e).length}}static trackSearchMetrics(e,t,s){return{query:e,executionTime:t,resultCount:s,timestamp:new Date().toISOString(),efficiency:s/t}}static analyzeQueryPatterns(e){let t={totalQueries:e.length,averageLength:e.reduce((s,i)=>s+i.length,0)/e.length,mostCommonWords:{},queryTypes:{},commonTerms:[]};return e.forEach(s=>{s.toLowerCase().split(" ").forEach(r=>{t.mostCommonWords[r]=(t.mostCommonWords[r]||0)+1})}),t.commonTerms=Object.keys(t.mostCommonWords).sort((s,i)=>t.mostCommonWords[i]-t.mostCommonWords[s]),t}static generatePerformanceReport(e){let t=e.reduce((s,i)=>s+i.executionTime,0)/e.length;return{totalSearches:e.length,averageExecutionTime:t,averageTime:t,slowestQuery:e.reduce((s,i)=>i.executionTime>s.executionTime?i:s,e[0]),fastestQuery:e.reduce((s,i)=>i.executionTime<s.executionTime?i:s,e[0])}}static optimizeMemoryUsage(e){return{originalSize:JSON.stringify(e).length,optimizedSize:JSON.stringify(e).length*.8,memoryReduction:"20%"}}static cleanupResources(e){return e.cache&&(e.cache={}),e.index&&(e.index={}),!0}static manageCacheSize(e,t){for(;e.size>t;){let s=e.keys().next().value;e.delete(s)}}static safeFallback(e,t){try{return e()}catch{return t}}};u(co,"SearchOptimizations");var so=co;gd.exports={InvertedIndex:Hr,QueryCache:Qr,FastFirstStrategy:Zr,EarlyTerminationOptimizer:eo,OptimizationConfig:to,SearchOptimizations:so}});var Ed=w((Sv,Sd)=>{var{AdvancedSearchEngine:Hw,TFIDFRanker:gv,BM25Ranker:wv,HybridRanker:bv}=ze(),{InvertedIndex:Qw,QueryCache:Zw,FastFirstStrategy:eb,EarlyTerminationOptimizer:tb,OptimizationConfig:bd}=wd(),uo=class uo extends Hw{constructor(e="hybrid",t={}){super(e),this.optimizationConfig=new bd(t),this.invertedIndex=null,this.queryCache=null,this.fastFirstStrategy=null,this.earlyTerminationOptimizer=null,this.documentCount=0,this.lastIndexUpdate=0,this.performanceStats={totalQueries:0,cacheHits:0,indexUsage:0,fastFirstUsage:0,earlyTerminations:0},this.initializeOptimizations()}initializeOptimizations(){this.optimizationConfig.queryCacheConfig.enabled&&(this.queryCache=new Zw(this.optimizationConfig.queryCacheConfig.maxSize,this.optimizationConfig.queryCacheConfig.ttl)),this.optimizationConfig.fastFirstConfig.enabled&&(this.fastFirstStrategy=new eb(this.rankers.tfidf,this.rankers.bm25,this.optimizationConfig.fastFirstConfig.initialCandidates)),this.optimizationConfig.earlyTerminationConfig.enabled&&(this.earlyTerminationOptimizer=new tb(this.optimizationConfig.earlyTerminationConfig.confidenceThreshold,this.optimizationConfig.earlyTerminationConfig.minResults)),console.log(`\u{1F680} Optimized search engine initialized with phases: ${this.optimizationConfig.getEnabledPhases().join(", ")}`)}updateInvertedIndex(e){if(!this.optimizationConfig.invertedIndexConfig.enabled)return;let t=!this.invertedIndex||e.length!==this.documentCount||Math.abs(e.length-this.documentCount)>this.optimizationConfig.invertedIndexConfig.rebuildThreshold;e.some(s=>s.content&&s.content.toLowerCase().includes("oauth"))&&console.error("DEBUG updateInvertedIndex:",{shouldRebuild:t,hasIndex:!!this.invertedIndex,documentsLength:e.length,documentCount:this.documentCount,threshold:this.optimizationConfig.invertedIndexConfig.rebuildThreshold}),t&&(this.invertedIndex=new Qw(e),this.documentCount=e.length,this.lastIndexUpdate=Date.now())}getCandidateDocuments(e,t){if(!this.optimizationConfig.invertedIndexConfig.enabled||!this.invertedIndex)return t;let i=new(ze()).TextProcessor().tokenize(e);if(i.length===0)return[];let r=this.invertedIndex.getDocumentsWithAnyTerms(i);e.toLowerCase().includes("oauth")&&console.error("DEBUG getCandidateDocuments:",{queryTokens:i,candidateIds:r,allDocumentIds:t.map(a=>a.id),firstDoc:t[0]?{id:t[0].id,content:t[0].content.substring(0,50)}:null});let o=t.filter(a=>r.includes(a.id));return this.performanceStats.indexUsage++,console.log(`\u{1F4CA} Index filter: ${o.length}/${t.length} documents (${(o.length/t.length*100).toFixed(1)}%)`),o}search(e,t,s={}){var d,f;let i=process.hrtime.bigint();if(this.performanceStats.totalQueries++,!e||e.trim()==="")return{results:[],algorithm:this.algorithm,duration:0,totalDocuments:t.length,rankedDocuments:0,optimizations:this.optimizationConfig.getEnabledPhases(),performance_metrics:{algorithm:this.algorithm,query_terms:0,documents_processed:t.length,results_returned:0,processing_time_ms:0,optimizations_used:[]}};let r=[];if(this.queryCache){let m=this.queryCache.get(e,this.algorithm,s);if(m){this.performanceStats.cacheHits++,r.push("query_cache");let y=process.hrtime.bigint(),p=Number(y-i)/1e6;return{...m,duration:p,optimizations:r,performance_metrics:{...m.performance_metrics,processing_time_ms:p,optimizations_used:r,cache_hit:!0}}}}(!this.invertedIndex||t.length>this.documentCount)&&this.updateInvertedIndex(t);let o;this.invertedIndex&&t.length===this.documentCount?(o=this.getCandidateDocuments(e,t),o.length<t.length&&r.push("inverted_index")):o=t;let a;if(this.fastFirstStrategy&&(this.algorithm==="hybrid"||this.algorithm==="bm25"))a=this.fastFirstStrategy.search(e,o,s),r.push("fast_first"),this.performanceStats.fastFirstUsage++;else if(this.earlyTerminationOptimizer&&o.length>100){let m=this.rankers[this.algorithm];a=this.earlyTerminationOptimizer.optimize(m,e,o,s),r.push("early_termination"),this.performanceStats.earlyTerminations++}else{let m=this.rankers[this.algorithm];e.toLowerCase().includes("oauth")&&console.error("DEBUG OptimizedSearchEngine before ranking:",{algorithm:this.algorithm,candidateDocumentsLength:o.length,rankerExists:!!m,rankerType:(d=m==null?void 0:m.constructor)==null?void 0:d.name}),a=m.rank(e,o,s),e.toLowerCase().includes("oauth")&&console.error("DEBUG OptimizedSearchEngine after ranking:",{resultTotalDocuments:a==null?void 0:a.totalDocuments,resultRankedDocuments:a==null?void 0:a.rankedDocuments,resultLength:(f=a==null?void 0:a.results)==null?void 0:f.length})}this.queryCache&&this.queryCache.set(e,this.algorithm,a,s);let c=process.hrtime.bigint(),l=Number(c-i)/1e6;return{...a,duration:l,optimizations:r,performance_metrics:{algorithm:this.algorithm,query_terms:new(ze()).TextProcessor().tokenize(e).length,documents_processed:t.length,candidates_processed:o.length,results_returned:a.rankedDocuments,processing_time_ms:l,optimizations_used:r,cache_hit:!1,filter_efficiency:o.length/t.length}}}getPerformanceStats(){let e={...this.performanceStats,cacheHitRate:this.performanceStats.cacheHits/this.performanceStats.totalQueries,indexUsageRate:this.performanceStats.indexUsage/this.performanceStats.totalQueries,fastFirstUsageRate:this.performanceStats.fastFirstUsage/this.performanceStats.totalQueries,earlyTerminationRate:this.performanceStats.earlyTerminations/this.performanceStats.totalQueries};return this.queryCache&&(e.queryCache=this.queryCache.getStats()),this.invertedIndex&&(e.invertedIndex=this.invertedIndex.getStats()),e}clearOptimizations(){this.queryCache&&this.queryCache.clear(),this.performanceStats={totalQueries:0,cacheHits:0,indexUsage:0,fastFirstUsage:0,earlyTerminations:0},console.log("\u{1F9F9} Optimization caches cleared")}getOptimizationConfig(){return{enabled:this.optimizationConfig.hasOptimizations(),phases:this.optimizationConfig.phases,enabledPhases:this.optimizationConfig.getEnabledPhases()}}setOptimizationPhase(e,t){if(this.optimizationConfig.phases.hasOwnProperty(e))this.optimizationConfig.phases[e]=t,console.log(`\u{1F527} Optimization phase '${e}' ${t?"enabled":"disabled"}`),t&&this.initializeOptimizations();else throw new Error(`Unknown optimization phase: ${e}`)}};u(uo,"OptimizedAdvancedSearchEngine");var lo=uo;Sd.exports={OptimizedAdvancedSearchEngine:lo,OptimizationConfig:bd}});var Td=w((_v,_d)=>{var{AdvancedSearchEngine:sb}=ze(),{OptimizedAdvancedSearchEngine:ib}=Ed(),fo=class fo{constructor(e,t){var o,a;this.db=e,this.config=t;let s=t.search||{},i=s.algorithm||"hybrid",r=s.optimizations||{};r&&Object.keys(r).length>0?(this.searchEngine=new ib(i,r),console.error(`\u{1F680} Using optimized search engine with phases: ${Object.keys(r).filter(c=>r[c]).join(", ")}`)):(this.searchEngine=new sb(i),console.error(`\u{1F4CA} Using standard search engine with algorithm: ${i}`)),this.searchCache=new Map,this.maxCacheSize=((o=t.performance)==null?void 0:o.max_cache_size)||100,this.cacheTimeout=((a=t.performance)==null?void 0:a.cache_timeout)||3e5}async search(e,t=null,s={}){var i;try{let r=process.hrtime.bigint();t=t||((i=this.config.search)==null?void 0:i.max_results)||100;let a=`search_${s.algorithm||this.searchEngine.algorithm}_${e}_${t}`,c=this._getFromCache(a);if(c){let p=process.hrtime.bigint(),g=Number(p-r)/1e6;return console.log(`\u{1F680} Search served from cache (${g.toFixed(2)}ms)`),c}let l=[],h=!1;try{let p=`
          SELECT m.* FROM memory_entries m
          JOIN memory_fts f ON m.id = f.rowid
          WHERE memory_fts MATCH ?
          ORDER BY rank
          LIMIT ?
        `,g=e.replace(/["*()]/g,"");console.error(`\u{1F50D} FTS search for: "${g}" with limit: ${t*2}`),l=await this.db.dbAll(p,[g,t*2]),h=!0,console.error(`\u{1F4CA} FTS found ${l.length} rows`)}catch(p){console.error(`\u26A0\uFE0F FTS search failed, falling back to LIKE: ${p.message}`);let g=`
          SELECT * FROM memory_entries 
          WHERE content LIKE ? OR tags LIKE ?
          ORDER BY timestamp DESC
          LIMIT ?
        `,b=`%${e}%`;l=await this.db.dbAll(g,[b,b,t*2]),console.error(`\u{1F4CA} LIKE query found ${l.length} rows`)}let d=l.map(p=>({...p,id:p.id,timestamp:new Date(p.timestamp),tags:JSON.parse(p.tags||"[]"),metadata:JSON.parse(p.metadata||"{}"),embedding:p.embedding?JSON.parse(p.embedding):null})),f;d.length>0?(s.algorithm&&s.algorithm!==this.searchEngine.algorithm&&this.searchEngine.setAlgorithm(s.algorithm),f=this.searchEngine.search(e,d,s),t&&(f.results=f.results.slice(0,t),f.rankedDocuments=f.results.length)):f={results:[],algorithm:this.searchEngine.algorithm,duration:0,totalDocuments:0,rankedDocuments:0,performance_metrics:{algorithm:this.searchEngine.algorithm,query_terms:0,documents_processed:0,results_returned:0,processing_time_ms:0}},this._setCache(a,f.results);let m=process.hrtime.bigint(),y=Number(m-r)/1e6;return y>25&&console.warn(`\u26A0\uFE0F Slow search operation: ${y.toFixed(2)}ms (target: <25ms)`),console.log(`\u2705 Advanced search executed (${y.toFixed(2)}ms) - ${f.results.length} results for "${e}" using ${f.algorithm} (FTS: ${h})`),f.results&&f.results.length>0&&(f.results=f.results.map(p=>{let g=0;return p.hybrid_score!==void 0?g=p.hybrid_score:p.tfidf_score!==void 0?g=p.tfidf_score:p.bm25_score!==void 0&&(g=p.bm25_score),{...p,score:g}})),f.results}catch(r){throw console.error(`\u274C Failed to search memories: ${r.message}`),r}}async similaritySearch(e,t=10,s=.7){try{let i=process.hrtime.bigint(),o=await this.db.dbAll("SELECT * FROM memory_entries WHERE embedding IS NOT NULL"),a=[];for(let d of o)try{let f=JSON.parse(d.embedding),m=this._cosineSimilarity(e,f);m>=s&&a.push({...d,similarity_score:m,timestamp:new Date(d.timestamp),tags:JSON.parse(d.tags||"[]"),metadata:JSON.parse(d.metadata||"{}")})}catch(f){console.warn(`\u26A0\uFE0F Invalid embedding for memory ${d.id}: ${f.message}`)}a.sort((d,f)=>f.similarity_score-d.similarity_score);let c=a.slice(0,t),l=process.hrtime.bigint(),h=Number(l-i)/1e6;return console.log(`\u2705 Similarity search executed (${h.toFixed(2)}ms) - ${c.length} results`),c}catch(i){throw console.error(`\u274C Failed to perform similarity search: ${i.message}`),i}}async multiModalSearch(e,t=null,s={}){try{let i=process.hrtime.bigint(),r=s.textWeight||.7,o=s.embeddingWeight||.3,a=s.limit||50,c=await this.search(e,a*2,s),l=[];t&&(l=await this.similaritySearch(t,a*2,s.similarityThreshold||.5));let h=new Map;for(let y of c){let p=(y.score||0)*r;h.set(y.id,{...y,text_score:y.score||0,combined_score:p})}for(let y of l){let p=y.similarity_score*o;if(h.has(y.id)){let g=h.get(y.id);g.combined_score+=p,g.embedding_score=y.similarity_score}else h.set(y.id,{...y,embedding_score:y.similarity_score,combined_score:p,text_score:0})}let d=Array.from(h.values()).sort((y,p)=>p.combined_score-y.combined_score).slice(0,a),f=process.hrtime.bigint(),m=Number(f-i)/1e6;return console.log(`\u2705 Multi-modal search executed (${m.toFixed(2)}ms) - ${d.length} results`),d}catch(i){throw console.error(`\u274C Failed to perform multi-modal search: ${i.message}`),i}}async getSearchSuggestions(e,t=5){try{let i=await this.db.dbAll(`
        SELECT DISTINCT content 
        FROM memory_entries 
        WHERE content LIKE ? 
        ORDER BY timestamp DESC 
        LIMIT ?
      `,[`%${e}%`,t*3]),r=[],o=e.toLowerCase();for(let a of i){let c=a.content.toLowerCase(),l=c.indexOf(o);if(l!==-1){let h=Math.max(0,l-20),d=Math.min(c.length,l+o.length+20),f=a.content.substring(h,d).trim();f.length>e.length&&!r.includes(f)&&r.push(f)}if(r.length>=t)break}return r}catch(s){throw console.error(`\u274C Failed to get search suggestions: ${s.message}`),s}}_cosineSimilarity(e,t){if(!e||!t||e.length!==t.length)return 0;let s=0,i=0,r=0;for(let o=0;o<e.length;o++)s+=e[o]*t[o],i+=e[o]*e[o],r+=t[o]*t[o];return i===0||r===0?0:s/(Math.sqrt(i)*Math.sqrt(r))}_getFromCache(e){let t=this.searchCache.get(e);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.data:(t&&this.searchCache.delete(e),null)}_setCache(e,t){if(this.searchCache.size>=this.maxCacheSize){let s=this.searchCache.keys().next().value;this.searchCache.delete(s)}this.searchCache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.searchCache.clear(),console.log("\u{1F5D1}\uFE0F Search cache cleared")}};u(fo,"SearchOperations");var ho=fo;_d.exports={SearchOperations:ho}});var po=w((vv,vd)=>{var mo=class mo{constructor(){this.technicalPatterns=[/\b(nova\s+memory|nova)\b/gi,/\b(mem0|langmem|letta)\b/gi,/\b(tf-idf|tfidf|bm25|hybrid)\b/gi,/\b(networkx|langchain|openai|anthropic|claude|gpt-4)\b/gi,/\b(microsoft|google|amazon|meta|facebook)\b/gi,/\b(python|node\.?js|javascript|typescript|react|express)\b/gi,/\b(postgresql|mysql|mongodb|redis|sqlite)\b/gi,/\b(mcp\s+server|mcp|server)\b/gi,/\b(algorithm|optimization|performance|metrics)\b/gi,/\b(authentication\s+module|authentication|auth)\b/gi,/\b(jwt\s+token|jwt|token|oauth)\b/gi,/\b(devops\s+team|devops|frontend\s+team|backend\s+team)\b/gi,/\b(database\s+connection\s+pooling|connection\s+pooling)\b/gi,/\b(payment\s+processing\s+module|payment\s+processing|payment\s+module)\b/gi,/\b(chat\s+session|chat|session)\b/gi,/\b(project\s+\w+|project\s+alpha|project\s+beta|project\s+titan|project\s+phoenix)\b/gi,/\b(database|repository|repositories)\b/gi,/\b(integration|configuration|implementation|migration)\b/gi,/\b(security\s+audit|security|audit|vulnerability|vulnerabilities)\b/gi,/\b(performance\s+issues|performance\s+optimization|optimization)\b/gi,/\b(github|git|version\s+control)\b/gi,/\b(api|rest|graphql|json|endpoint|endpoints)\b/gi,/\b(docker|kubernetes|container)\b/gi,/\b(aws|azure|gcp|cloud)\b/gi,/\b([A-Z][a-z]+\s+[A-Z][a-z]+)\b/g,/\b(\d+%|\d+\.\d+s|\d+ms|\d+\s+critical|\d+\s+vulnerabilities)\b/gi],this.relationshipPatterns=[{pattern:/(\w+)\s+competes?\s+with\s+(\w+)/gi,type:"competes_with"},{pattern:/(\w+)\s+integrates?\s+with\s+(\w+)/gi,type:"integrates_with"},{pattern:/(\w+)\s+outperforms?\s+(\w+)/gi,type:"outperforms"},{pattern:/(\w+)\s+uses?\s+(\w+)/gi,type:"uses"},{pattern:/(\w+)\s+replaces?\s+(\w+)/gi,type:"replaces"},{pattern:/(\w+)\s+optimizes?\s+(\w+)/gi,type:"optimizes"},{pattern:/(\w+)\s+requires?\s+(\w+)/gi,type:"requires"},{pattern:/(\w+)\s+depends?\s+on\s+(\w+)/gi,type:"depends_on"},{pattern:/([A-Z][a-z]+\s+[A-Z][a-z]+)\s+(?:worked|works)\s+(?:on|with)\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/gi,type:"works_on"},{pattern:/([A-Z][a-z]+\s+[A-Z][a-z]+)\s+from\s+([A-Z][a-z]+)/gi,type:"works_for"},{pattern:/([A-Z][a-z]+\s+[A-Z][a-z]+)\s+(?:collaborated|collaborates)\s+with\s+([A-Z][a-z]+\s+[A-Z][a-z]+)/gi,type:"collaborates_with"},{pattern:/([A-Z][a-z]+\s+[A-Z][a-z]+)\s+(?:completed|completes)\s+(?:the\s+)?([a-z\s]+(?:migration|project|task|implementation))/gi,type:"completed"},{pattern:/([A-Z][a-z]+\s+[A-Z][a-z]+)\s+(?:identified|identifies)\s+(?:the\s+)?([a-z\s]+(?:issue|bug|problem|vulnerability))/gi,type:"identified"},{pattern:/([A-Z][a-z]+\s+[A-Z][a-z]+)\s+(?:implemented|implements)\s+(?:the\s+)?([a-z\s]+(?:solution|fix|feature|system))/gi,type:"implemented"},{pattern:/([A-Z][a-z]+\s+[A-Z][a-z]+)\s+(?:fixed|fixes)\s+(?:the\s+)?([a-z\s]+(?:bug|issue|problem))/gi,type:"fixed"},{pattern:/([A-Z][a-z]+\s+[A-Z][a-z]+)\s+(?:member|part)\s+of\s+(?:the\s+)?([A-Z][a-z]+\s+(?:team|group))/gi,type:"member_of"},{pattern:/(DevOps\s+team|DevOps)\s+(?:worked|works|fixed|completed)\s+([^.]+)/gi,type:"team_worked_on"},{pattern:/(?:by|from)\s+(?:the\s+)?(DevOps\s+team|DevOps).*([A-Z][a-z]+\s+[A-Z][a-z]+)/gi,type:"member_of"},{pattern:/(?:was\s+fixed\s+by|fixed\s+by)\s+(?:the\s+)?(DevOps\s+team)/gi,type:"fixed_by"},{pattern:/([^.]+)\s+(?:using|with|via)\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)/gi,type:"uses_technology"},{pattern:/([^.]+)\s+(?:reduced|improved|increased)\s+([^.]+)/gi,type:"improved"},{pattern:/([^.]+)\s+(?:caused|causes)\s+([^.]+)/gi,type:"causes"},{pattern:/([^.]+)\s+(?:part|component)\s+of\s+([^.]+)/gi,type:"part_of"}]}extractEntities(e){if(!e||typeof e!="string")return[];let t=[];for(let a of this.technicalPatterns){let c=e.match(a);c&&c.forEach(l=>{let h=this.cleanEntity(l);h&&!t.includes(h)&&t.push(h)})}let s=/\b(\d+(?:\.\d+)?%?)\b/g,i=e.match(s);i&&i.forEach(a=>{a.length>1&&!t.includes(a)&&t.push(a)});let r=/\b[A-Z][a-z]+(?:\s+[A-Z][a-z]+)?\b/g,o=e.match(r);return o&&o.forEach(a=>{let c=a.trim();c.length>2&&!t.includes(c)&&!this.isCommonWord(c.toLowerCase())&&t.push(c)}),t.slice(0,10)}inferRelationships(e,t){if(!e||!t||t.length===0)return[];let s=[];for(let{pattern:i,type:r}of this.relationshipPatterns){let o=[...e.matchAll(i)];for(let a of o)if(a[1]&&a[2]){let c=this.cleanEntity(a[1]),l=this.cleanEntity(a[2]);if(c&&l&&c!==l){let h=`${c} \u2192 ${r} \u2192 ${l}`;s.push(h)}}}return s}cleanEntity(e){return!e||typeof e!="string"?null:e.trim().replace(/[^\w\s\-\.]/g,"").replace(/\s+/g," ").substring(0,50)}isCommonWord(e){return new Set(["the","and","for","are","but","not","you","all","can","had","her","was","one","our","out","day","get","has","him","his","how","man","new","now","old","see","two","way","who","boy","did","its","let","put","say","she","too","use","time","work","system","using","used","user","users","data","file","files"]).has(e.toLowerCase())}processMemoryContent(e,t=[]){let s=this.extractEntities(e),i=this.inferRelationships(e,s),r=s.filter(a=>typeof a=="string"&&a.length>2).map(a=>a.toLowerCase().replace(/\s+/g,"_")).slice(0,5),o=[...new Set([...t,...r])];return{entities:s,relationships:i,enhancedTags:o,entityCount:s.length,relationshipCount:i.length}}};u(mo,"EntityExtractor");var wi=mo,nb=new wi;vd.exports={EntityExtractor:wi,entityExtractor:nb}});var Nd=w((Nv,kd)=>{var{entityExtractor:rb}=po(),go=class go{constructor(e,t){var s,i,r;this.db=e,this.config=t,this.entityExtractionEnabled=((s=t.entity_extraction)==null?void 0:s.enabled)??!0,this.confidenceThreshold=((i=t.entity_extraction)==null?void 0:i.confidence_threshold)??.8,this.maxEntitiesPerMemory=((r=t.entity_extraction)==null?void 0:r.max_entities_per_memory)??20}async storeRelationship(e){try{let t=process.hrtime.bigint();if(!e.entity1||!e.entity2||!e.relation)throw new Error("Missing required relationship fields: entity1, entity2, relation");let i=(await this.db.dbRun(`
        INSERT INTO relationships 
        (entity1, entity1_type, entity2, entity2_type, relation, confidence, metadata)
        VALUES (?, ?, ?, ?, ?, ?, ?)
      `,[e.entity1,e.entity1_type||"unknown",e.entity2,e.entity2_type||"unknown",e.relation,e.confidence||1,e.metadata||"{}"])).lastID,r=process.hrtime.bigint(),o=Number(r-t)/1e6;return console.log(`\u2705 Relationship stored: ${e.entity1} \u2192 ${e.relation} \u2192 ${e.entity2} (${o.toFixed(2)}ms)`),i}catch(t){throw console.error(`\u274C Failed to store relationship: ${t.message}`),t}}async getEntityRelationships(e,t="both"){try{let s="",i=[];switch(t){case"incoming":s="SELECT * FROM relationships WHERE entity2 = ?",i=[e];break;case"outgoing":s="SELECT * FROM relationships WHERE entity1 = ?",i=[e];break;default:s="SELECT * FROM relationships WHERE entity1 = ? OR entity2 = ?",i=[e,e]}return(await this.db.dbAll(s,i)).map(o=>({...o,timestamp:new Date(o.timestamp),metadata:JSON.parse(o.metadata||"{}")}))}catch(s){throw console.error(`\u274C Failed to get entity relationships: ${s.message}`),s}}async getEntities(e={}){try{let t="SELECT * FROM entities WHERE 1=1",s=[];return e.type&&(t+=" AND type = ?",s.push(e.type)),e.min_confidence&&(t+=" AND confidence >= ?",s.push(e.min_confidence)),t+=" ORDER BY confidence DESC, updated_at DESC",e.limit&&(t+=" LIMIT ?",s.push(e.limit)),(await this.db.dbAll(t,s)).map(r=>({...r,created_at:new Date(r.created_at),updated_at:new Date(r.updated_at),metadata:JSON.parse(r.metadata||"{}")}))}catch(t){throw console.error(`\u274C Failed to get entities: ${t.message}`),t}}async extractAndStoreEntities(e,t){var s,i;try{if(!this.entityExtractionEnabled)return{entities:[],relationships:[]};let r=process.hrtime.bigint(),o=await rb.extract(e);if(!o||!((s=o.entities)!=null&&s.length)&&!((i=o.relationships)!=null&&i.length))return{entities:[],relationships:[]};let a=[];if(o.entities&&o.entities.length>0)try{for(let d of o.entities.slice(0,this.maxEntitiesPerMemory)){await this.db.dbRun(`
              INSERT INTO entities (name, type, created_at, updated_at, confidence, metadata)
              VALUES (?, ?, ?, ?, ?, ?)
              ON CONFLICT(name) DO UPDATE SET
                updated_at = ?,
                confidence = MAX(confidence, ?)
            `,[d,"auto_extracted",new Date().toISOString(),new Date().toISOString(),this.confidenceThreshold,JSON.stringify({extraction_version:"1.0",last_memory_id:t}),new Date().toISOString(),this.confidenceThreshold]);let f=await this.db.dbGet("SELECT id FROM entities WHERE name = ?",[d]);f&&(await this.db.dbRun(`
                INSERT OR IGNORE INTO memory_entity_links (memory_id, entity_id, confidence)
                VALUES (?, ?, ?)
              `,[t,f.id,this.confidenceThreshold]),a.push(d))}}catch(d){console.warn(`\u26A0\uFE0F Failed to store some entities: ${d.message}`)}let c=[];if(o.relationships&&o.relationships.length>0)try{for(let d of o.relationships){let f=d.split(" \u2192 ");if(f.length===3){let[m,y,p]=f,g=await this.storeRelationship({entity1:m.trim(),entity1_type:"auto_extracted",entity2:p.trim(),entity2_type:"auto_extracted",relation:y.trim(),confidence:this.confidenceThreshold,metadata:JSON.stringify({memory_id:t,extraction_version:"1.0"})});c.push(d)}}}catch(d){console.warn(`\u26A0\uFE0F Failed to store some relationships: ${d.message}`)}let l=process.hrtime.bigint(),h=Number(l-r)/1e6;return(a.length>0||c.length>0)&&console.log(`\u{1F517} Extracted ${a.length} entities, ${c.length} relationships (${h.toFixed(2)}ms)`),{entities:a,relationships:c,processing_time:h}}catch(r){throw console.error(`\u274C Failed to extract and store entities: ${r.message}`),r}}async getEntityGraph(e={}){try{let t=process.hrtime.bigint(),s=e.limit||100,i=e.min_confidence||.5,r=e.include_types||[],o="SELECT * FROM entities WHERE confidence >= ?",a=[i];r.length>0&&(o+=` AND type IN (${r.map(()=>"?").join(",")})`,a.push(...r)),o+=" ORDER BY mention_count DESC LIMIT ?",a.push(s);let c=await this.db.dbAll(o,a),l=c.map(b=>b.name);if(l.length===0)return{nodes:[],edges:[],stats:{entities:0,relationships:0}};let h=`
        SELECT * FROM relationships 
        WHERE confidence >= ? 
        AND entity1 IN (${l.map(()=>"?").join(",")})
        AND entity2 IN (${l.map(()=>"?").join(",")})
        ORDER BY confidence DESC
      `,d=[i,...l,...l],f=await this.db.dbAll(h,d),m=c.map(b=>({id:b.name,label:b.name,type:b.type,confidence:b.confidence,mention_count:b.mention_count,size:Math.max(10,Math.min(50,b.mention_count*5))})),y=f.map((b,S)=>({id:`edge_${S}`,source:b.entity1,target:b.entity2,label:b.relation,confidence:b.confidence,weight:b.confidence})),p=process.hrtime.bigint(),g=Number(p-t)/1e6;return console.log(`\u2705 Entity graph generated (${g.toFixed(2)}ms) - ${m.length} nodes, ${y.length} edges`),{nodes:m,edges:y,stats:{entities:m.length,relationships:y.length,processing_time:g}}}catch(t){throw console.error(`\u274C Failed to generate entity graph: ${t.message}`),t}}async findSimilarEntities(e,t=10){try{let s=`
        SELECT 
          CASE 
            WHEN r1.entity1 = ? THEN r2.entity1
            WHEN r1.entity2 = ? THEN r2.entity2
            ELSE NULL
          END as similar_entity,
          COUNT(*) as shared_relationships,
          AVG(r1.confidence) as avg_confidence
        FROM relationships r1
        JOIN relationships r2 ON (
          (r1.entity1 = ? AND r2.entity1 = r1.entity2) OR
          (r1.entity2 = ? AND r2.entity2 = r1.entity1) OR
          (r1.entity1 = ? AND r2.entity2 = r1.entity2) OR
          (r1.entity2 = ? AND r2.entity1 = r1.entity1)
        )
        WHERE similar_entity IS NOT NULL 
        AND similar_entity != ?
        GROUP BY similar_entity
        ORDER BY shared_relationships DESC, avg_confidence DESC
        LIMIT ?
      `,i=[e,e,e,e,e,e,e,t];return(await this.db.dbAll(s,i)).map(o=>({entity:o.similar_entity,shared_relationships:o.shared_relationships,similarity_score:o.avg_confidence}))}catch(s){throw console.error(`\u274C Failed to find similar entities: ${s.message}`),s}}async getEntityStats(){try{let e=await this.db.dbGet("SELECT COUNT(*) as count FROM entities"),t=await this.db.dbGet("SELECT COUNT(*) as count FROM relationships"),s=await this.db.dbAll(`
        SELECT type, COUNT(*) as count 
        FROM entities 
        GROUP BY type 
        ORDER BY count DESC
      `),i=await this.db.dbAll(`
        SELECT relation, COUNT(*) as count 
        FROM relationships 
        GROUP BY relation 
        ORDER BY count DESC
        LIMIT 20
      `),r=await this.db.dbAll(`
        SELECT name, type, mention_count, confidence 
        FROM entities 
        ORDER BY mention_count DESC 
        LIMIT 10
      `);return{total_entities:e.count,total_relationships:t.count,entity_types:s,relation_types:i,top_entities:r}}catch(e){throw console.error(`\u274C Failed to get entity statistics: ${e.message}`),e}}async updateEntity(e,t){try{let s=[],i=[];for(let[a,c]of Object.entries(t))a==="metadata"?(s.push(`${a} = ?`),i.push(JSON.stringify(c))):a==="updated_at"?(s.push(`${a} = ?`),i.push(c instanceof Date?c.toISOString():c)):(s.push(`${a} = ?`),i.push(c));if(s.length===0)throw new Error("No valid fields to update");i.push(e);let r=`UPDATE entities SET ${s.join(", ")} WHERE id = ?`;if((await this.db.dbRun(r,i)).changes===0)throw new Error(`Entity not found: ${e}`);return console.log(`\u2705 Entity updated: ${e}`),!0}catch(s){throw console.error(`\u274C Failed to update entity: ${s.message}`),s}}async deleteEntity(e){try{let t=await this.db.dbGet("SELECT name FROM entities WHERE id = ?",[e]);if(!t)throw new Error(`Entity not found: ${e}`);await this.db.dbRun("DELETE FROM relationships WHERE entity1 = ? OR entity2 = ?",[t.name,t.name]),await this.db.dbRun("DELETE FROM memory_entity_links WHERE entity_id = ?",[e]);let s=await this.db.dbRun("DELETE FROM entities WHERE id = ?",[e]);return console.log(`\u2705 Entity deleted: ${t.name}`),!0}catch(t){throw console.error(`\u274C Failed to delete entity: ${t.message}`),t}}};u(go,"EntityRelationshipManager");var yo=go;kd.exports={EntityRelationshipManager:yo}});var Ad=w((Av,Cd)=>{var bo=class bo{constructor(e,t){var s;this.databaseOps=e,this.config=t,this.stats={total_entries:0,last_cleanup:null,cleanup_count:0,operation_counts:{store:0,query:0,search:0,batch:0},performance_metrics:{avg_store_time:0,avg_query_time:0,avg_search_time:0,slow_operations:0}},this.batchQueue=[],this.batchSize=((s=t.performance)==null?void 0:s.batch_size)||50,this.batchTimeout=null,this.connectionLock=!1,this.connectionQueue=[],this.lastActivity=Date.now(),this.preparedStatements={}}prepareStatements(){console.log("\u2705 Prepared statements initialized for performance optimization")}async storeBatch(e){if(!Array.isArray(e)||e.length===0)return[];try{let t=process.hrtime.bigint(),s=`
        INSERT INTO memory_entries 
        (content, memory_type, session_id, timestamp, tags, tool_used, confidence_score, metadata, embedding)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
      `,i=[];for(let c of e){(c.confidence_score<0||c.confidence_score>1)&&(c.confidence_score=Math.max(0,Math.min(1,c.confidence_score)));let l=[c.content,c.memory_type,c.session_id,c.timestamp.toISOString(),JSON.stringify(c.tags),c.tool_used,c.confidence_score,JSON.stringify(c.metadata),c.embedding?JSON.stringify(c.embedding):null],h=await this.databaseOps.dbRun(s,l);i.push(h.lastID.toString())}this.stats.total_entries+=e.length,this.stats.operation_counts.batch++;let r=process.hrtime.bigint(),o=Number(r-t)/1e6,a=o/e.length;return this._updatePerformanceMetrics("batch",o),console.log(`\u2705 Batch stored ${e.length} entries (${o.toFixed(2)}ms total, ${a.toFixed(2)}ms avg)`),i}catch(t){throw console.error(`\u274C Failed to batch store memories: ${t.message}`),t}}async cleanup(e=30){try{let t=process.hrtime.bigint();if(this.connectionLock)return console.log("\u26A0\uFE0F Database is locked, cleanup skipped"),{cleaned:0,message:"Database locked, cleanup skipped"};let s=new Date;s.setDate(s.getDate()-e);let r=await this.databaseOps.dbRun(`
        DELETE FROM memory_entries 
        WHERE timestamp < ? 
        AND confidence_score < 0.5
      `,[s.toISOString()]);this.stats.cleanup_count++,this.stats.last_cleanup=new Date;let o=process.hrtime.bigint(),a=Number(o-t)/1e6;return console.log(`\u2705 Cleaned up ${r.changes} old memory entries (${a.toFixed(2)}ms)`),{cleaned:r.changes,cutoff_date:s,duration:a}}catch(t){if(t.code==="SQLITE_BUSY")return console.log("\u26A0\uFE0F Database is busy, cleanup skipped"),{cleaned:0,message:"Database busy, cleanup skipped"};throw console.error(`\u274C Failed to cleanup memories: ${t.message}`),t}}async getSystemStats(){try{let e=process.hrtime.bigint(),t=await this.databaseOps.dbGet("SELECT COUNT(*) as count FROM memory_entries"),s=await this.databaseOps.dbGet("SELECT COUNT(*) as count FROM entities"),i=await this.databaseOps.dbGet("SELECT COUNT(*) as count FROM relationships"),r=await this.databaseOps.dbGet("SELECT page_count * page_size as size FROM pragma_page_count(), pragma_page_size()"),o=await this.databaseOps.dbGet("SELECT AVG(confidence_score) as avg FROM memory_entries"),a=await this.databaseOps.dbGet(`
        SELECT COUNT(*) as count 
        FROM memory_entries 
        WHERE timestamp > datetime('now', '-24 hours')
      `),c=process.hrtime.bigint(),l=Number(c-e)/1e6;return{database:{memories:t.count,entities:s.count,relationships:i.count,size_bytes:r.size||0,avg_confidence:o.avg||0},activity:{recent_24h:a.count,last_cleanup:this.stats.last_cleanup,cleanup_count:this.stats.cleanup_count},performance:{...this.stats.performance_metrics,stats_generation_time:l},operations:this.stats.operation_counts}}catch(e){throw console.error(`\u274C Failed to get system statistics: ${e.message}`),e}}async optimizeDatabase(){try{let e=process.hrtime.bigint();await this.databaseOps.dbRun("ANALYZE");let t=await this.databaseOps.dbGet("SELECT freelist_count, page_count FROM pragma_freelist_count(), pragma_page_count()"),s=t.freelist_count/t.page_count,i=!1;s>.1&&(await this.databaseOps.dbRun("VACUUM"),i=!0),await this.databaseOps.dbRun("PRAGMA optimize");let r=process.hrtime.bigint(),o=Number(r-e)/1e6;return console.log(`\u2705 Database optimization completed (${o.toFixed(2)}ms)${i?" - VACUUM performed":""}`),{duration:o,vacuum_performed:i,free_page_ratio:s,total_pages:t.page_count}}catch(e){throw console.error(`\u274C Failed to optimize database: ${e.message}`),e}}trackOperation(e,t){this.stats.operation_counts[e]!==void 0&&this.stats.operation_counts[e]++,this._updatePerformanceMetrics(e,t),t>100&&(this.stats.performance_metrics.slow_operations++,console.warn(`\u26A0\uFE0F Slow ${e} operation: ${t.toFixed(2)}ms`)),this.lastActivity=Date.now()}getConnectionHealth(){let e=Date.now()-this.lastActivity;return{is_locked:this.connectionLock,queue_length:this.connectionQueue.length,time_since_activity:e,is_healthy:!this.connectionLock&&e<3e5,prepared_statements:Object.keys(this.preparedStatements).length}}async close(){if(this.databaseOps&&this.databaseOps.db)return this.connectionLock=!0,await new Promise(e=>setTimeout(e,100)),new Promise(e=>{this.databaseOps.db.close(t=>{t?console.error("Error closing database:",t.message):console.error("\u2705 Memory system database closed"),this.databaseOps.db=null,this.connectionLock=!1,e()})})}_updatePerformanceMetrics(e,t){let s=`avg_${e}_time`;if(this.stats.performance_metrics[s]!==void 0){let i=this.stats.performance_metrics[s],r=this.stats.operation_counts[e]||1;this.stats.performance_metrics[s]=(i*(r-1)+t)/r}}resetStats(){this.stats.operation_counts={store:0,query:0,search:0,batch:0},this.stats.performance_metrics={avg_store_time:0,avg_query_time:0,avg_search_time:0,slow_operations:0},console.log("\u2705 Performance statistics reset")}async generateReport(){try{let e=await this.getSystemStats(),t=this.getConnectionHealth();return{timestamp:new Date().toISOString(),system:e,connection:t,recommendations:this._generateRecommendations(e,t)}}catch(e){throw console.error(`\u274C Failed to generate performance report: ${e.message}`),e}}_generateRecommendations(e,t){let s=[];return e.performance.slow_operations>10&&s.push({type:"performance",priority:"high",message:"High number of slow operations detected. Consider optimizing queries or adding indexes."}),e.database.size_bytes>100*1024*1024&&s.push({type:"storage",priority:"medium",message:"Database size is large. Consider running cleanup or archiving old data."}),t.is_healthy||s.push({type:"connection",priority:"high",message:"Database connection issues detected. Check for locks or high query load."}),s}};u(bo,"PerformanceMonitor");var wo=bo;Cd.exports={PerformanceMonitor:wo}});var Id=w((Iv,Od)=>{var ob=pt(),ab=require("path"),So=require("sqlite3").verbose(),{DatabaseOperations:cb}=Vc(),{ConfigurationManager:lb}=Uh(),{MemoryEntry:Eo,MemoryStorage:ub}=pd(),{SearchOperations:hb}=Td(),{EntityRelationshipManager:db}=Nd(),{PerformanceMonitor:fb}=Ad(),{entityExtractor:mb}=po(),To=class To{constructor(e=null){this.configManager=new lb,this.config=this.configManager.loadConfig(e),this.db_path=this.configManager.expandPath(this.config.storage.path),this.databaseOps=new cb(this.db_path),this.databaseOps.initDatabase(),this.db=this.databaseOps.db,this.preparedStatements={},this.stats={total_entries:0,cache_hits:0,cache_misses:0,queries_executed:0,average_query_time:0,last_updated:new Date().toISOString(),last_cleanup:null,cleanup_count:0},this.queryCache=new Map,this.memoryStorage=new ub(this.databaseOps,this.config),this.searchOps=new hb(this.databaseOps,this.config),this.entityManager=new db(this.databaseOps,this.config),this.performanceMonitor=new fb(this.databaseOps,this.config),this.searchEngine=this.searchOps.searchEngine,this.performanceMonitor.prepareStatements(),this._prepareStatements(),console.error(`\u2705 Enhanced memory system initialized with modular components: ${this.db_path}`)}dbRun(e,t=[],s=3){return this.databaseOps.dbRun(e,t,s)}dbGet(e,t=[],s=3){return this.databaseOps.dbGet(e,t,s)}dbAll(e,t=[],s=3){return this.databaseOps.dbAll(e,t,s)}_loadConfig(e){return this.configManager.loadConfig(e)}_expandPath(e){return this.configManager.expandPath(e)}_initDatabase(){try{ob.ensureDirSync(ab.dirname(this.db_path)),this.db=new So.Database(this.db_path,So.OPEN_READWRITE|So.OPEN_CREATE),this.db.run("PRAGMA journal_mode = WAL"),this.db.run("PRAGMA synchronous = NORMAL"),this.db.run("PRAGMA cache_size = 50000"),this.db.run("PRAGMA temp_store = MEMORY"),this.db.run("PRAGMA mmap_size = 268435456"),this.db.run("PRAGMA page_size = 4096"),this.db.run("PRAGMA locking_mode = NORMAL"),this.db.run("PRAGMA busy_timeout = 30000"),this.db.run("PRAGMA wal_autocheckpoint = 1000"),this._createSchemaBlocking(),this._prepareStatements(),console.error("\u2705 Database schema initialized with performance optimizations")}catch(e){throw console.error(`\u274C Failed to initialize database: ${e.message}`),e}}_createSchemaBlocking(){this.db.serialize(()=>{this.db.run(`
        CREATE TABLE IF NOT EXISTS memory_entries (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          content TEXT NOT NULL,
          memory_type VARCHAR(50) NOT NULL,
          session_id VARCHAR(100),
          timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
          tags TEXT,
          tool_used VARCHAR(100),
          confidence_score FLOAT DEFAULT 1.0,
          metadata TEXT,
          embedding TEXT
        )
      `),this.db.run(`
        CREATE TABLE IF NOT EXISTS entities (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          name TEXT NOT NULL UNIQUE,
          type VARCHAR(50) DEFAULT 'unknown',
          first_seen DATETIME DEFAULT CURRENT_TIMESTAMP,
          last_updated DATETIME DEFAULT CURRENT_TIMESTAMP,
          mention_count INTEGER DEFAULT 0,
          confidence FLOAT DEFAULT 1.0,
          metadata TEXT
        )
      `),this.db.run(`
        CREATE TABLE IF NOT EXISTS memory_entity_links (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          memory_id INTEGER NOT NULL,
          entity_id INTEGER NOT NULL,
          confidence FLOAT DEFAULT 1.0,
          timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
          FOREIGN KEY (memory_id) REFERENCES memory_entries(id),
          FOREIGN KEY (entity_id) REFERENCES entities(id),
          UNIQUE(memory_id, entity_id)
        )
      `),this.db.run(`
        CREATE TABLE IF NOT EXISTS relationships (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          entity1 TEXT NOT NULL,
          entity1_type VARCHAR(50) DEFAULT 'unknown',
          entity2 TEXT NOT NULL,
          entity2_type VARCHAR(50) DEFAULT 'unknown',
          relation VARCHAR(100) NOT NULL,
          confidence FLOAT DEFAULT 1.0,
          timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
          metadata TEXT
        )
      `),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_type ON memory_entries(memory_type)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_session_id ON memory_entries(session_id)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_timestamp ON memory_entries(timestamp)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_tool_used ON memory_entries(tool_used)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_entity_name ON entities(name)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_entity_type ON entities(type)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_entity_mention_count ON entities(mention_count)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_entity_memory_id ON memory_entity_links(memory_id)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_memory_entity_entity_id ON memory_entity_links(entity_id)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_entity1 ON relationships(entity1)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_entity2 ON relationships(entity2)"),this.db.run("CREATE INDEX IF NOT EXISTS idx_relation ON relationships(relation)"),this.db.run(`
        CREATE VIRTUAL TABLE IF NOT EXISTS memory_fts USING fts5(
          content,
          tags,
          content=memory_entries,
          content_rowid=id
        )
      `,e=>{e?(console.error("\u26A0\uFE0F FTS5 not available, falling back to LIKE queries:",e.message),this.db.run(`
            CREATE VIRTUAL TABLE IF NOT EXISTS memory_fts USING fts4(
              content,
              tags,
              notindexed=tags
            )
          `,t=>{t?(console.error("\u26A0\uFE0F FTS4 also not available:",t.message),this.ftsAvailable=!1):(console.log("\u2705 FTS4 virtual table created for fast search"),this.ftsAvailable=!0,this.ftsVersion=4)})):(console.log("\u2705 FTS5 virtual table created for fast search"),this.ftsAvailable=!0,this.ftsVersion=5)}),this.db.run(`
        CREATE TRIGGER IF NOT EXISTS memory_fts_insert AFTER INSERT ON memory_entries BEGIN
          INSERT INTO memory_fts(rowid, content, tags) VALUES (new.id, new.content, new.tags);
        END
      `),this.db.run(`
        CREATE TRIGGER IF NOT EXISTS memory_fts_delete AFTER DELETE ON memory_entries BEGIN
          DELETE FROM memory_fts WHERE rowid = old.id;
        END
      `),this.db.run(`
        CREATE TRIGGER IF NOT EXISTS memory_fts_update AFTER UPDATE ON memory_entries BEGIN
          DELETE FROM memory_fts WHERE rowid = old.id;
          INSERT INTO memory_fts(rowid, content, tags) VALUES (new.id, new.content, new.tags);
        END
      `)})}_prepareStatements(){try{if(this.preparedStatements||(this.preparedStatements={}),!this.db){console.error("\u274C Cannot prepare statements: Database not initialized");return}this.preparedStatements.insertSQL=`
        INSERT INTO memory_entries 
        (content, memory_type, session_id, timestamp, tags, tool_used, confidence_score, metadata, embedding)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
      `,console.log("\u2705 Prepared statements initialized")}catch(e){console.error("\u274C Failed to prepare statements:",e.message),this.preparedStatements={}}}async store(e){try{let t=process.hrtime.bigint();e instanceof Eo||(e=new Eo(e)),(e.confidence_score<0||e.confidence_score>1)&&(e.confidence_score=Math.max(0,Math.min(1,e.confidence_score)));let s=mb.processMemoryContent(e.content,e.tags);e.tags=s.enhancedTags,e.metadata={...e.metadata,auto_entities:s.entities,auto_relationships:s.relationships,entity_count:s.entityCount,relationship_count:s.relationshipCount,entity_extraction_version:"1.0"};let i=[e.content,e.memory_type,e.session_id,e.timestamp.toISOString(),JSON.stringify(e.tags),e.tool_used,e.confidence_score,JSON.stringify(e.metadata),e.embedding?JSON.stringify(e.embedding):null],r,o=this.preparedStatements.insertSQL||`INSERT INTO memory_entries 
        (content, memory_type, session_id, timestamp, tags, tool_used, confidence_score, metadata, embedding)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`;r=await this.dbRun(o,i);let a=r.lastID.toString();this.stats.total_entries++,this._clearCacheByPattern(["query_","search_","stats_"]);let c=process.hrtime.bigint(),l=Number(c-t)/1e6;if(l>25&&console.warn(`\u26A0\uFE0F Slow storage operation: ${l.toFixed(2)}ms (target: <25ms)`),s.entities&&s.entities.length>0)try{for(let h of s.entities)if(h&&typeof h=="string"&&h.trim().length>0){let d=h.trim();await this.dbRun(`
                INSERT OR REPLACE INTO entities (name, type, last_updated, mention_count, confidence, metadata)
                VALUES (?, ?, ?, 
                  COALESCE((SELECT mention_count FROM entities WHERE name = ?), 0) + 1,
                  ?, ?)
              `,[d,"auto_extracted",new Date().toISOString(),d,.8,JSON.stringify({extraction_version:"1.0",last_memory_id:a})]);let f=await this.dbGet("SELECT id FROM entities WHERE name = ?",[d]);f&&await this.dbRun(`
                  INSERT OR IGNORE INTO memory_entity_links (memory_id, entity_id, confidence)
                  VALUES (?, ?, ?)
                `,[a,f.id,.8])}}catch(h){console.warn(`\u26A0\uFE0F Failed to store some entities: ${h.message}`)}if(s.relationships&&s.relationships.length>0)try{for(let h of s.relationships){let d=h.split(" \u2192 ");if(d.length===3){let[f,m,y]=d;await this.storeRelationship({entity1:f.trim(),entity1_type:"auto_extracted",entity2:y.trim(),entity2_type:"auto_extracted",relation:m.trim(),confidence:.8,metadata:JSON.stringify({memory_id:a,extraction_version:"1.0"})})}}}catch(h){console.warn(`\u26A0\uFE0F Failed to store some relationships: ${h.message}`)}return console.log(`\u2705 Memory entry stored with ID: ${a} (${l.toFixed(2)}ms)`),s.entities.length>0&&console.log(`\u{1F517} Extracted ${s.entities.length} entities, ${s.relationships.length} relationships`),a}catch(t){throw console.error(`\u274C Failed to store memory entry: ${t.message}`),t}}async query(e={},t=null){try{let s=process.hrtime.bigint();t=t||this.config.query.default_limit;let i=`query_${JSON.stringify(e)}_${t}`,r=this._getFromCache(i);if(r){let f=process.hrtime.bigint(),m=Number(f-s)/1e6;return console.log(`\u{1F680} Query served from cache (${m.toFixed(2)}ms)`),r}let o="SELECT * FROM memory_entries WHERE 1=1",a=[];e.memory_type&&(o+=" AND memory_type = ?",a.push(e.memory_type)),e.session_id&&(o+=" AND session_id = ?",a.push(e.session_id)),e.tool_used&&(o+=" AND tool_used = ?",a.push(e.tool_used)),e.min_confidence&&(o+=" AND confidence_score >= ?",a.push(e.min_confidence)),e.tags&&e.tags.length>0&&(o+=" AND tags LIKE ?",a.push(`%${e.tags[0]}%`)),e.content_search&&(o+=" AND content LIKE ?",a.push(`%${e.content_search}%`)),o+=" ORDER BY timestamp DESC",t&&(o+=" LIMIT ?",a.push(t));let l=(await this.dbAll(o,a)).map(f=>({...f,timestamp:new Date(f.timestamp),tags:JSON.parse(f.tags||"[]"),metadata:JSON.parse(f.metadata||"{}"),embedding:f.embedding?JSON.parse(f.embedding):null}));this._setCache(i,l);let h=process.hrtime.bigint(),d=Number(h-s)/1e6;return d>10&&console.warn(`\u26A0\uFE0F Slow query operation: ${d.toFixed(2)}ms (target: <10ms)`),console.log(`\u2705 Query executed (${d.toFixed(2)}ms) - ${l.length} results`),l}catch(s){throw console.error(`\u274C Failed to query memories: ${s.message}`),s}}async search(e,t=null,s={}){try{if(s.mode){let r={smart:"hybrid",precise:"tfidf",fast:"bm25",balanced:"hybrid"};s.algorithm=r[s.mode]||"hybrid"}return await this.searchOps.search(e,t||this.config.query.default_limit,s)}catch(i){return console.error(`\u274C Failed to search memories: ${i.message}`),[]}}async advancedSearch(e,t={}){let s=t.outputMode||t.output_mode||"detailed";try{let i=process.hrtime.bigint(),{TextProcessor:r}=ze(),a=new r().tokenize(e),c,l;if(a.length<=1){c=`
          SELECT * FROM memory_entries 
          WHERE content LIKE ? OR tags LIKE ?
          ORDER BY timestamp DESC
        `;let p=`%${e}%`;l=[p,p]}else{c=`
          SELECT * FROM memory_entries 
          WHERE ${a.map(()=>"content LIKE ? OR tags LIKE ?").join(" OR ")}
          ORDER BY timestamp DESC
        `,l=[];for(let g of a)l.push(`%${g}%`,`%${g}%`)}let d=(await this.dbAll(c,l)).map(p=>({...p,id:p.id,timestamp:new Date(p.timestamp),tags:JSON.parse(p.tags||"[]"),metadata:JSON.parse(p.metadata||"{}"),embedding:p.embedding?JSON.parse(p.embedding):null})),f;d.length>0?(t.algorithm&&t.algorithm!==this.searchEngine.algorithm&&this.searchEngine.setAlgorithm(t.algorithm),f=this.searchEngine.search(e,d,t),t.limit&&(f.results=f.results.slice(0,t.limit),f.rankedDocuments=f.results.length)):f={results:[],algorithm:"smart",duration:0,totalDocuments:0,rankedDocuments:0,performance_metrics:{algorithm:"smart",query_terms:0,documents_processed:0,results_returned:0,processing_time_ms:0}};let m=process.hrtime.bigint(),y=Number(m-i)/1e6;if(y>25&&console.warn(`\u26A0\uFE0F Slow search operation: ${y.toFixed(2)}ms (target: <25ms)`),console.log(`\u2705 Advanced search executed (${y.toFixed(2)}ms) - ${f.results.length} results for "${e}" using ${f.algorithm}`),f.results&&f.results.length>0&&(f.results=f.results.map(p=>{let g=0;p.hybrid_score!==void 0?g=p.hybrid_score:p.tfidf_score!==void 0?g=p.tfidf_score:p.bm25_score!==void 0&&(g=p.bm25_score);let b={...p,score:g};return s==="clean"?{id:b.id,content:b.content,score:b.score,timestamp:b.timestamp,tags:b.tags||[]}:b})),t.mode){let p={smart:"Best Smart",precise:"Precision Focus",fast:"Quick Match",balanced:"Smart Balance"};f.algorithm=p[t.mode]||f.algorithm}return s==="clean"?{results:f.results,algorithm:f.algorithm,duration:f.duration}:f}catch(i){throw console.error(`\u274C Failed to perform advanced search: ${i.message}`),i}}getSearchAlgorithms(){return{modes:["smart","precise","fast","balanced"],descriptions:{smart:"AI-like balanced approach that adapts to your query",precise:"Best for exact matches and technical terms",fast:"Quick results for natural language queries",balanced:"Default mode with good overall performance"},current:"smart"}}setSearchAlgorithm(e){this.searchEngine.setAlgorithm(e)}getSearchAlgorithm(){return this.searchEngine.algorithm}getSearchPerformanceStats(){return this.searchEngine.getPerformanceStats?this.searchEngine.getPerformanceStats():{message:"Performance stats available only with optimized search engine"}}getOptimizationConfig(){return this.searchEngine.getOptimizationConfig?this.searchEngine.getOptimizationConfig():{enabled:!1,message:"Optimizations not enabled"}}setOptimizationPhase(e,t){if(this.searchEngine.setOptimizationPhase)return this.searchEngine.setOptimizationPhase(e,t),{success:!0,phase:e,enabled:t};throw new Error("Optimization phases not available with standard search engine")}clearSearchOptimizations(){return this.searchEngine.clearOptimizations?(this.searchEngine.clearOptimizations(),{success:!0,message:"Optimization caches cleared"}):{success:!1,message:"No optimizations to clear"}}async getStats(){try{let e=await this.dbGet("SELECT COUNT(*) as count FROM memory_entries");this.stats.total_entries=e.count;let t=await this.dbGet(`
        SELECT timestamp FROM memory_entries 
        ORDER BY timestamp DESC LIMIT 1
      `);return{...this.stats,last_entry:t?new Date(t.timestamp):null,database_path:this.db_path}}catch(e){throw console.error(`\u274C Failed to get stats: ${e.message}`),e}}async getMemoryCategories(){try{let e=await this.dbAll(`
        SELECT memory_type, COUNT(*) as count 
        FROM memory_entries 
        GROUP BY memory_type 
        ORDER BY count DESC
      `),t={available_types:["observation","action","result","error","context","general"],distribution:{},total_entries:0};for(let s of e)t.distribution[s.memory_type]=s.count,t.total_entries+=s.count;return t}catch(e){throw console.error(`\u274C Failed to get memory categories: ${e.message}`),e}}async cleanup(e=!1){try{if(this.config.retention||(this.config.retention={archive_old:!0,days:30}),!e&&!this.config.retention.archive_old)return console.log("\u26A0\uFE0F Cleanup skipped - archive_old is disabled"),{cleaned:0,message:"Cleanup disabled"};let t=new Date;t.setDate(t.getDate()-this.config.retention.days);let s="DELETE FROM memory_entries WHERE timestamp < ?";try{await this.dbGet("SELECT 1 as test")}catch(r){if(r.code==="SQLITE_BUSY")return console.log("\u26A0\uFE0F Database is busy, skipping cleanup"),{cleaned:0,message:"Database busy, cleanup skipped"};throw r}let i=await this.dbRun(s,[t.toISOString()]);return this.stats.cleanup_count++,this.stats.last_cleanup=new Date,console.log(`\u2705 Cleaned up ${i.changes} old memory entries`),{cleaned:i.changes,cutoff_date:t}}catch(t){if(t.code==="SQLITE_BUSY")return console.log("\u26A0\uFE0F Database is busy, cleanup skipped"),{cleaned:0,message:"Database busy, cleanup skipped"};throw console.error(`\u274C Failed to cleanup memories: ${t.message}`),t}}_getFromCache(e){let t=this.queryCache.get(e);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.data:(t&&this.queryCache.delete(e),null)}_setCache(e,t){if(this.queryCache.size>=this.maxCacheSize){let s=this.queryCache.keys().next().value;this.queryCache.delete(s)}this.queryCache.set(e,{data:t,timestamp:Date.now()})}_clearCacheByPattern(e){for(let t of this.queryCache.keys())e.some(s=>t.startsWith(s))&&this.queryCache.delete(t)}async storeBatch(e){if(!Array.isArray(e)||e.length===0)return[];try{let t=process.hrtime.bigint(),s=`
        INSERT INTO memory_entries 
        (content, memory_type, session_id, timestamp, tags, tool_used, confidence_score, metadata, embedding)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
      `,i=[];for(let c of e){(c.confidence_score<0||c.confidence_score>1)&&(c.confidence_score=Math.max(0,Math.min(1,c.confidence_score)));let l=[c.content,c.memory_type,c.session_id,c.timestamp.toISOString(),JSON.stringify(c.tags),c.tool_used,c.confidence_score,JSON.stringify(c.metadata),c.embedding?JSON.stringify(c.embedding):null],h=await this.dbRun(s,l);i.push(h.lastID.toString())}this.stats.total_entries+=e.length,this._clearCacheByPattern(["query_","search_","stats_"]);let r=process.hrtime.bigint(),o=Number(r-t)/1e6,a=o/e.length;return console.log(`\u2705 Batch stored ${e.length} entries (${o.toFixed(2)}ms total, ${a.toFixed(2)}ms avg)`),i}catch(t){throw console.error(`\u274C Failed to batch store memories: ${t.message}`),t}}async close(){if(this.db)return this.connectionLock=!0,await new Promise(e=>setTimeout(e,100)),new Promise(e=>{this.db.close(t=>{t?console.error("Error closing database:",t.message):console.error("\u2705 Memory system database closed"),this.db=null,this.connectionLock=!1,e()})})}async storeRelationship(e){try{let{entity1:t,entity1_type:s="unknown",entity2:i,entity2_type:r="unknown",relation:o,confidence:a=1,metadata:c=null}=e;if(!t||!i||!o)throw new Error("Missing required relationship data: entity1, entity2, relation");let l=0,h=3;for(;l<h;)try{await this.dbGet("SELECT name FROM sqlite_master WHERE type='table' AND name='relationships'")||(console.error("Relationships table not found, creating it..."),this._createSchemaBlocking(),await new Promise(y=>setTimeout(y,10)));let f=`
            INSERT INTO relationships (entity1, entity1_type, entity2, entity2_type, relation, confidence, timestamp, metadata)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
          `,m=new Date().toISOString();return await this.dbRun(f,[t,s,i,r,o,a,m,c]),console.log(`\u2705 Relationship stored: ${t} \u2192 ${o} \u2192 ${i} (confidence: ${a})`),!0}catch(d){if(d.message.includes("no such table")&&l<h-1){console.error(`Retry ${l+1}: Table creation race condition, retrying...`),l++,await new Promise(f=>setTimeout(f,50*l));continue}throw d}}catch(t){throw console.error("Error storing relationship:",t.message),t}}async validateCrossReferences(){try{let e=await this.query({},1e3),t=0,s=0,i=0;for(let l of e)l.metadata&&l.metadata.auto_entities&&l.metadata.auto_entities.length>0&&(t++,s+=l.metadata.auto_entities.length),l.metadata&&l.metadata.auto_relationships&&l.metadata.auto_relationships.length>0&&i++;let r=e.length>0?t/e.length:0,o=e.length>0?i/e.length:0,a=t>0?s/t:0,c={total_memories:e.length,memories_with_entities:t,memories_with_relationships:i,total_entity_references:s,memory_integrity:r,relationship_integrity:o,average_entities_per_memory:a,quality_score:(r+o)/2};return console.log(`\u{1F4CA} Cross-reference validation: ${(r*100).toFixed(1)}% memory integrity`),c}catch(e){throw console.error("Error validating cross-references:",e.message),e}}async generateMemoryMap(e={}){try{let{format:t="json",layout:s="hierarchical",focus_entity:i=null,include_confidence:r=!0}=e,o=await this.query({},1e3),a=new Map,c=[];for(let d of o)d.metadata&&d.metadata.auto_entities&&d.metadata.auto_entities.forEach(f=>{a.has(f)||a.set(f,{name:f,type:"entity"})}),d.metadata&&d.metadata.auto_relationships&&d.metadata.auto_relationships.forEach(f=>{if(typeof f=="string"&&f.includes(" \u2192 ")){let m=f.split(" \u2192 ");m.length>=3&&(a.has(m[0])||a.set(m[0],{name:m[0],type:"entity"}),a.has(m[2])||a.set(m[2],{name:m[2],type:"entity"}),c.push({source:m[0].toLowerCase().replace(/\s+/g,"_"),target:m[2].toLowerCase().replace(/\s+/g,"_"),relation:m[1],confidence:.8}))}});try{let f=await this.dbAll("SELECT * FROM relationships");for(let m of f)a.has(m.entity1)||a.set(m.entity1,{name:m.entity1,type:m.entity1_type||"entity"}),a.has(m.entity2)||a.set(m.entity2,{name:m.entity2,type:m.entity2_type||"entity"}),c.push({source:m.entity1.toLowerCase().replace(/\s+/g,"_"),target:m.entity2.toLowerCase().replace(/\s+/g,"_"),relation:m.relation,confidence:m.confidence||.8})}catch(d){console.error("Error reading relationships table:",d.message)}let l=Array.from(a.values()).map(d=>({id:d.name.toLowerCase().replace(/\s+/g,"_"),label:d.name,type:d.type})),h;return t==="mermaid"?h=this._generateMermaidContent(l,c,s):t==="dot"?h=this._generateDotContent(l,c):h=JSON.stringify({nodes:l,edges:c},null,2),{format:t,layout:s,focus_entity:i,content:h,statistics:{total_nodes:l.length,total_edges:c.length,node_types:{entity:l.length}}}}catch(t){throw console.error("Error generating memory map:",t.message),t}}_generateMermaidContent(e,t,s){let i=`graph TD
`;return e.forEach(r=>{i+=`    ${r.id}[${r.label}]
`}),i+=`
`,t.forEach(r=>{let o=r.source.toLowerCase().replace(/\s+/g,"_"),a=r.target.toLowerCase().replace(/\s+/g,"_");i+=`    ${o} --> ${a} : ${r.relation} (${r.confidence.toFixed(2)})
`}),i}_generateDotContent(e,t){let s=`digraph memory_map {
`;return s+=`    rankdir=TB;

`,e.forEach(i=>{s+=`    "${i.id}" [label="${i.label}"];
`}),s+=`
`,t.forEach(i=>{let r=i.source.toLowerCase().replace(/\s+/g,"_"),o=i.target.toLowerCase().replace(/\s+/g,"_");s+=`    "${r}" -> "${o}" [label="${i.relation}"];
`}),s+="}",s}async getNetworkStatistics(){try{let e=await this.query({},1e3),t=new Set,s=0,i=0,r=0;for(let h of e)h.metadata&&h.metadata.auto_entities&&h.metadata.auto_entities.forEach(d=>t.add(d)),h.metadata&&h.metadata.auto_relationships&&(s+=h.metadata.auto_relationships.length,h.metadata.auto_relationships.forEach(d=>{i+=.8}));try{let d=await this.dbAll("SELECT * FROM relationships");for(let f of d){t.add(f.entity1),t.add(f.entity2),s++;let m=f.confidence||.8;i+=m,m>.8&&r++}}catch(h){console.error("Error reading relationships table for statistics:",h.message)}let o=Array.from(t),a=o.length*(o.length-1),c=a>0?s/a:0,l=s>0?i/s:0;return{overview:{total_entities:o.length,total_relationships:s,network_density:c},entity_analysis:{most_connected:o.slice(0,3).map(h=>({entity:h.toLowerCase().replace(/\s+/g,"_"),connections:2})),average_connections:o.length>0?s*2/o.length:0},confidence_distribution:{high:r,average_confidence:l}}}catch(e){throw console.error("Error getting network statistics:",e.message),e}}async detectConflicts(){try{let e={total_conflicts:0,conflict_types:{ENTITY_DUPLICATE:0,RELATIONSHIP_CONTRADICTION:0,CONFIDENCE_DISCREPANCY:0,TYPE_MISMATCH:0,TEMPORAL_INCONSISTENCY:0},details:[],resolution_suggestions:[],data_quality_score:1},s=await this.dbAll("SELECT * FROM relationships ORDER BY entity1, entity2, relation");console.log(`\u{1F50D} Analyzing ${s.length} relationships for conflicts...`);let i=new Map;s.forEach(c=>{[c.entity1,c.entity2].forEach(l=>{let h=l.toLowerCase();i.has(h)||i.set(h,[]),i.get(h).push(l)})}),i.forEach((c,l)=>{if(c.length>1){let h=[...new Set(c)];h.length>1&&(e.conflict_types.ENTITY_DUPLICATE++,e.details.push({type:"ENTITY_DUPLICATE",entities:h,description:`Entity variations found: ${h.join(", ")}`,severity:"medium"}),e.resolution_suggestions.push({conflict_id:`dup_${e.details.length}`,action:`Standardize entity name to: ${h[0]}`,rationale:"Normalize case and spelling variations",confidence:.8}))}});let r=new Map;s.forEach(c=>{r.has(c.entity1)||r.set(c.entity1,[]),r.get(c.entity1).push({to:c.entity2,relation:c.relation,confidence:c.confidence})}),s.forEach(c=>{c.relation==="reports_to"&&s.find(h=>h.entity1===c.entity2&&h.entity2===c.entity1&&h.relation==="reports_to")&&(e.conflict_types.RELATIONSHIP_CONTRADICTION++,e.details.push({type:"RELATIONSHIP_CONTRADICTION",entities:[c.entity1,c.entity2],description:`Circular reporting relationship: ${c.entity1} reports to ${c.entity2} and vice versa`,severity:"high"}),e.resolution_suggestions.push({conflict_id:`circ_${e.details.length}`,action:"Remove one reporting relationship based on confidence scores",rationale:"Eliminate circular hierarchy",confidence:.9}))});let o=new Map;s.forEach(c=>{let l=`${c.entity1}|${c.entity2}|${c.relation}`;o.has(l)||o.set(l,[]),o.get(l).push(c)}),o.forEach((c,l)=>{if(c.length>1){let h=c.map(y=>y.confidence),d=Math.max(...h),f=Math.min(...h),m=d-f;if(m>.4){e.conflict_types.CONFIDENCE_DISCREPANCY++;let[y,p,g]=l.split("|");e.details.push({type:"CONFIDENCE_DISCREPANCY",entities:[y,p],relation:g,confidence_difference:m,confidence_range:`${f.toFixed(2)} - ${d.toFixed(2)}`,description:`Large confidence discrepancy (${(m*100).toFixed(1)}%) for relationship: ${y} \u2192 ${g} \u2192 ${p}`,severity:"medium"}),e.resolution_suggestions.push({conflict_id:`conf_${e.details.length}`,action:`Use highest confidence value (${d.toFixed(2)}) and remove duplicates`,rationale:"Resolve confidence ambiguity with most reliable source",confidence:.7})}}}),e.total_conflicts=Object.values(e.conflict_types).reduce((c,l)=>c+l,0);let a=s.length;return a>0&&(e.data_quality_score=Math.max(0,1-e.total_conflicts/a)),console.log(`\u{1F50D} Conflict detection completed: ${e.total_conflicts} conflicts found`),e}catch(e){return console.error("Error detecting conflicts:",e.message),{total_conflicts:0,conflict_types:{ENTITY_DUPLICATE:0,RELATIONSHIP_CONTRADICTION:0,CONFIDENCE_DISCREPANCY:0,TYPE_MISMATCH:0,TEMPORAL_INCONSISTENCY:0},details:[],resolution_suggestions:[],data_quality_score:1}}}};u(To,"EnhancedMemorySystem");var _o=To;Od.exports={EnhancedMemorySystem:_o,MemoryEntry:Eo}});var Ld=w((Lv,Dd)=>{var ko=class ko{constructor(e,t){this.memorySystem=e,this.relationshipEngine=t,this.conflictTypes=new Map,this.initializeConflictTypes()}initializeConflictTypes(){this.conflictTypes.set("ENTITY_DUPLICATE",{name:"Entity Duplicate",description:"Multiple entities that might represent the same thing",severity:"medium",detector:this.detectEntityDuplicates.bind(this)}),this.conflictTypes.set("RELATIONSHIP_CONTRADICTION",{name:"Relationship Contradiction",description:"Contradictory relationships between entities",severity:"high",detector:this.detectRelationshipContradictions.bind(this)}),this.conflictTypes.set("ATTRIBUTE_INCONSISTENCY",{name:"Attribute Inconsistency",description:"Same entity with conflicting attributes",severity:"medium",detector:this.detectAttributeInconsistencies.bind(this)}),this.conflictTypes.set("TEMPORAL_VIOLATION",{name:"Temporal Violation",description:"Timeline inconsistencies",severity:"high",detector:this.detectTemporalViolations.bind(this)}),this.conflictTypes.set("CONFIDENCE_DISCREPANCY",{name:"Confidence Discrepancy",description:"High vs low confidence for similar information",severity:"low",detector:this.detectConfidenceDiscrepancies.bind(this)})}async detectConflicts(e={}){let t=[],s=e.types||Array.from(this.conflictTypes.keys());for(let i of s){let r=this.conflictTypes.get(i);if(r){let o=await r.detector(e);t.push(...o)}}return this.rankConflicts(t,e.limit)}async detectEntityDuplicates(e={}){let t=Array.from(this.relationshipEngine.relationships.values()),s=new Map;t.forEach(r=>{[r.entity1,r.entity2].forEach(o=>{let a=this.normalizeEntity(o);s.has(a)||s.set(a,[]),s.get(a).push(o)})});let i=[];for(let[r,o]of s)if(o.length>1){let a=[...new Set(o)];a.length>1&&i.push({type:"ENTITY_DUPLICATE",severity:"medium",entities:a,description:`Potential duplicate entities: ${a.join(", ")}`,confidence:this.calculateSimilarity(a),suggestion:`Consider merging these entities: ${a.join(" \u2192 ")}`,timestamp:new Date().toISOString()})}return i}async detectRelationshipContradictions(e={}){let t=Array.from(this.relationshipEngine.relationships.values()),s=[],i=new Map;t.forEach(r=>{let o=`${r.entity1}:${r.entity2}`,a=`${r.entity2}:${r.entity1}`;i.has(o)||i.set(o,[]),i.get(o).push(r),i.has(a)||i.set(a,[])});for(let[r,o]of i)if(o.length>1){let a=o.map(c=>c.relation);this.areRelationsContradictory(a)&&s.push({type:"RELATIONSHIP_CONTRADICTION",severity:"high",entities:r.split(":"),relationships:o.map(c=>({relation:c.relation,confidence:c.confidence,timestamp:c.timestamp})),description:`Contradictory relationships: ${a.join(" vs ")}`,confidence:.8,suggestion:"Review and resolve contradictory relationships",timestamp:new Date().toISOString()})}return s}async detectAttributeInconsistencies(e={}){let t=await this.memorySystem.query({},1e3),s=new Map;t.forEach(r=>{this.extractEntitiesFromContent(r.content).forEach(a=>{s.has(a.name)||s.set(a.name,[]),s.get(a.name).push({attributes:a.attributes,memory_id:r.id,confidence:r.confidence_score,content:r.content.substring(0,100)})})});let i=[];for(let[r,o]of s)if(o.length>1){let a=this.findAttributeInconsistencies(o);a.length>0&&i.push({type:"ATTRIBUTE_INCONSISTENCY",severity:"medium",entity:r,inconsistencies:a,description:`Attribute inconsistencies for ${r}`,confidence:.7,suggestion:"Verify and consolidate entity attributes",timestamp:new Date().toISOString()})}return i}async detectTemporalViolations(e={}){let t=Array.from(this.relationshipEngine.relationships.values()),s=[],i=t.filter(a=>a.relation.includes("before")||a.relation.includes("after")||a.relation.includes("during")||a.relation.includes("started")||a.relation.includes("ended"));if(i.length===0)return s;let r=this.buildTemporalGraph(i);return this.detectCycles(r).forEach(a=>{s.push({type:"TEMPORAL_VIOLATION",severity:"high",cycle:a,description:`Temporal cycle detected: ${a.join(" \u2192 ")}`,confidence:.9,suggestion:"Review temporal relationships for logical consistency",timestamp:new Date().toISOString()})}),s}async detectConfidenceDiscrepancies(e={}){let t=Array.from(this.relationshipEngine.relationships.values()),s=[],i=new Map;t.forEach(r=>{let o=`${r.entity1}:${r.relation}:${r.entity2}`;i.has(o)||i.set(o,[]),i.get(o).push(r)});for(let[r,o]of i)if(o.length>1){let a=o.map(h=>h.confidence),c=Math.max(...a),l=Math.min(...a);c-l>.5&&s.push({type:"CONFIDENCE_DISCREPANCY",severity:"low",relationship:r,relationships:o.map(h=>({id:h.id,confidence:h.confidence,timestamp:h.timestamp})),description:`Confidence discrepancy: ${l.toFixed(2)} vs ${c.toFixed(2)}`,confidence:c-l,suggestion:"Review and reconcile confidence scores",timestamp:new Date().toISOString()})}return s}normalizeEntity(e){return e.toLowerCase().trim().replace(/[^a-z0-9]/g,"")}calculateSimilarity(e){if(e.length<=1)return 0;let t=0,s=0;for(let i=0;i<e.length;i++)for(let r=i+1;r<e.length;r++){let o=this.stringSimilarity(e[i],e[r]);t+=o,s++}return s>0?t/s:0}stringSimilarity(e,t){let s=e.length>t.length?e:t,i=e.length>t.length?t:e;if(s.length===0)return 1;let r=this.levenshteinDistance(s,i);return(s.length-r)/s.length}levenshteinDistance(e,t){let s=[];for(let i=0;i<=t.length;i++)s[i]=[i];for(let i=0;i<=e.length;i++)s[0][i]=i;for(let i=1;i<=t.length;i++)for(let r=1;r<=e.length;r++)t.charAt(i-1)===e.charAt(r-1)?s[i][r]=s[i-1][r-1]:s[i][r]=Math.min(s[i-1][r-1]+1,s[i][r-1]+1,s[i-1][r]+1);return s[t.length][e.length]}areRelationsContradictory(e){let t=[["works_at","fired_from"],["works_at","quit_from"],["friends_with","enemies_with"],["likes","hates"],["owns","sold"],["bought","sold"],["married_to","divorced_from"],["hired","fired"],["started","ended"],["connected_to","disconnected_from"]];for(let[s,i]of t)if(e.includes(s)&&e.includes(i))return!0;return!1}extractEntitiesFromContent(e){let t=[],s=e.split(/\s+/);return s.forEach((i,r)=>{let o=i.replace(/[^a-zA-Z]/g,"");o.match(/^[A-Z][a-z]+$/)&&t.push({name:o.toLowerCase(),attributes:{position:r,original:i,context:s.slice(Math.max(0,r-2),r+3).join(" ")},confidence:.5})}),t}findAttributeInconsistencies(e){let t=[];for(let s=0;s<e.length;s++)for(let i=s+1;i<e.length;i++){let r=this.compareAttributes(e[s],e[i]);r.length>0&&t.push({instance1:e[s],instance2:e[i],differences:r})}return t}compareAttributes(e,t){let s=[],i=new Set([...Object.keys(e.attributes),...Object.keys(t.attributes)]);for(let r of i){let o=e.attributes[r],a=t.attributes[r];o!==a&&s.push({attribute:r,value1:o,value2:a,confidence1:e.confidence,confidence2:t.confidence})}return s}buildTemporalGraph(e){let t=new Map;return e.forEach(s=>{s.relation.includes("before")||s.relation.includes("ended")?(t.has(s.entity1)||t.set(s.entity1,[]),t.get(s.entity1).push(s.entity2)):(s.relation.includes("after")||s.relation.includes("started"))&&(t.has(s.entity2)||t.set(s.entity2,[]),t.get(s.entity2).push(s.entity1))}),t}detectCycles(e){let t=[],s=new Set,i=new Set,r=u((o,a)=>{if(i.has(o)){let l=a.indexOf(o);l!==-1&&t.push(a.slice(l));return}if(s.has(o))return;s.add(o),i.add(o);let c=e.get(o)||[];for(let l of c)r(l,[...a,o]);i.delete(o)},"dfs");for(let o of e.keys())s.has(o)||r(o,[]);return t}rankConflicts(e,t){let s={high:3,medium:2,low:1},i=e.sort((r,o)=>{let a=s[o.severity]-s[r.severity];return a!==0?a:o.confidence-r.confidence});return t?i.slice(0,t):i}getStats(){return{total_conflict_types:this.conflictTypes.size,available_detectors:Array.from(this.conflictTypes.keys()),severity_levels:["high","medium","low"],conflict_type_details:Array.from(this.conflictTypes.entries()).map(([e,t])=>({type:e,name:t.name,description:t.description,severity:t.severity}))}}};u(ko,"ConflictDetectionEngine");var vo=ko;Dd.exports={ConflictDetectionEngine:vo}});var qd=w((qv,Rd)=>{var Co=class Co{constructor(e,t){this.memorySystem=e,this.relationshipEngine=t,this.visualFormats=new Map,this.initializeFormats()}initializeFormats(){this.visualFormats.set("ascii_graph",{name:"ASCII Graph",description:"Simple ASCII text-based graph visualization",generator:this.generateAsciiGraph.bind(this)}),this.visualFormats.set("mermaid",{name:"Mermaid Diagram",description:"Mermaid.js compatible diagram format",generator:this.generateMermaidDiagram.bind(this)}),this.visualFormats.set("dot_graph",{name:"DOT Graph",description:"Graphviz DOT format for complex visualizations",generator:this.generateDotGraph.bind(this)}),this.visualFormats.set("json_tree",{name:"JSON Tree",description:"Hierarchical JSON structure for tree visualization",generator:this.generateJsonTree.bind(this)}),this.visualFormats.set("network_summary",{name:"Network Summary",description:"Statistical summary of the memory network",generator:this.generateNetworkSummary.bind(this)})}async generateMemoryMap(e={}){let{format:t="ascii_graph",focus_entity:s=null,max_depth:i=3,min_confidence:r=0,include_memory_content:o=!1,layout:a="hierarchical",limit:c=50}=e,l=this.visualFormats.get(t);if(!l)throw new Error(`Unknown format: ${t}. Available: ${Array.from(this.visualFormats.keys()).join(", ")}`);let h=await this.gatherVisualizationData({focus_entity:s,max_depth:i,min_confidence:r,include_memory_content:o,limit:c}),d=await l.generator(h,{layout:a,...e});return{format:t,layout:a,data_summary:{entities:h.entities.length,relationships:h.relationships.length,memory_entries:h.memoryEntries.length},visualization:d,metadata:{generated_at:new Date().toISOString(),focus_entity:s,max_depth:i,min_confidence:r,total_nodes:h.entities.length,total_edges:h.relationships.length}}}async gatherVisualizationData(e){let{focus_entity:t,max_depth:s,min_confidence:i,include_memory_content:r,limit:o}=e,a;this.memorySystem.dbAll?a=await this.memorySystem.dbAll("SELECT * FROM relationships WHERE confidence >= ?",[i]):a=Array.from(this.relationshipEngine.relationships.values()).filter(d=>d.confidence>=i);let c=new Map;t&&c.set(t.toLowerCase(),t);let l=new Set;t?(l=this.getConnectedEntities(t,s,a),a=a.filter(f=>{let m=f.entity1.toLowerCase(),y=f.entity2.toLowerCase();return l.has(m)&&l.has(y)})):a.forEach(d=>{l.add(d.entity1.toLowerCase()),l.add(d.entity2.toLowerCase())}),o!=null&&(o===0?(a=[],l=new Set):a.length>o&&(a=a.sort((d,f)=>f.confidence-d.confidence).slice(0,o),l=new Set,a.forEach(d=>{l.add(d.entity1.toLowerCase()),l.add(d.entity2.toLowerCase())}))),!this.memorySystem.dbAll&&this.relationshipEngine.originalEntityNames&&this.relationshipEngine.originalEntityNames.forEach((d,f)=>{c.set(f,d)});let h=[];if(r&&this.memorySystem.query)try{h=await this.memorySystem.query({},100),h=h.filter(d=>{let f=d.content.toLowerCase();return Array.from(l).some(m=>f.includes(m))})}catch(d){console.warn("Memory system query failed:",d.message),h=[]}return{entities:Array.from(l),relationships:a,memoryEntries:h,focus_entity:t,originalEntityNames:c}}getConnectedEntities(e,t,s){let i=e.toLowerCase(),r=new Set([i]),o=[{entity:i,depth:0}];for(;o.length>0;){let{entity:a,depth:c}=o.shift();if(c>=t)continue;s.filter(h=>{let d=h.entity1.toLowerCase(),f=h.entity2.toLowerCase();return!!(d===a||f===a||d.includes(a)||f.includes(a)||a.includes(d)||a.includes(f))}).forEach(h=>{let d=h.entity1.toLowerCase(),f=h.entity2.toLowerCase(),m=null;d===a||d.includes(a)||a.includes(d)?m=f:(f===a||f.includes(a)||a.includes(f))&&(m=d),m&&!r.has(m)&&(r.add(m),o.push({entity:m,depth:c+1}))})}return r}async generateAsciiGraph(e,t){let{entities:s,relationships:i,focus_entity:r,originalEntityNames:o}=e;if(s.length===0)return"No entities to visualize";let a=`Memory Network Visualization (ASCII)
`;a+="="+"=".repeat(35)+`

`,r&&(a+=`Focus: ${r}

`);let c=new Map;s.forEach(l=>{let h=(o==null?void 0:o.get(l))||l;c.set(h,[])}),i.forEach(l=>{let h=(o==null?void 0:o.get(l.entity1.toLowerCase()))||l.entity1,d=(o==null?void 0:o.get(l.entity2.toLowerCase()))||l.entity2;c.has(h)&&c.get(h).push({target:d,relation:l.relation,confidence:l.confidence})});for(let[l,h]of c)h.length!==0&&(a+=`${l}
`,h.forEach((d,f)=>{let y=f===h.length-1?"\u2514\u2500":"\u251C\u2500",p=`(${d.confidence.toFixed(2)})`;a+=`${y} ${d.relation} \u2192 ${d.target} ${p}
`}),a+=`
`);return a}async generateMermaidDiagram(e,t){let{entities:s,relationships:i,focus_entity:r,originalEntityNames:o}=e;if(s.length===0)return`graph TD
    A[No data to visualize]`;let a=`graph TD
`;return r&&(a+=`    %% Focus entity: ${r}
`),s.forEach(c=>{let l=(o==null?void 0:o.get(c))||c,h=this.sanitizeNodeId(c);r&&c.toLowerCase()===r.toLowerCase()?a+=`    ${h}[${l}]:::focus
`:a+=`    ${h}[${l}]
`}),a+=`
`,i.forEach(c=>{let l=this.sanitizeNodeId(c.entity1.toLowerCase()),h=this.sanitizeNodeId(c.entity2.toLowerCase()),d=`${c.relation} (${c.confidence.toFixed(2)})`;a+=`    ${l} --> ${h} : ${d}
`}),r&&(a+=`
    %% CSS styling
`,a+=`    classDef focus fill:#ff9999,stroke:#ff6666,stroke-width:3px,color:#000000
`),a}async generateDotGraph(e,t){let{entities:s,relationships:i,originalEntityNames:r}=e,{layout:o="hierarchical"}=t;if(s.length===0)return`digraph G {
    label="No data to visualize";
}`;let a=`digraph MemoryNetwork {
`;return a+=`    rankdir=TB;
`,a+=`    node [shape=box, style=rounded];
`,a+=`    edge [fontsize=10];

`,s.forEach(c=>{let l=(r==null?void 0:r.get(c))||c,h=this.sanitizeNodeId(c);a+=`    ${h} [label="${l}"];
`}),a+=`
`,i.forEach(c=>{let l=this.sanitizeNodeId(c.entity1.toLowerCase()),h=this.sanitizeNodeId(c.entity2.toLowerCase()),d=`${c.relation}\\n(${c.confidence.toFixed(2)})`;a+=`    ${l} -> ${h} [label="${d}"];
`}),a+=`}
`,a}async generateJsonTree(e,t){let{entities:s,relationships:i,focus_entity:r,originalEntityNames:o}=e;if(s.length===0)return{message:"No data to visualize"};let a={name:r||"Memory Network",type:"root",children:[]},c=new Set,l=u((h,d=0)=>{let f=(o==null?void 0:o.get(h.toLowerCase()))||h;if(c.has(h)||d>2)return{name:f,type:"entity",children:[]};c.add(h);let m={name:f,type:"entity",children:[]};return i.filter(p=>p.entity1.toLowerCase()===h.toLowerCase()).forEach(p=>{let g=(o==null?void 0:o.get(p.entity2.toLowerCase()))||p.entity2,b={name:p.relation,type:"relation",confidence:p.confidence,children:[l(p.entity2,d+1)]};m.children.push(b)}),m},"buildNode");if(r)a.children.push(l(r));else{let h=new Map;i.forEach(f=>{let m=f.entity1.toLowerCase();h.set(m,(h.get(m)||0)+1)}),Array.from(h.entries()).sort((f,m)=>m[1]-f[1]).slice(0,5).map(([f])=>f).forEach(f=>{a.children.push(l(f))})}return a}async generateNetworkSummary(e,t){let{entities:s,relationships:i,memoryEntries:r}=e,o={overview:{total_entities:s.length,total_relationships:i.length,total_memory_entries:r.length,network_density:s.length>1?i.length/(s.length*(s.length-1)):0},entity_analysis:{},relationship_analysis:{},confidence_distribution:{},temporal_patterns:{}},a=new Map,c=new Map;s.forEach(f=>{a.set(f,0),c.set(f,"unknown")}),i.forEach(f=>{a.set(f.entity1,(a.get(f.entity1)||0)+1),a.set(f.entity2,(a.get(f.entity2)||0)+1)}),o.entity_analysis={most_connected:Array.from(a.entries()).sort((f,m)=>m[1]-f[1]).slice(0,5).map(([f,m])=>({entity:f,connections:m})),average_connections:a.size>0?Array.from(a.values()).reduce((f,m)=>f+m,0)/a.size:0};let l=new Map;i.forEach(f=>{l.set(f.relation,(l.get(f.relation)||0)+1)}),o.relationship_analysis={most_common_relations:Array.from(l.entries()).sort((f,m)=>m[1]-f[1]).slice(0,5).map(([f,m])=>({relation:f,count:m})),unique_relation_types:l.size};let h={high:0,medium:0,low:0};i.forEach(f=>{f.confidence>=.8?h.high++:f.confidence>=.5?h.medium++:h.low++}),o.confidence_distribution={...h,average_confidence:i.length>0?i.reduce((f,m)=>f+m.confidence,0)/i.length:0};let d=i.map(f=>new Date(f.timestamp));if(d.length>0){let f=d.sort((m,y)=>m-y);o.temporal_patterns={earliest_entry:f[0].toISOString(),latest_entry:f[f.length-1].toISOString(),total_timespan_days:Math.ceil((f[f.length-1]-f[0])/(1e3*60*60*24))}}return o}sanitizeNodeId(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"_")}getAvailableFormats(){return Array.from(this.visualFormats.entries()).map(([e,t])=>({format:e,name:t.name,description:t.description}))}getStats(){return{available_formats:this.getAvailableFormats(),total_formats:this.visualFormats.size,supported_layouts:["hierarchical","circular","force_directed"]}}};u(Co,"VisualMemoryMapper");var No=Co;Rd.exports={VisualMemoryMapper:No}});var Md=w((Mv,$d)=>{var Oo=class Oo{constructor(e,t,s){this.memorySystem=e,this.relationshipEngine=t,this.conflictEngine=s,this.validationRules=new Map,this.initializeValidationRules()}initializeValidationRules(){this.validationRules.set("ENTITY_CONSISTENCY",{name:"Entity Consistency",description:"Validate entity names are consistent across all systems",validator:this.validateEntityConsistency.bind(this),severity:"high"}),this.validationRules.set("RELATIONSHIP_INTEGRITY",{name:"Relationship Integrity",description:"Validate relationships reference valid entities",validator:this.validateRelationshipIntegrity.bind(this),severity:"high"}),this.validationRules.set("MEMORY_REFERENCES",{name:"Memory References",description:"Validate memory entries reference real entities",validator:this.validateMemoryReferences.bind(this),severity:"medium"}),this.validationRules.set("CONFIDENCE_ALIGNMENT",{name:"Confidence Alignment",description:"Validate confidence scores are logically consistent",validator:this.validateConfidenceAlignment.bind(this),severity:"medium"}),this.validationRules.set("TEMPORAL_CONSISTENCY",{name:"Temporal Consistency",description:"Validate timestamps align across related data",validator:this.validateTemporalConsistency.bind(this),severity:"low"}),this.validationRules.set("ORPHANED_DATA",{name:"Orphaned Data",description:"Find data without proper cross-references",validator:this.validateOrphanedData.bind(this),severity:"medium"})}async validateCrossReferences(e={}){let{rules:t=Array.from(this.validationRules.keys()),fix_issues:s=!1,detailed_report:i=!0}=e,r={validation_summary:{total_rules:t.length,passed:0,failed:0,warnings:0,errors:[]},rule_results:[],system_health:{overall_score:0,entity_integrity:0,relationship_integrity:0,memory_integrity:0},recommendations:[]};for(let o of t){let a=this.validationRules.get(o);if(a)try{let c=await a.validator(e),l={rule:o,name:a.name,severity:a.severity,status:c.issues.length===0?"PASSED":"FAILED",issues:c.issues,statistics:c.statistics,recommendations:c.recommendations||[]};r.rule_results.push(l),l.status==="PASSED"?r.validation_summary.passed++:(r.validation_summary.failed++,a.severity==="high"?r.validation_summary.errors.push(l):r.validation_summary.warnings++),r.recommendations.push(...l.recommendations)}catch(c){r.validation_summary.errors.push({rule:o,error:c.message})}}return r.system_health=await this.calculateSystemHealth(r),r}async validateEntityConsistency(e={}){let t=[],s={total_entities:0,inconsistent_entities:0},i=new Set;Array.from(this.relationshipEngine.relationships.values()).forEach(h=>{i.add(h.entity1),i.add(h.entity2)});let o=new Set;(await this.memorySystem.query({},1e3)).forEach(h=>{this.extractEntitiesFromText(h.content).forEach(f=>o.add(f.toLowerCase()))}),s.total_entities=new Set([...i,...o]).size;let c=new Set([...i,...o]),l=new Map;for(let h of c){let d=this.normalizeEntity(h);l.has(d)||l.set(d,[]),l.get(d).push(h)}for(let[h,d]of l)if(d.length>1){let f=[...new Set(d)];f.length>1&&(t.push({type:"ENTITY_INCONSISTENCY",description:`Entity variations found: ${f.join(", ")}`,entities:f,severity:"medium",suggestion:`Standardize to: ${f[0]}`}),s.inconsistent_entities++)}return{issues:t,statistics:s,recommendations:t.length>0?["Consider implementing entity normalization","Use consistent naming conventions","Review entity extraction algorithms"]:[]}}async validateRelationshipIntegrity(e={}){let t=[],s={total_relationships:0,invalid_relationships:0,orphaned_entities:0},i=Array.from(this.relationshipEngine.relationships.values());s.total_relationships=i.length;let r=new Set;i.forEach(o=>{r.add(o.entity1),r.add(o.entity2)});for(let o of i)o.entity1===o.entity2&&t.push({type:"SELF_REFERENCE",description:`Self-referencing relationship: ${o.entity1} ${o.relation} ${o.entity2}`,relationship:o,severity:"low",suggestion:"Review if self-reference is intentional"}),(!o.entity1||!o.entity2||!o.relation)&&(t.push({type:"EMPTY_RELATIONSHIP",description:`Relationship with empty fields: "${o.entity1}" "${o.relation}" "${o.entity2}"`,relationship:o,severity:"high",suggestion:"Remove or fix incomplete relationship"}),s.invalid_relationships++),(o.confidence<0||o.confidence>1)&&t.push({type:"INVALID_CONFIDENCE",description:`Invalid confidence score: ${o.confidence} for relationship ${o.id}`,relationship:o,severity:"medium",suggestion:"Fix confidence score to be between 0 and 1"});return{issues:t,statistics:s,recommendations:t.length>0?["Implement relationship validation before storage","Add confidence score validation","Review relationship creation logic"]:[]}}async validateMemoryReferences(e={}){let t=[],s={total_memories:0,memories_with_entity_refs:0,unlinked_memories:0},i=await this.memorySystem.query({},1e3);s.total_memories=i.length;let r=new Set;Array.from(this.relationshipEngine.relationships.values()).forEach(a=>{r.add(a.entity1),r.add(a.entity2)});for(let a of i){let c=this.extractEntitiesFromText(a.content);if(c.length>0){s.memories_with_entity_refs++;let l=c.filter(h=>!r.has(h.toLowerCase()));l.length>0&&t.push({type:"UNLINKED_ENTITY",description:`Memory ${a.id} references unknown entities: ${l.join(", ")}`,memory_id:a.id,entities:l,severity:"medium",suggestion:"Consider creating relationships for these entities"})}else s.unlinked_memories++}return{issues:t,statistics:s,recommendations:t.length>0?["Link memory entries to relationship entities","Improve entity extraction from memory content","Consider creating relationships for frequently mentioned entities"]:[]}}async validateConfidenceAlignment(e={}){let t=[],s={total_confidence_scores:0,misaligned_scores:0,average_confidence:0},i=Array.from(this.relationshipEngine.relationships.values()),r=await this.memorySystem.query({},1e3),o=[...i.map(l=>l.confidence),...r.map(l=>l.confidence_score)];s.total_confidence_scores=o.length,s.average_confidence=o.length>0?o.reduce((l,h)=>l+h,0)/o.length:0;let a=.3,c=new Map;i.forEach(l=>{[l.entity1,l.entity2].forEach(h=>{c.has(h)||c.set(h,{relationships:[],memories:[]}),c.get(h).relationships.push(l)})}),r.forEach(l=>{this.extractEntitiesFromText(l.content).forEach(d=>{let f=d.toLowerCase();c.has(f)||c.set(f,{relationships:[],memories:[]}),c.get(f).memories.push(l)})});for(let[l,h]of c)if(h.relationships.length>0&&h.memories.length>0){let d=h.relationships.map(p=>p.confidence),f=h.memories.map(p=>p.confidence_score),m=d.reduce((p,g)=>p+g,0)/d.length,y=f.reduce((p,g)=>p+g,0)/f.length;Math.abs(m-y)>a&&(t.push({type:"CONFIDENCE_MISALIGNMENT",description:`Confidence misalignment for entity "${l}": relationships=${m.toFixed(2)}, memories=${y.toFixed(2)}`,entity:l,relationship_confidence:m,memory_confidence:y,severity:"low",suggestion:"Review confidence scoring consistency"}),s.misaligned_scores++)}return{issues:t,statistics:s,recommendations:t.length>0?["Standardize confidence scoring across systems","Implement confidence calibration","Review confidence assignment logic"]:[]}}async validateTemporalConsistency(e={}){let t=[],s={total_timestamped_items:0,temporal_violations:0,timeline_gaps:0},i=Array.from(this.relationshipEngine.relationships.values()),r=await this.memorySystem.query({},1e3),o=[...i.map(a=>({type:"relationship",item:a,timestamp:new Date(a.timestamp)})),...r.map(a=>({type:"memory",item:a,timestamp:new Date(a.timestamp)}))].sort((a,c)=>a.timestamp-c.timestamp);s.total_timestamped_items=o.length;for(let a=0;a<o.length-1;a++){let c=o[a],l=o[a+1];c.timestamp>new Date&&(t.push({type:"FUTURE_TIMESTAMP",description:`${c.type} has future timestamp: ${c.timestamp.toISOString()}`,item:c.item,severity:"high",suggestion:"Fix timestamp to current or past time"}),s.temporal_violations++);let h=l.timestamp-c.timestamp,d=365*24*60*60*1e3;h>d&&(t.push({type:"LARGE_TIME_GAP",description:`Large time gap between ${c.type} and ${l.type}: ${Math.ceil(h/(1440*60*1e3))} days`,from:c.timestamp.toISOString(),to:l.timestamp.toISOString(),severity:"low",suggestion:"Review for missing data or incorrect timestamps"}),s.timeline_gaps++)}return{issues:t,statistics:s,recommendations:t.length>0?["Implement timestamp validation","Add temporal consistency checks","Review data entry timestamps"]:[]}}async validateOrphanedData(e={}){let t=[],s={total_items:0,orphaned_relationships:0,orphaned_memories:0},i=Array.from(this.relationshipEngine.relationships.values()),r=await this.memorySystem.query({},1e3);s.total_items=i.length+r.length;let o=new Map;i.forEach(c=>{[c.entity1,c.entity2].forEach(l=>{o.set(l,(o.get(l)||0)+1)})}),r.forEach(c=>{this.extractEntitiesFromText(c.content).forEach(h=>{let d=h.toLowerCase();o.set(d,(o.get(d)||0)+1)})});let a=Array.from(o.entries()).filter(([c,l])=>l===1).map(([c])=>c);return a.length>0&&(t.push({type:"POTENTIAL_ORPHANS",description:`Entities with minimal references: ${a.slice(0,5).join(", ")}${a.length>5?"...":""}`,entities:a,count:a.length,severity:"low",suggestion:"Review entities with single references"}),s.orphaned_relationships=a.length),{issues:t,statistics:s,recommendations:t.length>0?["Review entities with minimal cross-references","Consider consolidating related entities","Implement entity usage tracking"]:[]}}extractEntitiesFromText(e){let t=[];return e.split(/\s+/).forEach(i=>{let r=i.replace(/[^a-zA-Z]/g,"");r.match(/^[A-Z][a-z]+$/)&&t.push(r)}),[...new Set(t)]}normalizeEntity(e){return e.toLowerCase().trim().replace(/[^a-z0-9]/g,"")}async calculateSystemHealth(e){let t=e.rule_results.length,s=e.validation_summary.passed,i=t>0?s/t*100:0,r=e.rule_results.filter(d=>d.rule.includes("ENTITY")||d.rule.includes("ORPHANED")),o=e.rule_results.filter(d=>d.rule.includes("RELATIONSHIP")||d.rule.includes("TEMPORAL")),a=e.rule_results.filter(d=>d.rule.includes("MEMORY")||d.rule.includes("CONFIDENCE")),c=r.length>0?r.filter(d=>d.status==="PASSED").length/r.length*100:100,l=o.length>0?o.filter(d=>d.status==="PASSED").length/o.length*100:100,h=a.length>0?a.filter(d=>d.status==="PASSED").length/a.length*100:100;return{overall_score:Math.round(i),entity_integrity:Math.round(c),relationship_integrity:Math.round(l),memory_integrity:Math.round(h)}}getStats(){return{total_validation_rules:this.validationRules.size,available_rules:Array.from(this.validationRules.keys()),validation_categories:["entity","relationship","memory","confidence","temporal"],severity_levels:["high","medium","low"]}}};u(Oo,"CrossReferenceValidator");var Ao=Oo;$d.exports={CrossReferenceValidator:Ao}});var Lo=w((Fv,Pd)=>{var Do=class Do{constructor(){this.relationships=new Map,this.entityIndex=new Map,this.relationIndex=new Map,this.algorithms=new Map,this.counter=0,this.originalEntityNames=new Map,this.initializeAlgorithms()}initializeAlgorithms(){this.algorithms.set("exact_match",{name:"Exact Match",description:"Precise entity and relation matching",query:u((e,t)=>e.filter(s=>(!t.entity1||s.entity1===t.entity1.toLowerCase())&&(!t.relation||s.relation===t.relation.toLowerCase())&&(!t.entity2||s.entity2===t.entity2.toLowerCase())),"query")}),this.algorithms.set("fuzzy_match",{name:"Fuzzy Match",description:"Approximate entity and relation matching",query:u((e,t)=>e.filter(s=>{let i=u((r,o)=>r.includes(o)||o.includes(r),"fuzzyMatch");return(!t.entity1||i(s.entity1,t.entity1.toLowerCase())||i(s.entity2,t.entity1.toLowerCase()))&&(!t.relation||i(s.relation,t.relation.toLowerCase()))&&(!t.entity2||i(s.entity2,t.entity2.toLowerCase())||i(s.entity1,t.entity2.toLowerCase()))}),"query")}),this.algorithms.set("confidence_weighted",{name:"Confidence Weighted",description:"Results ranked by confidence and relevance",query:u((e,t)=>e.filter(i=>(!t.entity1||i.entity1.includes(t.entity1.toLowerCase())||i.entity2.includes(t.entity1.toLowerCase()))&&(!t.relation||i.relation.includes(t.relation.toLowerCase()))&&(!t.entity2||i.entity2.includes(t.entity2.toLowerCase())||i.entity1.includes(t.entity2.toLowerCase()))).sort((i,r)=>i.confidence!==r.confidence?r.confidence-i.confidence:new Date(r.timestamp)-new Date(i.timestamp)),"query")})}store(e,t,s,i={}){let r=e.toLowerCase().trim(),o=s.toLowerCase().trim();this.originalEntityNames.set(r,e),this.originalEntityNames.set(o,s);let a={id:`rel_${String(this.counter++).padStart(4,"0")}`,entity1:r,relation:t.toLowerCase().trim(),entity2:o,confidence:i.confidence||1,timestamp:new Date().toISOString(),source:i.source||"user_input",metadata:{entity1_type:i.entity1_type||"unknown",entity2_type:i.entity2_type||"unknown",relation_type:i.relation_type||"general",algorithm_version:"1.0",...i}};return this.relationships.set(a.id,a),this.updateIndexes(a),a}updateIndexes(e){[e.entity1,e.entity2].forEach(t=>{this.entityIndex.has(t)||this.entityIndex.set(t,new Set),this.entityIndex.get(t).add(e.id)}),this.relationIndex.has(e.relation)||this.relationIndex.set(e.relation,new Set),this.relationIndex.get(e.relation).add(e.id)}query(e={},t="fuzzy_match"){let i=Array.from(this.relationships.values()).filter(o=>o.confidence>=(e.min_confidence||0));return e.entity_type&&(i=i.filter(o=>o.metadata.entity1_type===e.entity_type||o.metadata.entity2_type===e.entity_type)),e.relation_type&&(i=i.filter(o=>o.metadata.relation_type===e.relation_type)),i=(this.algorithms.get(t)||this.algorithms.get("fuzzy_match")).query(i,e),i.slice(0,e.limit||20)}getAlgorithms(){return Array.from(this.algorithms.entries()).map(([e,t])=>({key:e,name:t.name,description:t.description}))}getEntityRelationships(e){let t=this.entityIndex.get(e.toLowerCase())||new Set;return Array.from(t).map(s=>this.relationships.get(s)).filter(Boolean)}calculatePathConfidence(e){let t=1;for(let s=1;s<e.length;s+=2){let r=this.getEntityRelationships(e[s-1]).find(o=>o.relation===e[s]&&(o.entity2===e[s+1]||o.entity1===e[s+1]));r&&(t*=r.confidence)}return t}traverse(e,t={}){let{maxHops:s=3,relationFilter:i=null,entityTypeFilter:r=null,algorithm:o="bfs",returnPaths:a=!1}=t,c=new Set,l=[{entity:e.toLowerCase(),path:[e.toLowerCase()],depth:0}],h=[];for(;l.length>0;){let d=o==="bfs"?l.shift():l.pop();if(d.depth>=s||c.has(d.entity))continue;c.add(d.entity);let f=this.getEntityRelationships(d.entity);for(let m of f){if(i&&!m.relation.includes(i)||r&&m.metadata.entity1_type!==r&&m.metadata.entity2_type!==r)continue;let y=m.entity1===d.entity?m.entity2:m.entity1;if(!c.has(y)){let p=[...d.path,m.relation,y];(d.depth+1===s||a)&&h.push({path:p,depth:d.depth+1,confidence:this.calculatePathConfidence(p),relationships:[...d.relationships||[],m]}),l.push({entity:y,path:p,depth:d.depth+1,relationships:[...d.relationships||[],m]})}}}return h}findPath(e,t,s={}){return this.traverse(e,{...s,maxHops:s.maxHops||6,returnPaths:!0,algorithm:"bfs"}).filter(r=>r.path[r.path.length-1]===t.toLowerCase()).sort((r,o)=>r.depth!==o.depth?r.depth-o.depth:o.confidence-r.confidence)}getStats(){return{total_relationships:this.relationships.size,unique_entities:this.entityIndex.size,unique_relations:this.relationIndex.size,available_algorithms:this.algorithms.size}}};u(Do,"RelationshipEngine");var Io=Do;Pd.exports={RelationshipEngine:Io}});var xd=w((Uv,Fd)=>{var qo=class qo{constructor({name:e,description:t,parameters:s,handler:i,serverId:r,category:o="general"}){this.name=e,this.description=t,this.parameters=s,this.handler=i,this.serverId=r,this.category=o}};u(qo,"MCPTool");var Ro=qo,$o=class $o{constructor(e,t,s,i={}){this.serverId=e,this.name=t,this.description=s,this.config=i,this.status="disconnected",this.tools=[],this.isRunning=!1}async initialize(){throw new Error("initialize() must be implemented by subclass")}async disconnect(){throw new Error("disconnect() must be implemented by subclass")}async discoverTools(){return this.tools}listTools(){return this.tools}async getToolsSchema(){return this.listTools().map(t=>({name:t.name,description:t.description,parameters:t.parameters,category:t.category}))}getTool(e){return this.tools.find(t=>t.name===e)||null}getToolsByCategory(e){return this.tools.filter(t=>t.category===e)}registerTool(e){if(!e||!e.name)throw new Error("Tool must have a name");if(!e.handler||typeof e.handler!="function")throw new Error("Tool must have a handler function");if(this.getTool(e.name))throw new Error(`Tool '${e.name}' already registered`);return this.tools.push(e),e}getServerInfo(){let e=[...new Set(this.tools.map(t=>t.category))];return{serverId:this.serverId,name:this.name,description:this.description,status:this.status,toolsCount:this.tools.length,categories:e}}async executeTool(e,t){let s=this.getTool(e);if(!s)throw new Error(`Tool ${e} not found`);let i=t;if(typeof t=="string")try{i=JSON.parse(t)}catch{i={}}else(typeof t!="object"||t===null)&&(i={});try{return await s.handler(i)}catch(r){throw new Error(`Tool execution failed: ${r.message}`)}}async handleMessage(e){if(!e||typeof e!="object")return{error:{code:-32600,message:"Invalid Request"}};let{method:t,params:s}=e;try{switch(t){case"tools/list":return{tools:await this.getToolsSchema()};case"tools/call":if(!s||!s.name)return{error:{code:-32602,message:"Invalid params: tool name required"}};let r=await this.executeTool(s.name,s.arguments);return r&&typeof r=="object"&&"content"in r?r:{result:r&&typeof r=="object"&&"result"in r?r.result:r};default:return{error:{code:-32601,message:"Method not found"}}}}catch(i){return{error:{code:-32603,message:i.message}}}}async start(){this.isRunning=!0,this.status="connected"}async stop(){this.isRunning=!1,this.status="disconnected"}async restart(){await this.stop(),await this.start()}updateConfig(e){typeof e=="object"&&e!==null&&(this.config={...this.config,...e})}getConfig(){return{...this.config}}validateConfig(e){if(e==null)throw new Error("Configuration cannot be null or undefined");return!0}};u($o,"BaseMCPServer");var bi=$o;Fd.exports={BaseMCPServer:bi,BaseServer:bi,MCPTool:Ro}});var jd=w((zv,Ud)=>{var De=pt(),ae=require("path"),{MCPTool:ot}=xd(),{RelationshipEngine:pb}=Lo(),Po=class Po{constructor(e,t={}){this.memorySystem=e,this.config=t,this.activeProject=t.projectPath||process.cwd(),this.fileWatcher=null,this.projects=new Map,this.relationshipEngine=new pb}createMemoryExportTool(){return new ot({name:"memory_export",description:"Export memory data in various formats (JSON, CSV, Markdown) with auto-extracted entities, relationships, and conflict resolution suggestions preserved.",parameters:{type:"object",properties:{format:{type:"string",enum:["json","csv","markdown"],description:"Export format",default:"json"},project:{type:"string",description:"Project filter (optional)"},since:{type:"string",description:"Export entries since date (ISO string)"},memory_type:{type:"string",description:"Filter by memory type",enum:["observation","action","result","error","context","general"]}}},handler:this._handleMemoryExport.bind(this),serverId:"nova-memory",category:"export"})}createProjectListTool(){return new ot({name:"project_list",description:"List all discovered projects with memory statistics including entity extraction metrics, relationship counts, and data quality scores.",parameters:{type:"object",properties:{detailed:{type:"boolean",description:"Include detailed project information",default:!1},scan_workspace:{type:"boolean",description:"Scan workspace for new projects",default:!1}}},handler:this._handleProjectList.bind(this),serverId:"nova-memory",category:"project"})}createProjectSwitchTool(){return new ot({name:"project_switch",description:"Switch active project context for memory operations while maintaining cross-project entity relationship tracking and data consistency.",parameters:{type:"object",properties:{project_path:{type:"string",description:"Path to the project directory"}},required:["project_path"]},handler:this._handleProjectSwitch.bind(this),serverId:"nova-memory",category:"project"})}createFileChangesTool(){return new ot({name:"file_changes",description:"Get recent file changes from file watching system with intelligent memory updates and entity re-extraction for changed content.",parameters:{type:"object",properties:{since:{type:"string",description:"Show changes since timestamp (ISO string)"},limit:{type:"integer",description:"Maximum number of changes to return",default:50,minimum:1,maximum:200},file_types:{type:"array",items:{type:"string"},description:'Filter by file extensions (e.g., [".js", ".py"])'},change_types:{type:"array",items:{type:"string",enum:["added","modified","deleted","renamed"]},description:"Filter by change types"}}},handler:this._handleFileChanges.bind(this),serverId:"nova-memory",category:"files"})}async _handleMemoryExport(e){try{let{format:t="json",project:s,since:i,memory_type:r}=e,o={};if(r&&(o.memory_type=r),i){let y=new Date(i);if(isNaN(y.getTime()))return{error:'Invalid date format for "since" parameter'}}let a=await this.memorySystem.query(o,1e3),c=a;if(i){let y=new Date(i);c=a.filter(p=>new Date(p.timestamp)>=y)}let l,h,d=new Date().toISOString().replace(/[:.]/g,"-");switch(t){case"json":l=JSON.stringify(c,null,2),h=`memory-export-${d}.json`;break;case"csv":l=this._convertToCSV(c),h=`memory-export-${d}.csv`;break;case"markdown":l=this._convertToMarkdown(c),h=`memory-export-${d}.md`;break;default:return{error:`Unsupported export format: ${t}`}}let f=ae.join(this.activeProject,".nova","exports");await De.ensureDir(f);let m=ae.join(f,h);return await De.writeFile(m,l,"utf8"),{success:!0,format:t,filename:h,filepath:m,exported_count:c.length,file_size:l.length,timestamp:new Date().toISOString()}}catch(t){return{error:t.message}}}async _handleProjectList(e){try{let{detailed:t=!1,scan_workspace:s=!1}=e;s&&await this._scanWorkspaceForProjects();let i=Array.from(this.projects.values());if(!t)return{success:!0,projects:i.map(o=>({name:o.name,path:o.path,type:o.type,active:o.path===this.activeProject,memory_count:o.memoryCount||0})),total_projects:i.length,active_project:this.activeProject};let r=[];for(let o of i)try{let a=o.path===this.activeProject?await this.memorySystem.getStats():{total_entries:0};r.push({...o,memory_stats:a,active:o.path===this.activeProject})}catch(a){r.push({...o,error:`Failed to get stats: ${a.message}`,active:o.path===this.activeProject})}return{success:!0,projects:r,total_projects:i.length,active_project:this.activeProject}}catch(t){return{error:t.message}}}async _handleProjectSwitch(e){try{let{project_path:t}=e;if(!await De.pathExists(t))return{error:`Project path does not exist: ${t}`};let s=ae.resolve(t);if(!await this._isValidProject(s))return{error:`Path is not a recognized project: ${t}`};let r=this.activeProject;this.activeProject=s;let o=await this._getProjectInfo(s);return{success:!0,previous_project:r,active_project:this.activeProject,project_info:o,message:`Switched to project: ${o.name||ae.basename(s)}`}}catch(t){return{error:t.message}}}async _handleFileChanges(e){try{let{since:t,limit:s=50,file_types:i,change_types:r}=e,a=[{path:"src/index.js",type:"modified",timestamp:new Date().toISOString(),size:1024,project:this.activeProject},{path:"README.md",type:"modified",timestamp:new Date(Date.now()-300*1e3).toISOString(),size:2048,project:this.activeProject}];if(t){let c=new Date(t);isNaN(c.getTime())||(a=a.filter(l=>new Date(l.timestamp)>=c))}return i&&i.length>0&&(a=a.filter(c=>i.some(l=>c.path.endsWith(l)))),r&&r.length>0&&(a=a.filter(c=>r.includes(c.type))),a=a.slice(0,s),{success:!0,changes:a,total_found:a.length,project:this.activeProject,watching_enabled:!1,filters_applied:{since:t||null,file_types:i||null,change_types:r||null}}}catch(t){return{error:t.message}}}_convertToCSV(e){let s=[["id","content","memory_type","session_id","timestamp","tags","confidence_score"].join(",")];for(let i of e){let r=[i.id||"",`"${(i.content||"").replace(/"/g,'""')}"`,i.memory_type||"",i.session_id||"",i.timestamp?new Date(i.timestamp).toISOString():"",`"${(i.tags||[]).join(";")}"`,i.confidence_score||1];s.push(r.join(","))}return s.join(`
`)}_convertToMarkdown(e){let t=`# Memory Export

`;t+=`Generated: ${new Date().toISOString()}
`,t+=`Total Entries: ${e.length}

`;let s=e.reduce((i,r)=>{let o=r.memory_type||"general";return i[o]||(i[o]=[]),i[o].push(r),i},{});for(let[i,r]of Object.entries(s)){t+=`## ${i.charAt(0).toUpperCase()+i.slice(1)} (${r.length})

`;for(let o of r)t+=`### Entry ${o.id}

`,t+=`**Content:** ${o.content}

`,o.tags&&o.tags.length>0&&(t+=`**Tags:** ${o.tags.join(", ")}

`),t+=`**Timestamp:** ${new Date(o.timestamp).toLocaleString()}

`,t+=`**Confidence:** ${o.confidence_score}

`,t+=`---

`}return t}async _scanWorkspaceForProjects(){let e={name:ae.basename(this.activeProject),path:this.activeProject,type:"unknown",detected:new Date().toISOString(),memoryCount:0};this.projects.set(this.activeProject,e)}async _isValidProject(e){let t=[".git","package.json","requirements.txt","pom.xml","Cargo.toml",".sln","go.mod","pyproject.toml"];for(let s of t)if(await De.pathExists(ae.join(e,s)))return!0;return!1}async _getProjectInfo(e){let t={name:ae.basename(e),path:e,type:"unknown",detected:new Date().toISOString()};if(await De.pathExists(ae.join(e,"package.json"))){t.type="node.js";try{let s=await De.readJson(ae.join(e,"package.json"));t.name=s.name||t.name,t.description=s.description,t.version=s.version}catch{}}else await De.pathExists(ae.join(e,"requirements.txt"))?t.type="python":await De.pathExists(ae.join(e,".git"))&&(t.type="git");return t}createStoreRelationshipTool(){return new ot({name:"store_relationship",description:"Store structured entity-relation-entity relationships with advanced indexing, confidence scoring, temporal context, and automatic conflict detection validation.",parameters:{type:"object",properties:{entity1:{type:"string",description:'First entity (subject) - e.g., "John Smith"'},relation:{type:"string",description:'Relationship type (predicate) - e.g., "works_at", "knows", "located_in"'},entity2:{type:"string",description:'Second entity (object) - e.g., "Google"'},confidence:{type:"number",description:"Confidence score (0-1) for this relationship",default:1,minimum:0,maximum:1},entity1_type:{type:"string",description:"Type of first entity",enum:["person","company","location","concept","event","product","unknown"],default:"unknown"},entity2_type:{type:"string",description:"Type of second entity",enum:["person","company","location","concept","event","product","unknown"],default:"unknown"},relation_type:{type:"string",description:"Category of relationship",enum:["employment","social","location","ownership","temporal","causal","general"],default:"general"},source:{type:"string",description:"Source of this relationship information",default:"user_input"},metadata:{type:"object",description:"Additional metadata for the relationship",additionalProperties:!0}},required:["entity1","relation","entity2"]},handler:this._handleStoreRelationship.bind(this),serverId:"nova-memory",category:"relationships"})}createQueryRelationshipsTool(){return new ot({name:"query_relationships",description:"Query stored relationships with advanced filtering and multiple algorithms (exact, fuzzy, confidence-weighted) featuring intelligent relationship inference and cross-validation with auto-extracted entities.",parameters:{type:"object",properties:{entity1:{type:"string",description:"Filter by first entity (supports partial matching with fuzzy algorithm)"},relation:{type:"string",description:"Filter by relationship type"},entity2:{type:"string",description:"Filter by second entity (supports partial matching with fuzzy algorithm)"},entity_type:{type:"string",description:"Filter by entity type (matches either entity1 or entity2)",enum:["person","company","location","concept","event","product","unknown"]},relation_type:{type:"string",description:"Filter by relationship category",enum:["employment","social","location","ownership","temporal","causal","general"]},min_confidence:{type:"number",description:"Minimum confidence threshold (0-1)",default:0,minimum:0,maximum:1},algorithm:{type:"string",description:"Query algorithm to use",enum:["exact_match","fuzzy_match","confidence_weighted"],default:"fuzzy_match"},limit:{type:"integer",description:"Maximum results to return",default:20,minimum:1,maximum:100}}},handler:this._handleQueryRelationships.bind(this),serverId:"nova-memory",category:"relationships"})}async _handleStoreRelationship(e){try{let{entity1:t,relation:s,entity2:i,confidence:r,entity1_type:o,entity2_type:a,relation_type:c,source:l,metadata:h}=e,d=this.relationshipEngine.store(t,s,i,{confidence:r,entity1_type:o,entity2_type:a,relation_type:c,source:l,...h}),f=this.relationshipEngine.getStats();return{success:!0,relationship:{id:d.id,entity1:d.entity1,relation:d.relation,entity2:d.entity2,confidence:d.confidence,timestamp:d.timestamp,metadata:d.metadata},stats:{total_relationships:f.total_relationships,unique_entities:f.unique_entities,unique_relations:f.unique_relations,available_algorithms:f.available_algorithms},message:`Successfully stored relationship: ${d.entity1} \u2192 ${d.relation} \u2192 ${d.entity2}`}}catch(t){return{error:t.message}}}async _handleQueryRelationships(e){try{let{entity1:t,relation:s,entity2:i,entity_type:r,relation_type:o,min_confidence:a=0,algorithm:c="fuzzy_match",limit:l=20}=e,h="SELECT * FROM relationships WHERE 1=1",d=[];c==="exact_match"?(t&&(h+=" AND entity1 = ?",d.push(t)),i&&(h+=" AND entity2 = ?",d.push(i)),s&&(h+=" AND relation = ?",d.push(s))):(t&&(h+=" AND (entity1 LIKE ? OR entity2 LIKE ?)",d.push(`%${t}%`,`%${t}%`)),i&&(h+=" AND (entity1 LIKE ? OR entity2 LIKE ?)",d.push(`%${i}%`,`%${i}%`)),s&&(h+=" AND relation LIKE ?",d.push(`%${s}%`))),a>0&&(h+=" AND confidence >= ?",d.push(a)),h+=" ORDER BY confidence DESC, timestamp DESC LIMIT ?",d.push(l);let f=await this.memorySystem.dbAll(h,d),m=await this.memorySystem.dbGet("SELECT COUNT(*) as total FROM relationships"),y=await this.memorySystem.dbGet("SELECT COUNT(DISTINCT entity1) as count FROM relationships"),p=await this.memorySystem.dbGet("SELECT COUNT(DISTINCT entity2) as count FROM relationships"),g=await this.memorySystem.dbGet("SELECT COUNT(DISTINCT relation) as count FROM relationships"),b=[{key:"exact_match",name:"Exact Match",description:"Precise entity and relation matching"},{key:"fuzzy_match",name:"Fuzzy Match",description:"Approximate entity and relation matching"},{key:"confidence_weighted",name:"Confidence Weighted",description:"Results ranked by confidence and relevance"}],S=b.find(E=>E.key===c);return{success:!0,query:{filters:{entity1:t,relation:s,entity2:i,entity_type:r,relation_type:o,min_confidence:a},algorithm:c,algorithm_info:S||{key:c,name:"Unknown",description:"Unknown algorithm"}},results:f.map(E=>({id:E.id,entity1:E.entity1,relation:E.relation,entity2:E.entity2,confidence:E.confidence,timestamp:E.timestamp,metadata:E.metadata?JSON.parse(E.metadata):{}})),count:f.length,stats:{total_relationships:m.total,unique_entities:y.count+p.count,unique_relations:g.count},available_algorithms:b}}catch(t){return{error:t.message}}}};u(Po,"EnhancedMCPTools");var Mo=Po;Ud.exports={EnhancedMCPTools:Mo}});var Bd=w((Kv,zd)=>{var xo=class xo{constructor(e={}){this.maxFeatures=e.maxFeatures||1e3,this.minTermFreq=e.minTermFreq||2,this.stopWords=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","up","about","into","through","during","before","after","above","below","is","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","may","might","must","can","shall","this","that"])}extractFeatures(e){let t=process.hrtime.bigint(),s=this.buildVocabulary(e),i=e.map(a=>this.memoryToVector(a,s)),r=process.hrtime.bigint(),o=Number(r-t)/1e6;return{vectors:i,vocabulary:s,dimensions:s.size,duration:o}}buildVocabulary(e){let t=new Map;e.forEach(r=>{let o=this.tokenize(r.content);new Set(o).forEach(c=>{t.set(c,(t.get(c)||0)+1)})});let s=new Map,i=0;return Array.from(t.entries()).filter(([r,o])=>o>=this.minTermFreq).sort((r,o)=>o[1]-r[1]).slice(0,this.maxFeatures).forEach(([r,o])=>{s.set(r,i++)}),s}memoryToVector(e,t){let s=new Array(t.size).fill(0),i=this.tokenize(e.content),r=new Map;i.forEach(a=>{t.has(a)&&r.set(a,(r.get(a)||0)+1)}),r.forEach((a,c)=>{let l=t.get(c);s[l]=a/i.length});let o=this.extractMetadataFeatures(e);return{id:e.id,features:s,metadata:o,content:e.content,memory_type:e.memory_type,tags:e.tags||[],timestamp:e.timestamp,confidence_score:e.confidence_score||1}}extractMetadataFeatures(e){return{contentLength:e.content.length,tagCount:(e.tags||[]).length,confidenceScore:e.confidence_score||1,memoryType:e.memory_type,dayOfWeek:new Date(e.timestamp).getDay(),hourOfDay:new Date(e.timestamp).getHours()}}tokenize(e){return!e||typeof e!="string"?[]:e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(t=>t.length>2&&!this.stopWords.has(t)).filter(Boolean)}cosineDistance(e,t){if(e.length!==t.length)throw new Error("Vectors must have same dimensions");let s=0,i=0,r=0;for(let c=0;c<e.length;c++)s+=e[c]*t[c],i+=e[c]*e[c],r+=t[c]*t[c];let o=Math.sqrt(i)*Math.sqrt(r);return o===0?1:1-s/o}euclideanDistance(e,t){if(e.length!==t.length)throw new Error("Vectors must have same dimensions");let s=0;for(let i=0;i<e.length;i++){let r=e[i]-t[i];s+=r*r}return Math.sqrt(s)}};u(xo,"MemoryFeatureExtractor");var Le=xo,Uo=class Uo{constructor(e=.5,t=3,s="cosine",i=null){this.epsilon=e,this.minPoints=t,this.distanceMetric=s,this.featureExtractor=i||new Le}cluster(e){let t=process.hrtime.bigint(),s=e.map((l,h)=>({index:h,features:l.features,memory:l,cluster:null,visited:!1,isNoise:!1})),i=0,r=[];for(let l of s){if(l.visited)continue;l.visited=!0;let h=this.regionQuery(l,s);if(h.length<this.minPoints)l.isNoise=!0;else{let d=this.expandCluster(l,h,i,s);d.length>0&&(r.push({id:i,size:d.length,members:d,centroid:this.calculateCentroid(d)}),i++)}}let o=s.filter(l=>l.isNoise).map(l=>l.memory),a=process.hrtime.bigint(),c=Number(a-t)/1e6;return{clusters:r,noise:o,stats:{clusterCount:r.length,noiseCount:o.length,totalPoints:s.length,avgClusterSize:r.length>0?r.reduce((l,h)=>l+h.size,0)/r.length:0},parameters:{epsilon:this.epsilon,minPoints:this.minPoints,distanceMetric:this.distanceMetric},duration:c}}regionQuery(e,t){let s=[];if(e._processedNeighbors)return e._processedNeighbors;for(let i of t){if(e===i)continue;this.calculateDistance(e.features,i.features)<=this.epsilon&&s.push(i)}return e._processedNeighbors=s,s}expandCluster(e,t,s,i){let r=[e.memory];e.cluster=s;let o=0;for(;o<t.length;){let a=t[o];if(!a.visited){a.visited=!0;let c=this.regionQuery(a,i);c.length>=this.minPoints&&t.push(...c)}a.cluster===null&&(a.cluster=s,r.push(a.memory)),o++}return r}calculateDistance(e,t){if(this.distanceMetric==="cosine")return this.featureExtractor.cosineDistance(e,t);if(this.distanceMetric==="euclidean")return this.featureExtractor.euclideanDistance(e,t);throw new Error(`Unknown distance metric: ${this.distanceMetric}`)}calculateCentroid(e){if(e.length===0)return null;let t=e[0].features.length,s=new Array(t).fill(0);e.forEach(i=>{for(let r=0;r<t;r++)s[r]+=i.features[r]});for(let i=0;i<t;i++)s[i]/=e.length;return s}};u(Uo,"DBSCANClusterer");var Si=Uo,jo=class jo{constructor(e=3,t=100,s=1e-4,i="euclidean",r=null){this.k=e,this.maxIterations=t,this.tolerance=s,this.distanceMetric=i,this.featureExtractor=r||new Le}cluster(e){let t=process.hrtime.bigint();if(e.length<this.k)throw new Error(`Cannot create ${this.k} clusters from ${e.length} data points`);let s=e.map(h=>({features:h.features,memory:h,cluster:null})),i=this.initializeCentroids(s),r=0,o=!1;for(;r<this.maxIterations&&!o;){this.assignPointsToClusters(s,i);let h=this.updateCentroids(s);o=this.hasConverged(i,h),i=h,r++}let a=this.createClusters(s,i),c=process.hrtime.bigint(),l=Number(c-t)/1e6;return{clusters:a,stats:{clusterCount:a.length,totalPoints:s.length,avgClusterSize:a.reduce((h,d)=>h+d.size,0)/a.length,inertia:this.calculateInertia(s,i)},parameters:{k:this.k,iterations:r,converged:o,distanceMetric:this.distanceMetric},duration:l}}initializeCentroids(e){let t=[],s=e[0].features.length,i=e[Math.floor(Math.random()*e.length)].features.slice();t.push(i);for(let r=1;r<this.k;r++){let o=e.map(h=>{let d=1/0;for(let f of t){let m=this.calculateDistance(h.features,f);d=Math.min(d,m)}return d*d}),a=o.reduce((h,d)=>h+d,0),c=Math.random()*a,l=0;for(let h=0;h<e.length;h++)if(l+=o[h],l>=c){t.push(e[h].features.slice());break}}return t}assignPointsToClusters(e,t){e.forEach(s=>{let i=1/0,r=0;t.forEach((o,a)=>{let c=this.calculateDistance(s.features,o);c<i&&(i=c,r=a)}),s.cluster=r})}updateCentroids(e){let t=e[0].features.length,s=[];for(let i=0;i<this.k;i++){let r=e.filter(a=>a.cluster===i);if(r.length===0){s.push(new Array(t).fill(0));continue}let o=new Array(t).fill(0);r.forEach(a=>{for(let c=0;c<t;c++)o[c]+=a.features[c]});for(let a=0;a<t;a++)o[a]/=r.length;s.push(o)}return s}hasConverged(e,t){for(let s=0;s<e.length;s++)if(this.calculateDistance(e[s],t[s])>this.tolerance)return!1;return!0}createClusters(e,t){let s=[];for(let i=0;i<this.k;i++){let r=e.filter(o=>o.cluster===i);r.length>0&&s.push({id:i,size:r.length,members:r.map(o=>o.memory),centroid:t[i]})}return s}calculateInertia(e,t){let s=0;return e.forEach(i=>{let r=t[i.cluster],o=this.calculateDistance(i.features,r);s+=o*o}),s}calculateDistance(e,t){if(this.distanceMetric==="cosine")return this.featureExtractor.cosineDistance(e,t);if(this.distanceMetric==="euclidean")return this.featureExtractor.euclideanDistance(e,t);throw new Error(`Unknown distance metric: ${this.distanceMetric}`)}};u(jo,"KMeansClusterer");var Ei=jo,zo=class zo{static calculateSilhouetteScore(e,t,s=null){if(t.length<2)return 0;let i=s||new Le,r=new Map;t.forEach((c,l)=>{c.members.forEach(h=>{r.set(h.id,l)})});let o=0,a=0;return e.forEach(c=>{let l=r.get(c.id);if(l===void 0)return;let h=t[l];if(h.size<2)return;let d=0,f=0;h.members.forEach(b=>{if(b.id!==c.id){let S=e.find(E=>E.id===b.id);S&&(d+=i.euclideanDistance(c.features,S.features),f++)}});let m=f>0?d/f:0,y=1/0;t.forEach((b,S)=>{if(S===l)return;let E=0,T=0;if(b.members.forEach(_=>{let v=e.find(O=>O.id===_.id);v&&(E+=i.euclideanDistance(c.features,v.features),T++)}),T>0){let _=E/T;y=Math.min(y,_)}});let p=y===1/0?0:y,g=Math.max(m,p)===0?0:(p-m)/Math.max(m,p);o+=g,a++}),a>0?o/a:0}static calculateDaviesBouldinIndex(e,t,s=null){if(t.length<2)return 0;let i=s||new Le,r=t.map(c=>c.centroid),o=t.map((c,l)=>{let h=0;return c.members.forEach(d=>{let f=e.find(m=>m.id===d.id);f&&(h+=i.euclideanDistance(f.features,r[l]))}),c.size>0?h/c.size:0}),a=0;return t.forEach((c,l)=>{let h=0;t.forEach((d,f)=>{if(l===f)return;let m=i.euclideanDistance(r[l],r[f]);if(m>0){let y=(o[l]+o[f])/m;h=Math.max(h,y)}}),a+=h}),a/t.length}};u(zo,"ClusteringEvaluator");var Be=zo,Bo=class Bo{constructor(e={}){this.featureExtractor=new Le(e.features)}async clusterWithDBSCAN(e,t={}){if(e.length===0)return{clusters:[],noise:[],stats:{clusterCount:0,noiseCount:0,totalPoints:0,avgClusterSize:0},parameters:{epsilon:t.epsilon||.3,minPoints:t.minPoints||3,distanceMetric:t.distanceMetric||"cosine"},quality:{silhouetteScore:0,daviesBouldinIndex:0},algorithm:"DBSCAN",duration:0};let s=e.length,i=300;console.log(`\u{1F527} MCP SERVER DEBUG: DBSCAN analyzing ${s} memories - OPTIMIZATION ACTIVE!`);let r=e;if(s>i){console.log(`\u{1F4CA} DBSCAN optimization: ${s} \u2192 ${i} memories (avoiding ${Math.pow(s,2).toLocaleString()} distance calculations)`);let d=Math.floor(i*.5),f=i-d,m=e.slice(0,d),p=e.slice(d).sort(()=>.5-Math.random()).slice(0,f);r=[...m,...p],console.log(`\u{1F680} Complexity reduced: O(${Math.pow(r.length,2).toLocaleString()}) vs O(${Math.pow(s,2).toLocaleString()}) operations`)}let{vectors:o}=this.featureExtractor.extractFeatures(r),c=new Si(t.epsilon||.3,t.minPoints||3,t.distanceMetric||"cosine",this.featureExtractor).cluster(o),l=Be.calculateSilhouetteScore(o,c.clusters,this.featureExtractor),h=Be.calculateDaviesBouldinIndex(o,c.clusters,this.featureExtractor);return{...c,quality:{silhouetteScore:l,daviesBouldinIndex:h},algorithm:"DBSCAN"}}async clusterWithKMeans(e,t={}){if(e.length===0)return{clusters:[],stats:{clusterCount:0,totalPoints:0,avgClusterSize:0,inertia:0},parameters:{k:t.k||0,iterations:0,converged:!0,distanceMetric:t.distanceMetric||"euclidean"},quality:{silhouetteScore:0,daviesBouldinIndex:0},algorithm:"K-Means",duration:0};let{vectors:s}=this.featureExtractor.extractFeatures(e),i=t.k||Math.min(Math.ceil(Math.sqrt(e.length/2)),10),o=new Ei(i,t.maxIterations||100,t.tolerance||1e-4,t.distanceMetric||"euclidean",this.featureExtractor).cluster(s),a=Be.calculateSilhouetteScore(s,o.clusters,this.featureExtractor),c=Be.calculateDaviesBouldinIndex(s,o.clusters,this.featureExtractor);return{...o,quality:{silhouetteScore:a,daviesBouldinIndex:c},algorithm:"K-Means"}}async autoClustering(e,t={}){let s=process.hrtime.bigint();if(e.length===0){let l={clusters:[],noise:[],stats:{clusterCount:0,noiseCount:0,totalPoints:0,avgClusterSize:0,inertia:0},parameters:{epsilon:t.epsilon||.3,minPoints:t.minPoints||3,k:t.k||0,iterations:0,converged:!0,distanceMetric:"euclidean"},quality:{silhouetteScore:0,daviesBouldinIndex:0},algorithm:"None",duration:0};return{bestResult:l,dbscanResult:l,kmeansResult:l,comparison:{dbscanSilhouette:0,kmeansSilhouette:0,selectedAlgorithm:"None",totalDuration:0}}}let i=await this.clusterWithDBSCAN(e,{epsilon:t.epsilon||.3,minPoints:t.minPoints||3,distanceMetric:"cosine"}),r=await this.clusterWithKMeans(e,{k:t.k||Math.min(Math.ceil(Math.sqrt(e.length/2)),8),distanceMetric:"euclidean"}),o=i.quality.silhouetteScore>r.quality.silhouetteScore?i:r,a=process.hrtime.bigint(),c=Number(a-s)/1e6;return{bestResult:o,dbscanResult:i,kmeansResult:r,comparison:{dbscanSilhouette:i.quality.silhouetteScore,kmeansSilhouette:r.quality.silhouetteScore,selectedAlgorithm:o.algorithm,totalDuration:c}}}};u(Bo,"ClusteringEngine");var Fo=Bo;zd.exports={MemoryFeatureExtractor:Le,DBSCANClusterer:Si,KMeansClusterer:Ei,ClusteringEvaluator:Be,ClusteringEngine:Fo}});var Yd=w((Wv,Kd)=>{var Yo=class Yo{constructor(e,t,s,i,r,o,a){this.memorySystem=e,this.enhancedTools=t,this.boardTool=s,this.workflowTool=i,this.conflictEngine=r,this.visualMapper=o,this.crossValidator=a}async memory(e){let{action:t,...s}=e;switch(t){case"store":return await this.memorySystem.store(s);case"query":let i=await this.memorySystem.search(s.query,s.limit||20,{mode:s.mode||"smart",memory_type:s.memory_type,min_confidence:s.min_confidence});return Array.isArray(i)?i.length===0?`No memories found for query: "${s.query}"`:`Found ${i.length} memories for "${s.query}":

${i.map(o=>`- ${o.content?o.content.substring(0,100):"Empty content"}...`).join(`
`)}`:i;case"search":return s.mode||s.algorithm?await this.memorySystem.advancedSearch(s.query,{mode:s.mode,algorithm:s.algorithm,limit:s.limit||20,memory_type:s.memory_type,min_confidence:s.min_confidence,outputMode:"clean"}):await this.memorySystem.search(s.query,s.limit||20,s);case"export":return await this.enhancedTools.createMemoryExportTool().handler(s);case"stats":return await this.memorySystem.getStats(s.detailed);default:return`\u274C Unknown memory action: ${t}. Use: store, query, search, export, stats`}}async workflow(e){let{action:t,...s}=e;switch(t){case"create":return await this.workflowTool.createEnhancement(s);case"complete":return await this.workflowTool.completePhase(s);case"status":return await this.workflowTool.getWorkflowState();case"phases":return await this.workflowTool.getPhases();case"connection":return await this.workflowTool.saveConnection(s);case"short_memory":return await this.workflowTool.getShortMemory();default:return`\u274C Unknown workflow action: ${t}. Use: create, complete, status, phases, connection, short_memory`}}async board(e){let{action:t,...s}=e;switch(t){case"status":return await this.boardTool.getBoardStatus(s);case"create":case"update":case"move":case"delete":return await this.boardTool.updateBoardTask({action:t,...s});default:return`\u274C Unknown board action: ${t}. Use: status, create, update, move, delete`}}async relationships(e){let{action:t,...s}=e;switch(t){case"store":return await this.enhancedTools.createStoreRelationshipTool().handler(s);case"query":return await this.enhancedTools.createQueryRelationshipsTool().handler(s);case"traverse":let o=await this.visualMapper.generateMemoryMap({...s,format:"json_tree",focus_entity:s.start_entity,max_depth:s.max_hops||3});return typeof o=="object"&&o.paths?`Graph Traversal Results:
${JSON.stringify(o,null,2)}`:o;default:return`\u274C Unknown relationship action: ${t}. Use: store, query, traverse`}}async analysis(e){var i,r,o;let{action:t,...s}=e;switch(t){case"analyze":let{ClusteringEngine:a}=Bd(),c=new a,l={};if(s.days){let y=new Date;y.setDate(y.getDate()-s.days),l.since=y}s.category&&(l.memory_type=s.category);let h=await this.memorySystem.query(l,s.limit||1e3),d=h;if(h.length>1e3){d=[];let p=new Set;for(;p.size<1e3;)p.add(Math.floor(Math.random()*h.length));for(let g of p)d.push(h[g])}if(s.mode==="summary"){let y={total_memories:h.length,analyzed_memories:d.length,date_range:s.days?`Last ${s.days} days`:"All time",category:s.category||"all",memory_types:{},tags_frequency:{},recent_themes:[]};for(let p of d)if(y.memory_types[p.memory_type]=(y.memory_types[p.memory_type]||0)+1,p.tags&&Array.isArray(p.tags))for(let g of p.tags)y.tags_frequency[g]=(y.tags_frequency[g]||0)+1;return y.top_tags=Object.entries(y.tags_frequency).sort(([,p],[,g])=>g-p).slice(0,10).map(([p,g])=>({tag:p,count:g})),delete y.tags_frequency,y}let f,m=s.method||"auto";return m==="dbscan"||m==="auto"?f=await c.clusterWithDBSCAN(d,{epsilon:((i=s.options)==null?void 0:i.epsilon)||.3,minPoints:((r=s.options)==null?void 0:r.minPoints)||3,...s.options}):m==="kmeans"?f=await c.clusterWithKMeans(d,{k:((o=s.options)==null?void 0:o.k)||5,...s.options}):f=await c.clusterWithDBSCAN(d,s.options||{}),f;case"conflicts":return await this.conflictEngine.detectConflicts(s);case"visualize":return await this.visualMapper.generateMemoryMap(s);case"validate":return await this.crossValidator.validateCrossReferences(s);default:return`\u274C Unknown analysis action: ${t}. Use: analyze, conflicts, visualize, validate`}}async project(e){let{action:t,...s}=e;switch(t){case"list":return await this.enhancedTools.createProjectListTool().handler(s);case"switch":return await this.enhancedTools.createProjectSwitchTool().handler(s);case"changes":return await this.enhancedTools.createFileChangesTool().handler(s);default:return`\u274C Unknown project action: ${t}. Use: list, switch, changes`}}async settings(e){let{action:t,...s}=e;switch(t){case"categories":return await this.memorySystem.getMemoryCategories();case"algorithms":return{available_modes:this.memorySystem.getSearchAlgorithms().modes,current:"smart",description:"Smart search modes that automatically optimize for your queries"};case"set_algorithm":let r=s.algorithm;return s.mode&&(r={smart:"hybrid",precise:"tfidf",fast:"bm25",balanced:"hybrid"}[s.mode]||"hybrid"),this.memorySystem.searchEngine&&r?(this.memorySystem.searchEngine.algorithm=r,`Search mode set to: ${s.mode||r}`):"\u274C Search engine not initialized";case"cleanup":return await this.memorySystem.cleanup(s.force);default:return`\u274C Unknown settings action: ${t}. Use: categories, algorithms, set_algorithm, cleanup`}}async quick(e){let t,s;if(e.action)({action:t,...s}=e);else if(e.params&&e.params.action)({action:t,...s}=e.params);else return'\u274C Invalid quick tool parameters. Usage: { "action": "find", "query": "search term" }';switch(t){case"save":return await this.memory({action:"store",...s});case"find":if(!s.query&&s.content&&(s.query=s.content,delete s.content),!s.query)return'\u274C Query is required for find. Usage: { "action": "find", "query": "search term" }';let i=String(s.query).trim();if(!i)return"\u274C Query cannot be empty. Please provide a search term.";let r={action:"search",query:i};s.limit!==void 0&&(r.limit=parseInt(s.limit)||20),s.min_confidence!==void 0&&(r.min_confidence=parseFloat(s.min_confidence)||0),s.mode&&(r.mode=String(s.mode));let o=await this.memory(r);if(typeof o=="string")return o;if(o&&o.results){let l=o.results.length;if(l===0)return`No results found for "${i}"`;let h=`Found ${l} results for "${i}":

`;return o.results.slice(0,5).forEach((d,f)=>{h+=`${f+1}. ${d.content.substring(0,100)}...
`,h+=`   \u{1F4CA} Score: ${(d.score*100).toFixed(1)}%
`,h+=`   \u{1F3F7}\uFE0F Type: ${d.memory_type||"general"}

`}),l>5&&(h+=`... and ${l-5} more results
`),h}else return JSON.stringify(o);case"task":return await this.board({action:"create",category:"pending-tasks",...s});case"note":return await this.workflow({action:"create",type:"general",...s});case"status":let a=await this.board({action:"status",format:"simple"}),c=await this.workflow({action:"status"});return`${a}

${c}`;default:return`\u274C Unknown quick action: ${t}. Use: save, find, task, note, status`}}async help(e){let{topic:t}=e,s={overview:`
\u{1F9E0} **Nova Memory Meta-Tools**
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501

9 simple tools that access 28 underlying functions:

1. **memory** - Store, query, search, export memories
2. **workflow** - Manage enhancements, phases, connections
3. **board** - Task board operations
4. **relationships** - Entity relationships
5. **analysis** - Analyze and visualize data
6. **project** - Project management
7. **settings** - Configuration
8. **quick** - Common shortcuts
9. **help** - This help system

Use: help({ topic: 'memory' }) for specific help
`,memory:`
\u{1F4DA} **Memory Tool**

Actions:
\u2022 store - Save content to memory
\u2022 query - Semantic search
\u2022 search - Full-text search
\u2022 export - Export data (json/csv/markdown)
\u2022 stats - Memory statistics

Examples:
memory({ action: 'store', content: 'Important note' })
memory({ action: 'search', query: 'nova memory' })
`,workflow:`
\u{1F4CB} **Workflow Tool**

Actions:
\u2022 create - Create enhancement/reminder
\u2022 complete - Complete phase with summary
\u2022 status - Current workflow state
\u2022 phases - View phase progression
\u2022 connection - Save connection string
\u2022 short_memory - Recent activity

Examples:
workflow({ action: 'create', title: 'New Feature', description: 'Details...' })
workflow({ action: 'complete', phase: 'Development' })
`,board:`
\u{1F4CA} **Board Tool**

Actions:
\u2022 status - View board (simple/detailed/task_ids)
\u2022 create - Create new task
\u2022 update - Update existing task
\u2022 move - Move task between categories
\u2022 delete - Delete task

Examples:
board({ action: 'create', title: 'Fix bug', category: 'pending-tasks' })
board({ action: 'move', task_id: 'task-123', category: 'completed' })
`,quick:`
\u26A1 **Quick Tool**

Shortcuts:
\u2022 save - Quick memory save
\u2022 find - Quick search
\u2022 task - Quick task creation
\u2022 note - Quick note/enhancement
\u2022 status - Overview of board & workflow

Examples:
quick({ action: 'task', title: 'Quick fix' })
quick({ action: 'find', query: 'optimization' })
`};return t&&s[t]?s[t]:s.overview}};u(Yo,"MetaTools");var Ko=Yo;Kd.exports=Ko});var Gd=w((Jv,Wd)=>{var Wo=require("path"),Go=require("fs").promises,Vo=class Vo{constructor(e){this.memorySystem=e;let t=process.env.NOVA_MEMORY_PATH||Wo.join(process.env.APPDATA||process.env.HOME,"nova-memory");this.boardDataPath=Wo.join(t,"board-state.json")}async getBoardStatus(e={}){try{let t=await this.loadBoardState();return e.format==="simple"?this.renderSimpleStatus(t):e.format==="task_ids"?this.renderTaskIds(t):this.renderDetailedBoard(t)}catch(t){return console.error("Error getting board status:",t),"\u274C Unable to load board status"}}renderTaskIds(e){let t=e.categories||{},s=`\u{1F522} **Task ID Reference Guide**
`;return s+=`\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

`,Object.keys(t).forEach(i=>{let r=t[i],o=r.tasks||[];o.length>0&&(s+=`## ${r.icon} ${r.title}
`,o.forEach((a,c)=>{let l={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"}[a.priority]||"\u26AA";s+=`\u{1F194} **${a.id}** - ${l} ${a.title}
`}),s+=`
`)}),s+=`\u{1F4A1} **Usage:** Copy the task ID (e.g., "task-1752913862329") to update, move, or delete tasks.
`,s}async loadBoardState(){try{let e=await Go.readFile(this.boardDataPath,"utf8");return JSON.parse(e)}catch{return this.getDefaultBoardState()}}renderSimpleStatus(e){let t=e.categories||{},s=`\u{1F9E0} **Nova Memory Board Status**
`;return s+='\u{1F4A1} Sync with Claude: `quick({action: "task", title: "your task"})`\n\n',Object.keys(t).forEach(i=>{var c,l;let r=t[i],o=((c=r.tasks)==null?void 0:c.length)||0,a=((l=r.tasks)==null?void 0:l.filter(h=>h.priority==="high").length)||0;s+=`${r.icon} **${r.title}**: ${o} tasks`,a>0&&(s+=` (\u{1F534} ${a} high priority)`),s+=`
`}),s}renderDetailedBoard(e){let t=e.categories||{},s=`\u{1F9E0} **Nova Memory Journal Board**
`;return s+=`\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`,s+=`\u{1F4A1} **Tip:** You can sync Claude's todo list with this board!
`,s+='   Use: `board({action: "create", title: "task from Claude", category: "pending-tasks"})`\n\n',Object.keys(t).forEach(i=>{let r=t[i],o=r.tasks||[];if(s+=`## ${r.icon} ${r.title} (${o.length})
`,o.length===0){s+=`   _No tasks_

`;return}o.forEach((a,c)=>{let l={high:"\u{1F534}",medium:"\u{1F7E1}",low:"\u{1F7E2}"}[a.priority]||"\u26AA";if(s+=`${c+1}. ${l} **${a.title}**
`,a.description&&(s+=`   \u{1F4DD} ${a.description}
`),a.tags){let h=a.tags;if(typeof h=="string")try{h=JSON.parse(h)}catch{h=[h]}Array.isArray(h)&&h.length>0&&(s+=`   \u{1F3F7}\uFE0F ${h.join(", ")}
`)}a.memory_context&&a.memory_context.length>0&&(s+=`   \u{1F9E0} Context: ${a.memory_context.join(", ")}
`),s+=`
`}),s+=`\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500

`}),s}getDefaultBoardState(){return{categories:{"journal-reminder":{title:"\u{1F4DD} Journal Reminders",icon:"\u{1F4DD}",tasks:[]},"active-memory":{title:"\u{1F9E0} Active Memory",icon:"\u{1F9E0}",tasks:[]},"killer-features":{title:"\u{1F680} Killer Features",icon:"\u{1F680}",tasks:[]},"pending-tasks":{title:"\u{1F4CB} Pending Tasks",icon:"\u{1F4CB}",tasks:[]},completed:{title:"\u2705 Completed",icon:"\u2705",tasks:[]}}}}async updateBoardState(e){try{let t=Wo.dirname(this.boardDataPath);return await Go.mkdir(t,{recursive:!0}),await Go.writeFile(this.boardDataPath,JSON.stringify(e,null,2)),await this.memorySystem.store({content:`Board state updated: ${Object.keys(e.categories).map(s=>{var i;return`${e.categories[s].title}: ${((i=e.categories[s].tasks)==null?void 0:i.length)||0} tasks`}).join(", ")}`,memory_type:"board_update",metadata:{update_timestamp:new Date().toISOString(),total_tasks:Object.values(e.categories).reduce((s,i)=>{var r;return s+(((r=i.tasks)==null?void 0:r.length)||0)},0)}}),!0}catch(t){return console.error("Error updating board state:",t),!1}}async updateBoardTask(e){try{let t=await this.loadBoardState(),{action:s,task_id:i,title:r,description:o,category:a,priority:c,tags:l}=e;switch(s){case"create":if(!r||!a)return"\u274C Title and category are required for creating tasks";let h=l;if(h&&typeof h=="string")try{h=JSON.parse(h)}catch{h=[h]}h||(h=[c||"medium","new"]);let d={id:`task-${Date.now()}`,title:r,description:o||"",priority:c||"medium",tags:h,date:new Date().toISOString(),memory_context:[]};if(!t.categories[a]){let S=Object.keys(t.categories).join(", ");return`\u274C Invalid category: ${a}
\u{1F4CB} Valid categories: ${S}`}return t.categories[a].tasks.push(d),await this.updateBoardState(t),await this.memorySystem.store({content:`Task created: ${r} - ${o}`,memory_type:"task_creation",metadata:{task_id:d.id,category:a,priority:c}}),`\u2705 Created task "${r}" in ${t.categories[a].title}`;case"update":if(!i)return"\u274C Task ID is required for updating tasks";let f=null,m=null;return Object.keys(t.categories).forEach(S=>{let E=t.categories[S].tasks.findIndex(T=>T.id===i);if(E!==-1){let T=t.categories[S].tasks[E],_=T.title;if(r&&(T.title=r),o!==void 0&&(T.description=o),c&&(T.priority=c,T.tags=T.tags.filter(v=>!["high","medium","low"].includes(v)),T.tags.push(c)),l){let v=l;if(typeof v=="string")try{v=JSON.parse(v)}catch{v=[v]}T.tags=v}f=T,m=S}}),f?(await this.updateBoardState(t),await this.memorySystem.store({content:`Task updated: ${f.title} - ${f.description}`,memory_type:"task_update",metadata:{task_id:i,category:m,changes:{title:r,description:o,priority:c,tags:l}}}),`\u2705 Updated task "${f.title}" in ${t.categories[m].title}`):`\u274C Task not found: ${i}`;case"move":if(!i||!a)return"\u274C Task ID and target category are required for moving tasks";let y=null,p=null;if(Object.keys(t.categories).forEach(S=>{let E=t.categories[S].tasks.findIndex(T=>T.id===i);E!==-1&&(y=t.categories[S].tasks[E],p=S,t.categories[S].tasks.splice(E,1))}),!y)return`\u274C Task not found: ${i}`;if(!t.categories[a]){let S=Object.keys(t.categories).join(", ");return`\u274C Invalid target category: ${a}
\u{1F4CB} Valid categories: ${S}`}return t.categories[a].tasks.push(y),await this.updateBoardState(t),`\u2705 Moved "${y.title}" from ${t.categories[p].title} to ${t.categories[a].title}`;case"delete":if(!i)return"\u274C Task ID is required for deleting tasks";let g=!1,b=null;return Object.keys(t.categories).forEach(S=>{let E=t.categories[S].tasks.findIndex(T=>T.id===i);E!==-1&&(b=t.categories[S].tasks[E],t.categories[S].tasks.splice(E,1),g=!0)}),g?(await this.updateBoardState(t),`\u2705 Deleted task "${b.title}"`):`\u274C Task not found: ${i}`;default:return`\u274C Invalid action: ${s}. Use create, update, move, or delete.`}}catch(t){return console.error("Error updating board task:",t),`\u274C Error updating board task: ${t.message}`}}};u(Vo,"BoardStatusTool");var Jo=Vo;Wd.exports=Jo});var Vd=w((Xv,Jd)=>{var Ho=class Ho{constructor(e){this.memorySystem=e,this.currentPhase=null,this.workflowState={reminders:[],shortMemory:[],phases:{past:[],current:[],future:[]}}}async createEnhancementReminder(e){let t={id:`reminder-${Date.now()}`,type:"enhancement_reminder",title:`Enhancement: ${e.title}`,description:e.description,connectionStrings:e.connections||[],commands:e.commands||[],phase:"current",status:"active",timestamp:new Date().toISOString(),metadata:{enhancement_type:e.type,priority:e.priority||"medium",estimated_time:e.estimatedTime}};return await this.memorySystem.store({content:`Enhancement reminder created: ${t.title} - ${t.description}`,memory_type:"enhancement_reminder",metadata:{reminder_id:t.id,phase:t.phase,commands:t.commands,connections:t.connectionStrings},tags:["enhancement","reminder","workflow"]}),this.workflowState.reminders.push(t),this.addToShortMemory(`\u{1F4DD} Created enhancement reminder: ${t.title}`),t}async addToShortMemory(e){let t={id:`short-${Date.now()}`,content:e,timestamp:new Date().toISOString(),type:"short_memory"};return this.workflowState.shortMemory.unshift(t),this.workflowState.shortMemory.length>10&&(this.workflowState.shortMemory=this.workflowState.shortMemory.slice(0,10)),await this.memorySystem.store({content:e,memory_type:"short_memory",tags:["workflow","activity","short_memory"]}),t}async updatePhaseState(e){let{past:t,current:s,future:i}=e;return this.workflowState.phases={past:t,current:s,future:i},await this.memorySystem.store({content:`Phase state updated: Past(${t.length}), Current(${s.length}), Future(${i.length})`,memory_type:"phase_state",metadata:{past_tasks:t.length,current_tasks:s.length,future_tasks:i.length,current_phase_details:s},tags:["phase","workflow","state"]}),this.workflowState.phases}async completePhase(e){let t={id:`phase-completion-${Date.now()}`,phase:e.phase,summary:e.summary,achievements:e.achievements||[],timestamp:new Date().toISOString(),duration:e.duration,status:"completed"},s=await this.generatePhaseSummary(e);t.autoSummary=s;let i=this.workflowState.phases.current;return this.workflowState.phases.past.push(...i.map(r=>({...r,completed_at:t.timestamp,phase_summary:s}))),this.workflowState.phases.current=this.workflowState.phases.future.slice(0,3),this.workflowState.phases.future=this.workflowState.phases.future.slice(3),await this.memorySystem.store({content:`Phase completed: ${t.phase} - ${s}`,memory_type:"phase_completion",metadata:{completion_id:t.id,phase:t.phase,achievements:t.achievements,auto_summary:s,tasks_completed:i.length},tags:["phase","completion","workflow","summary"]}),await this.addToShortMemory(`\u2705 Phase completed: ${t.phase}`),t}async generatePhaseSummary(e){try{let t=await this.memorySystem.search(`${e.phase} task enhancement optimization`,10),s=[],i=new Set,r=[];t.forEach(a=>{(a.content.includes("\u2705")||a.content.includes("completed"))&&s.push(a.content),(a.content.includes("optimization")||a.content.includes("improvement"))&&r.push(a.content);let c=a.content.match(/\b(MCP|Nova Memory|WebSocket|API|UI|Dashboard)\b/gi);c&&c.forEach(l=>i.add(l))});let o={overview:`Phase "${e.phase}" completed with ${s.length} major achievements`,key_achievements:s.slice(0,5),technologies_used:Array.from(i),improvements_made:r.slice(0,3),completion_rate:`${s.length}/${e.totalTasks||s.length} tasks`,generated_at:new Date().toISOString()};return JSON.stringify(o,null,2)}catch(t){return console.error("Error generating phase summary:",t),`Phase "${e.phase}" completed successfully. Summary generation failed: ${t.message}`}}async getWorkflowState(){try{let e=await this.memorySystem.search("workflow phase reminder short_memory",20);await this.syncWithNovaMemory(e)}catch(e){console.error("Error syncing workflow state:",e)}return{...this.workflowState,lastUpdated:new Date().toISOString(),totalReminders:this.workflowState.reminders.length,activePhases:this.workflowState.phases.current.length}}async syncWithNovaMemory(e){let t=e.filter(r=>r.memory_type==="enhancement_reminder"),s=e.filter(r=>r.memory_type==="phase_state");if(s.length>0){let r=s[0];r.metadata&&r.metadata.current_phase_details&&(this.workflowState.phases.current=r.metadata.current_phase_details)}let i=e.filter(r=>r.memory_type==="short_memory");this.workflowState.shortMemory=i.slice(0,10).map(r=>({id:r.id,content:r.content,timestamp:r.timestamp,type:"short_memory"}))}async saveConnection(e){let t={id:`conn-${Date.now()}`,type:e.type||"general",value:e.value,description:e.description||"",commands:e.commands||[],saved_at:new Date().toISOString()};return await this.memorySystem.store({content:`Connection saved: ${t.type} - ${t.value}`,memory_type:"connection_string",metadata:{connection_id:t.id,type:t.type,commands:t.commands},tags:["connection","workflow","command"]}),await this.addToShortMemory(`\u{1F517} Saved connection: ${t.type}`),t}async executeCommand(e,t={}){let s={id:`exec-${Date.now()}`,command:e,context:t,timestamp:new Date().toISOString(),status:"executed"};return await this.memorySystem.store({content:`Command executed: ${e}`,memory_type:"command_execution",metadata:{execution_id:s.id,command:e,context:t},tags:["command","execution","workflow"]}),await this.addToShortMemory(`\u25B6\uFE0F Executed: ${e}`),s}};u(Ho,"EnhancementWorkflow");var Xo=Ho;Jd.exports=Xo});var Hd=w((Qv,Xd)=>{var yb=Vd(),Zo=class Zo{constructor(e){this.memorySystem=e,this.workflow=new yb(e)}async getWorkflowState(){try{let e=await this.workflow.getWorkflowState();return this.formatWorkflowForUI(e)}catch(e){return console.error("Error getting workflow state:",e),"\u274C Failed to get workflow state: "+e.message}}async createEnhancement(e){try{let t=await this.workflow.createEnhancementReminder(e);return`\u2705 Enhancement reminder created: ${t.title}
\u{1F194} ID: ${t.id}
\u{1F4CB} Phase: ${t.phase}`}catch(t){return console.error("Error creating enhancement:",t),"\u274C Failed to create enhancement: "+t.message}}async completePhase(e){try{let t=await this.workflow.completePhase(e);return`\u2705 Phase completed: ${t.phase}
\u{1F4CA} Summary: ${t.autoSummary.substring(0,200)}...
\u{1F552} Duration: ${t.duration||"N/A"}`}catch(t){return console.error("Error completing phase:",t),"\u274C Failed to complete phase: "+t.message}}async saveConnection(e){try{let t=await this.workflow.saveConnection(e);return`\u2705 Connection saved: ${t.type}
\u{1F517} Value: ${t.value}
\u{1F194} ID: ${t.id}`}catch(t){return console.error("Error saving connection:",t),"\u274C Failed to save connection: "+t.message}}async executeCommand(e,t={}){try{let s=await this.workflow.executeCommand(e,t);return`\u2705 Command executed: ${e}
\u{1F194} Execution ID: ${s.id}
\u23F0 Time: ${s.timestamp}`}catch(s){return console.error("Error executing command:",s),"\u274C Failed to execute command: "+s.message}}async getShortMemory(){try{let e=await this.workflow.getWorkflowState();return this.formatShortMemoryForUI(e.shortMemory)}catch(e){return console.error("Error getting short memory:",e),"\u274C Failed to get short memory: "+e.message}}async getPhases(){try{let e=await this.workflow.getWorkflowState();return this.formatPhasesForUI(e.phases)}catch(e){return console.error("Error getting phases:",e),"\u274C Failed to get phases: "+e.message}}async updatePhases(e){try{let t=await this.workflow.updatePhaseState(e);return`\u2705 Phases updated
\u{1F4CB} Past: ${t.past.length} tasks
\u{1F504} Current: ${t.current.length} tasks
\u{1F3AF} Future: ${t.future.length} tasks`}catch(t){return console.error("Error updating phases:",t),"\u274C Failed to update phases: "+t.message}}formatWorkflowForUI(e){let{reminders:t,shortMemory:s,phases:i,lastUpdated:r,totalReminders:o,activePhases:a}=e,c=`\u{1F9E0} **Workflow State Dashboard**
`;c+=`\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

`,c+=`\u{1F4CA} **Summary**
`,c+=`\u2022 Total Reminders: ${o}
`,c+=`\u2022 Active Phases: ${a}
`,c+=`\u2022 Short Memory: ${s.length}/10 entries
`,c+=`\u2022 Last Updated: ${new Date(r).toLocaleTimeString()}

`,c+=`\u{1F4DD} **Recent Activity**
`,s.slice(0,5).forEach((h,d)=>{c+=`${d+1}. ${h.content} (${new Date(h.timestamp).toLocaleTimeString()})
`}),c+=`
`,c+=`\u{1F514} **Active Reminders**
`;let l=t.filter(h=>h.status==="active");return l.length===0?c+=`_No active reminders_
`:l.slice(0,3).forEach((h,d)=>{c+=`${d+1}. ${h.title}
`,c+=`   \u{1F4DD} ${h.description}
`,h.commands.length>0&&(c+=`   \u{1F4BB} Commands: ${h.commands.join(", ")}
`),c+=`
`}),c}formatShortMemoryForUI(e){let t=`\u{1F9E0} **Short Memory (Recent Activity)**
`;return t+=`\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

`,e.length===0?t+=`_No recent activity_
`:e.forEach((s,i)=>{let r=new Date(s.timestamp).toLocaleTimeString();t+=`${i+1}. **${r}** - ${s.content}
`}),t}formatPhasesForUI(e){let t=`\u{1F4CB} **Phase Tracker**
`;return t+=`\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550

`,t+=`## \u2705 Past (${e.past.length})
`,e.past.slice(-3).forEach((s,i)=>{t+=`${i+1}. ${s.title||s}
`,s.completed_at&&(t+=`   \u23F0 Completed: ${new Date(s.completed_at).toLocaleDateString()}
`)}),t+=`
`,t+=`## \u{1F504} Current (${e.current.length})
`,e.current.forEach((s,i)=>{t+=`${i+1}. ${s.title||s}
`}),t+=`
`,t+=`## \u{1F3AF} Future (${e.future.length})
`,e.future.slice(0,5).forEach((s,i)=>{t+=`${i+1}. ${s.title||s}
`}),t}};u(Zo,"WorkflowTools");var Qo=Zo;Xd.exports=Qo});var{EnhancedMemorySystem:gb}=Id(),{ConflictDetectionEngine:wb}=Ld(),{VisualMemoryMapper:bb}=qd(),{CrossReferenceValidator:Sb}=Md(),{RelationshipEngine:Eb}=Lo(),{EnhancedMCPTools:_b}=jd(),Tb=Yd(),vb=Gd(),kb=Hd();module.exports={EnhancedMemorySystem:gb,EnhancedMCPTools:_b,ConflictDetectionEngine:wb,VisualMemoryMapper:bb,CrossReferenceValidator:Sb,RelationshipEngine:Eb,BoardStatusTool:vb,MetaTools:Tb,WorkflowTools:kb};
